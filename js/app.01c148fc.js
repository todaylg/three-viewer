(function(e){function n(n){for(var r,o,s=n[0],l=n[1],u=n[2],d=0,f=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);c&&c(n);while(f.length)f.shift()();return i.push.apply(i,u||[]),t()}function t(){for(var e,n=0;n<i.length;n++){for(var t=i[n],r=!0,s=1;s<t.length;s++){var l=t[s];0!==a[l]&&(r=!1)}r&&(i.splice(n--,1),e=o(o.s=t[0]))}return e}var r={},a={app:0},i=[];function o(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=r,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="/three-viewer/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=n,s=s.slice();for(var u=0;u<s.length;u++)n(s[u]);var c=l;i.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("2b0e"),a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"isLoading",attrs:{id:"wrapper"}},[t("div",{attrs:{id:"canvasContainer"}}),t("p",{staticClass:"loadingText"},[e._v("Loading...")]),t("main",{directives:[{name:"show",rawName:"v-show",value:e.openImportPage,expression:"openImportPage"}],staticClass:"dropWrap"},[t("div",{staticClass:"dropzone"},[t("div",{staticClass:"innerArea"},[e._m(0),t("div",{staticClass:"btnArea"},[t("div",{staticClass:"uploadBtn"},[t("input",{attrs:{type:"file",name:"file-input[]",id:"file-input",multiple:""}}),t("label",{attrs:{for:"file-input"}},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"17",viewBox:"0 0 20 17"}},[t("path",{attrs:{d:"M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"}})]),t("span",[e._v("Upload")])])]),t("div",{staticClass:"uploadBtn",on:{click:e.loadDefaultModel}},[t("span",[e._v("Defalut(3.5MB)")])])])])])])])},i=[function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"placeholder"},[t("p",[e._v("Please drag the glTF file or folder (zip supported) to this page")])])}],o=(t("c0b6"),t("d4ec")),s=t("bee2"),l=t("5a89"),u=(t("99af"),t("d81d"),t("b0c0"),t("b64b"),t("4c53"),t("96cf"),t("1da1")),c=(t("b8bf"),t("d3b7"),t("ddb0"),function(e,n){void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.enabled=!0,this.target=new l["Vector3"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:l["MOUSE"].ROTATE,MIDDLE:l["MOUSE"].DOLLY,RIGHT:l["MOUSE"].PAN},this.touches={ONE:l["TOUCH"].ROTATE,TWO:l["TOUCH"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(r),t.update(),s=o.NONE},this.update=function(){var n=new l["Vector3"],a=(new l["Quaternion"]).setFromUnitVectors(e.up,new l["Vector3"](0,1,0)),i=a.clone().inverse(),m=new l["Vector3"],g=new l["Quaternion"];return function(){var e=t.object.position;return n.copy(e).sub(t.target),n.applyQuaternion(a),c.setFromVector3(n),t.autoRotate&&s===o.NONE&&F(T()),t.enableDamping?(c.theta+=d.theta*t.dampingFactor,c.phi+=d.phi*t.dampingFactor):(c.theta+=d.theta,c.phi+=d.phi),c.theta=Math.max(t.minAzimuthAngle,Math.min(t.maxAzimuthAngle,c.theta)),c.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=f,c.radius=Math.max(t.minDistance,Math.min(t.maxDistance,c.radius)),!0===t.enableDamping?t.target.addScaledVector(p,t.dampingFactor):t.target.add(p),n.setFromSpherical(c),n.applyQuaternion(i),e.copy(t.target).add(n),t.object.lookAt(t.target),!0===t.enableDamping?(d.theta*=1-t.dampingFactor,d.phi*=1-t.dampingFactor,p.multiplyScalar(1-t.dampingFactor)):(d.set(0,0,0),p.set(0,0,0)),f=1,!!(h||m.distanceToSquared(t.object.position)>u||8*(1-g.dot(t.object.quaternion))>u)&&(t.dispatchEvent(r),m.copy(t.object.position),g.copy(t.object.quaternion),h=!1,!0)}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",se,!1),t.domElement.removeEventListener("mousedown",$,!1),t.domElement.removeEventListener("wheel",te,!1),t.domElement.removeEventListener("touchstart",ae,!1),t.domElement.removeEventListener("touchend",oe,!1),t.domElement.removeEventListener("touchmove",ie,!1),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",ne,!1),t.domElement.removeEventListener("keydown",re,!1)};var t=this,r={type:"change"},a={type:"start"},i={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=o.NONE,u=1e-6,c=new l["Spherical"],d=new l["Spherical"],f=1,p=new l["Vector3"],h=!1,m=new l["Vector2"],g=new l["Vector2"],v=new l["Vector2"],_=new l["Vector2"],A=new l["Vector2"],x=new l["Vector2"],b=new l["Vector2"],y=new l["Vector2"],E=new l["Vector2"];function T(){return 2*Math.PI/60/60*t.autoRotateSpeed}function S(){return Math.pow(.95,t.zoomSpeed)}function F(e){d.theta-=e}function L(e){d.phi-=e}var N=function(){var e=new l["Vector3"];return function(n,t){e.setFromMatrixColumn(t,0),e.multiplyScalar(-n),p.add(e)}}(),P=function(){var e=new l["Vector3"];return function(n,r){!0===t.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(t.object.up,e)),e.multiplyScalar(n),p.add(e)}}(),w=function(){var e=new l["Vector3"];return function(n,r){var a=t.domElement;if(t.object.isPerspectiveCamera){var i=t.object.position;e.copy(i).sub(t.target);var o=e.length();o*=Math.tan(t.object.fov/2*Math.PI/180),N(2*n*o/a.clientHeight,t.object.matrix),P(2*r*o/a.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(N(n*(t.object.right-t.object.left)/t.object.zoom/a.clientWidth,t.object.matrix),P(r*(t.object.top-t.object.bottom)/t.object.zoom/a.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function R(e){t.object.isPerspectiveCamera?f/=e:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*e)),t.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function O(e){t.object.isPerspectiveCamera?f*=e:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/e)),t.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function M(e){m.set(e.clientX,e.clientY)}function C(e){b.set(e.clientX,e.clientY)}function I(e){_.set(e.clientX,e.clientY)}function U(e){g.set(e.clientX,e.clientY),v.subVectors(g,m).multiplyScalar(t.rotateSpeed);var n=t.domElement;F(2*Math.PI*v.x/n.clientHeight),L(2*Math.PI*v.y/n.clientHeight),m.copy(g),t.update()}function D(e){y.set(e.clientX,e.clientY),E.subVectors(y,b),E.y>0?R(S()):E.y<0&&O(S()),b.copy(y),t.update()}function k(e){A.set(e.clientX,e.clientY),x.subVectors(A,_).multiplyScalar(t.panSpeed),w(x.x,x.y),_.copy(A),t.update()}function B(){}function H(e){e.deltaY<0?O(S()):e.deltaY>0&&R(S()),t.update()}function X(e){var n=!1;switch(e.keyCode){case t.keys.UP:w(0,t.keyPanSpeed),n=!0;break;case t.keys.BOTTOM:w(0,-t.keyPanSpeed),n=!0;break;case t.keys.LEFT:w(t.keyPanSpeed,0),n=!0;break;case t.keys.RIGHT:w(-t.keyPanSpeed,0),n=!0;break}n&&(e.preventDefault(),t.update())}function V(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{var n=.5*(e.touches[0].pageX+e.touches[1].pageX),t=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(n,t)}}function G(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var n=.5*(e.touches[0].pageX+e.touches[1].pageX),t=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(n,t)}}function j(e){var n=e.touches[0].pageX-e.touches[1].pageX,t=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(n*n+t*t);b.set(0,r)}function Y(e){t.enableZoom&&j(e),t.enablePan&&G(e)}function z(e){t.enableZoom&&j(e),t.enableRotate&&V(e)}function Q(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var n=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(n,r)}v.subVectors(g,m).multiplyScalar(t.rotateSpeed);var a=t.domElement;F(2*Math.PI*v.x/a.clientHeight),L(2*Math.PI*v.y/a.clientHeight),m.copy(g)}function W(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var n=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(n,r)}x.subVectors(A,_).multiplyScalar(t.panSpeed),w(x.x,x.y),_.copy(A)}function K(e){var n=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(n*n+r*r);y.set(0,a),E.set(0,Math.pow(y.y/b.y,t.zoomSpeed)),R(E.y),b.copy(y)}function q(e){t.enableZoom&&K(e),t.enablePan&&W(e)}function Z(e){t.enableZoom&&K(e),t.enableRotate&&Q(e)}function J(){}function $(e){if(!1!==t.enabled){switch(e.preventDefault(),t.domElement.focus?t.domElement.focus():window.focus(),e.button){case 0:switch(t.mouseButtons.LEFT){case l["MOUSE"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===t.enablePan)return;I(e),s=o.PAN}else{if(!1===t.enableRotate)return;M(e),s=o.ROTATE}break;case l["MOUSE"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===t.enableRotate)return;M(e),s=o.ROTATE}else{if(!1===t.enablePan)return;I(e),s=o.PAN}break;default:s=o.NONE}break;case 1:switch(t.mouseButtons.MIDDLE){case l["MOUSE"].DOLLY:if(!1===t.enableZoom)return;C(e),s=o.DOLLY;break;default:s=o.NONE}break;case 2:switch(t.mouseButtons.RIGHT){case l["MOUSE"].ROTATE:if(!1===t.enableRotate)return;M(e),s=o.ROTATE;break;case l["MOUSE"].PAN:if(!1===t.enablePan)return;I(e),s=o.PAN;break;default:s=o.NONE}break}s!==o.NONE&&(document.addEventListener("mousemove",ee,!1),document.addEventListener("mouseup",ne,!1),t.dispatchEvent(a))}}function ee(e){if(!1!==t.enabled)switch(e.preventDefault(),s){case o.ROTATE:if(!1===t.enableRotate)return;U(e);break;case o.DOLLY:if(!1===t.enableZoom)return;D(e);break;case o.PAN:if(!1===t.enablePan)return;k(e);break}}function ne(e){!1!==t.enabled&&(B(e),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",ne,!1),t.dispatchEvent(i),s=o.NONE)}function te(e){!1===t.enabled||!1===t.enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),e.stopPropagation(),t.dispatchEvent(a),H(e),t.dispatchEvent(i))}function re(e){!1!==t.enabled&&!1!==t.enableKeys&&!1!==t.enablePan&&X(e)}function ae(e){if(!1!==t.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(t.touches.ONE){case l["TOUCH"].ROTATE:if(!1===t.enableRotate)return;V(e),s=o.TOUCH_ROTATE;break;case l["TOUCH"].PAN:if(!1===t.enablePan)return;G(e),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(t.touches.TWO){case l["TOUCH"].DOLLY_PAN:if(!1===t.enableZoom&&!1===t.enablePan)return;Y(e),s=o.TOUCH_DOLLY_PAN;break;case l["TOUCH"].DOLLY_ROTATE:if(!1===t.enableZoom&&!1===t.enableRotate)return;z(e),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&t.dispatchEvent(a)}}function ie(e){if(!1!==t.enabled)switch(e.preventDefault(),e.stopPropagation(),s){case o.TOUCH_ROTATE:if(!1===t.enableRotate)return;Q(e),t.update();break;case o.TOUCH_PAN:if(!1===t.enablePan)return;W(e),t.update();break;case o.TOUCH_DOLLY_PAN:if(!1===t.enableZoom&&!1===t.enablePan)return;q(e),t.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===t.enableZoom&&!1===t.enableRotate)return;Z(e),t.update();break;default:s=o.NONE}}function oe(e){!1!==t.enabled&&(J(e),t.dispatchEvent(i),s=o.NONE)}function se(e){!1!==t.enabled&&e.preventDefault()}t.domElement.addEventListener("contextmenu",se,!1),t.domElement.addEventListener("mousedown",$,!1),t.domElement.addEventListener("wheel",te,!1),t.domElement.addEventListener("touchstart",ae,!1),t.domElement.addEventListener("touchend",oe,!1),t.domElement.addEventListener("touchmove",ie,!1),t.domElement.addEventListener("keydown",re,!1),-1===t.domElement.tabIndex&&(t.domElement.tabIndex=0),this.update()});c.prototype=Object.create(l["EventDispatcher"].prototype),c.prototype.constructor=c;var d=function(e,n){c.call(this,e,n),this.mouseButtons.LEFT=l["MOUSE"].PAN,this.mouseButtons.RIGHT=l["MOUSE"].ROTATE,this.touches.ONE=l["TOUCH"].PAN,this.touches.TWO=l["TOUCH"].DOLLY_ROTATE};d.prototype=Object.create(l["EventDispatcher"].prototype),d.prototype.constructor=d;t("4de4"),t("ace4"),t("5cc6"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7");var f=window.Zlib;function p(e){var n=new Uint8Array(e);return 31===n[0]&&139===n[1]}function h(e){var n=new Uint8Array(e);if(f){var t=new f.Gunzip(n),r=t.decompress();return r.buffer}console.error("Lack of necessary dependencies: gunzip.min.js.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js")}var m=function(){function e(n,t,r){Object(o["a"])(this,e),this._options=r||{},this._size=t,this._data=n}return Object(s["a"])(e,[{key:"deinterleaveImage4",value:function(e,n,t){for(var r=e*e,a=2*e*e,i=3*e*e,o=0,s=0;s<r;s++)t[o++]=n[s],t[o++]=n[s+r],t[o++]=n[s+a],t[o++]=n[s+i]}},{key:"loadPacked",value:function(){var e=this,n=function(n){var t=n;p(t)&&(t=h(t));for(var r=Math.log(e._size)/Math.LN2,a=0,i={},o=0;o<=r;o++){var s=Math.pow(2,r-o),l=void 0;if(a>=t.byteLength)break;for(var u=0;u<6;u++){i[u]||(i[u]=[]);var c=void 0,d=void 0;l=s*s*4,c=new Uint8Array(t,a,l),d=new Uint8Array(l),e.deinterleaveImage4(s,c,d),c=d,i[u].push(c),a+=l}}e._packedImages=i,e.createRGBA8Packed()};return n(this._data)}},{key:"createRGBA8Packed",value:function(){for(var e=this.cubeTextures=[],n=this._size,t=this._packedImages,r=t[0].length,a=l["LogLuvEncoding"],i=0;i<r;i++){var o=new l["CubeTexture"];e.push(o),o.format=l["RGBAFormat"],o.encoding=a,o.minFilter=l["LinearMipMapLinearFilter"],o.magFilter=l["LinearFilter"],o.generateMipmaps=!1;for(var s=0;s<6;s++){var u=new l["DataTexture"](t[s][i],n,n,l["RGBAFormat"]);u.format=o.format,u.encoding=a,u.type=o.type,u.generateMipmaps=!1,o.images[s]=u,o.needsUpdate=!0}o.needsUpdate=!0,n/=2}this.texture=new l["CubeTexture"],this.texture.format=l["RGBAFormat"],this.texture.encoding=a,this.texture.minFilter=this._options.minFilter||l["LinearMipMapLinearFilter"],this.texture.magFilter=this._options.magFilter||l["LinearFilter"],this.texture.generateMipmaps=!1;for(var c=0;c<6;c++){this.texture.image[c]=this.cubeTextures[0].images[c];for(var d=1;d<r;d++)this.texture.mipmaps[d-1]=this.cubeTextures[d],this.cubeTextures[d].needsUpdate=!0}this.texture.needsUpdate=!0}}]),e}(),g=function(){function e(n,t,r){Object(o["a"])(this,e),this._options=r||{},this._size=t,this._data=n,this._texture=null}return Object(s["a"])(e,[{key:"deinterleaveImage4",value:function(e,n,t){for(var r=e*e,a=2*e*e,i=3*e*e,o=0,s=0;s<r;s++)t[o++]=n[s],t[o++]=n[s+r],t[o++]=n[s+a],t[o++]=n[s+i]}},{key:"loadPacked",value:function(){var e=this,n=function(n){var t=n;p(t)&&(t=h(t));var r,a,i=e._size;r=new Uint8Array(t),a=new Uint8Array(t.byteLength),e.deinterleaveImage4(i,r,a),r=a;var o=new l["DataTexture"](r,i,i,l["RGBAFormat"]);o.encoding=l["LogLuvEncoding"],o.flipY=!0,o.needsUpdate=!0,e._texture=o};return n(this._data)}},{key:"texture",get:function(){return this._texture}}]),e}(),v=function(){function e(n,t){Object(o["a"])(this,e),this._data=n,this._size=t}return Object(s["a"])(e,[{key:"loadPacked",value:function(){var e=this,n=function(n){var t=e._size,r=n;p(r)&&(r=h(r));var a=t*t*4,i=new Uint8Array(r,0,a),o=new l["DataTexture"](i,t,t,l["RGBAFormat"]);return o};return n(this._data)}}]),e}(),_=(t("fb6a"),t("cfc3"),function(){function e(n){Object(o["a"])(this,e),this._file=n,this.initSHCoef(n)}return Object(s["a"])(e,[{key:"initSHCoef",value:function(e){var n=this;this._sphCoef=e.slice(0,27);var t=1/(2*Math.sqrt(Math.PI)),r=-.5*Math.sqrt(3/Math.PI),a=-r,i=r,o=.5*Math.sqrt(15/Math.PI),s=-o,l=.25*Math.sqrt(5/Math.PI),u=s,c=.25*Math.sqrt(15/Math.PI),d=[t,t,t,r,r,r,a,a,a,i,i,i,o,o,o,s,s,s,l,l,l,u,u,u,c,c,c];this._sphCoef=d.map((function(e,t){return e*n._sphCoef[t]})),this._uniformSpherical=new Float32Array(27);for(var f=0;f<9;f++)this._uniformSpherical[3*f]=this._sphCoef[3*f],this._uniformSpherical[3*f+1]=this._sphCoef[3*f+1],this._uniformSpherical[3*f+2]=this._sphCoef[3*f+2]}}]),e}());t("baa5"),t("4ec9"),t("ac1f"),t("3ca3"),t("466d"),t("2b3d");function A(e,n){return new Promise((function(t,r){var a=new XMLHttpRequest;a.open("GET",e,!0);var i=n&&n.responseType?n.responseType.toLowerCase():void 0;i&&(a.responseType=i),n&&n.progress&&a.addEventListener("progress",n.progress,!1),a.addEventListener("error",r,!1),a.addEventListener("load",(function(){"arraybuffer"===a.responseType||"blob"===a.responseType?t(a.response):t(a.responseText)})),a.send(null)}))}function x(e,n){return new Promise((function(t){var r=n&&n.responseType?n.responseType.toLowerCase():void 0,a=new window.FileReader;a.onload=function(e){t(e.target.result)},r?"arraybuffer"===r?a.readAsArrayBuffer(e):"blob"===r?t(e):"string"===r?a.readAsText(e):a.readAsDataURL(e):a.readAsText(e)}))}function b(e,n){return"string"===typeof e?A(e,n):x(e,n)}var y=b,E=new Map,T=function(e){return"string"===typeof e||e instanceof String},S=function(e){return"blob:http"===e.substr(0,9)},F=function(e){return"http://"===e.substr(0,7)||"https://"===e.substr(0,8)},L=function(e){return!!T(e)&&(S(e)||F(e))},N=function(e){return new Promise((function(n,t){var r=new Image;r.onerror=function(){t(r)},r.onload=function(){n(r)},r.src=e}))},P=function(e){var n=window.URL.createObjectURL(e),t=N(n);return t["finally"]((function(){window.URL.revokeObjectURL(n)})),t},w=function(e){return new Promise((function(n,t){var r=new FileReader;r.onerror=function(){t(r)},r.onload=function(){n(this.result)},r.readAsArrayBuffer(e)}))},R=function(e){return y(e,{responseType:"arraybuffer"})},O=function(e){return y(e).then((function(e){return JSON.parse(e)}))},M=function(e){var n=JSON.parse(e);return Promise.resolve(n)},C={createJSONFromURL:O,createArrayBufferFromURL:R,createArrayBufferFromBlob:w,createImageFromBlob:P,createImageFromURL:N,requestURI:y,requestResource:function(e,n){var t=C.getExtension(e),r=C.getMimeType(t),a=n&&n.responseType?n.responseType.toLowerCase():void 0;if(a)return y(e,n);if(r){if(r.match("image"))return N(e);if(r.match("binary"))return R(e);if(r.match("json"))return O(e);if(r.match("text"))return y(e)}return y(e)},resolveData:function(e,n){var t,r,a=C.getExtension(e),i=C.getMimeType(a);return i&&(i.match("image")?T(n)?t=N:n instanceof Blob&&(t=P):i.match("json")?t=L(n)?O:M:i.match("binary")&&(T(n)?t=R:n instanceof Blob&&(t=w))),r=t?t(n):Promise.resolve(n),r},resolveFilesMap:function(e){var n=[];for(var t in e){var r=e[t],a=C.resolveData(t,r).then(function(e,n){this[e]=n}.bind(e,t));n.push(a)}return Promise.all(n).then((function(){return e}))},getMimeType:function(e){return E.get(e)},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1)},addMimeTypeForExtension:function(e,n){void 0!==E.has(e)&&console.warn("the '"+e+"' already has a mimetype: "+E.get(e)),E.set(e,n)}};E.set("bin","application/octet-binary"),E.set("b3dm","application/octet-binary"),E.set("glb","application/octet-binary"),E.set("zip","application/octet-binary"),E.set("gz","application/octet-binary"),E.set("png","image/png"),E.set("jpg","image/jpeg"),E.set("jpeg","image/jpeg"),E.set("gif","image/gif"),E.set("json","application/json"),E.set("gltf","application/json"),E.set("osgjs","application/json"),E.set("txt","text/plain"),E.set("glsl","text/plain");var I=C,U="./assets/envMap/brdf_ue4.bin.gz",D=function(){function e(n){Object(o["a"])(this,e);var t=n.renderer,r=n.isMobile;this.isMobile=r,this._config=void 0,this._files={};var a=t.getContext();this.textureLODSupport=a.getExtension("EXT_shader_texture_lod"),this.uIntegrateBRDF=null}return Object(s["a"])(e,[{key:"loadPackage",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(n){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.url=n,t="".concat(n,"config.json"),e.next=4,I.requestResource(t);case 4:return r=e.sent,e.next=7,this.init(r);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));function n(n){return e.apply(this,arguments)}return n}()},{key:"getImage",value:function(e,n,t){var r=this.getTextures(e,n,t);if(r.length)return r[0].limitSize&&(r[0].images[0].limitSize=r[0].limitSize),r[0].images[0]}},{key:"getTextures",value:function(e,n,t){var r=this._config.textures,a=r.filter((function(r){return r.encoding===n&&r.format===t&&r.type===e}));return a}},{key:"init",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(n){var t,r,a,i,o,s,u,c,d,f,p,h,A,x,b,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._config=n,t="panorama",this.textureLODSupport&&(t="cubemap"),r=this.getImage("specular_ue4","luv",t),a=r.file,i=r.width,e.next=8,I.requestResource("".concat(this.url).concat(a));case 8:if(o=e.sent,this.mapEnv="cubemap"===t?new m(o,i,n):new g(o,i,n),this.mapEnv.loadPacked(),s=r.limitSize,u=Math.log(i)/Math.LN2,c=u-Math.log(s)/Math.LN2,this.uEnvironmentLodRange=[u,c],this.uEnvironmentSize=[i,i],this.uIntegrateBRDF){e.next=24;break}return d=this.getImage("brdf_ue4","rg16","lut"),f=d.width,e.next=21,I.requestResource(U);case 21:p=e.sent,this._integrateBRDF=new v(p,f),this.uIntegrateBRDF=this._integrateBRDF.loadPacked();case 24:return h=this.getImage("background","luv","cubemap"),A=h.file,x=h.width,e.next=29,I.requestResource("".concat(this.url).concat(A));case 29:return b=e.sent,this.backgroundEnv=new m(b,x,{minFilter:l["LinearFilter"],magFilter:l["LinearFilter"]}),this.backgroundEnv.loadPacked(),this.uBGEnvironmentSize=[x,x],this._spherical=new _(n.diffuseSPH),this.uEnvironmentSphericalHarmonics=this._spherical._uniformSpherical,n.Lights&&(y=n.Lights[0],this.sunlightInfo={color:(new l["Color"]).fromArray(y.color),position:(new l["Vector3"]).fromArray(y.direction).negate(),intensity:y.luminosity}),e.abrupt("return",this);case 37:case"end":return e.stop()}}),e,this)})));function n(n){return e.apply(this,arguments)}return n}()}]),e}(),k=(t("4160"),t("159b"),t("262e")),B=t("2caf"),H=["map","normalMap","lightMap","bumpMap","roughnessMap","metalnessMap","aoMap","emissiveMap","displacementmap"],X=["color","roughness","metalness","emissive"],V={uBrightness:{value:1},uEnvironmentTransform:{value:new l["Matrix3"]}},G={roughness:{value:.5},metalness:{value:0},color:{value:new l["Color"](16777215)},emissive:{value:new l["Color"](0)},uEnvironmentTransform:{value:new l["Matrix3"]},uBrightness:{value:1},uSpecularAAVariance:{value:.1},uSpecularAAThreshold:{value:1},uAnisotropyRotation:{value:0},uAnisotropyFactor:{value:.5},uClearCoatRoughness:{value:.5},uClearCoat:{value:.5}},j={ENABLE_IBL:1,ENABLE_LIGHT:1,ENERGY_COMPENSATION:1,DIFFUSE_LAMBERT:1,NDF_GGX:1,F_SCHLICK:1,V_SMITHJOINTAPPROX:1,SPECULAR_AO_SEBLAGARDE:1,MS_SPECULAR_AO:1,MS_DIFFUSE_AO:1},Y=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e,r,a){var i;Object(o["a"])(this,t);var s=e.material;i=n.call(this),i.modelNormalMatrix=new l["Matrix3"],i.copy(s),i.defines=Object.assign({},j),i.vertexTangents=s.vertexTangents,i.normalMapType=s.normalMapType;var u=l["UniformsLib"];return i.uniforms=l["UniformsUtils"].merge([u.common,u.normalmap,u.lightmap,u.bumpmap,u.roughnessmap,u.metalnessmap,u.aomap,u.emissivemap,u.displacementmap,u.envmap,u.fog,u.lights,G]),i.uniforms["uShadowDepthRange"]={value:a.shadowDepthRange},i.uniforms["uModelNormalMatrix"]={value:i.modelNormalMatrix},i.syncEnvSetting(r),i.syncParam(s),i.vertexShader=a.pbrVS,i.fragmentShader=a.pbrFS,i.lights=!0,!0===s.isGLTFSpecularGlossinessMaterial&&i.initSGWorkflow(s),e.onBeforeRender=function(){i.modelNormalMatrix.getNormalMatrix(e.matrixWorld)},i.extensions={derivatives:!0,shaderTextureLOD:!0},i.needsUpdate=!0,i}return Object(s["a"])(t,[{key:"syncEnvSetting",value:function(e){var n=e.mapEnv,t=e.uEnvironmentSphericalHarmonics,r=e.uEnvironmentLodRange,a=e.uEnvironmentSize,i=e.textureLODSupport;i?this.defines["CUBEMAP_LOD"]=1:this.defines["PANORAMA"]=1,this.envMap=n.texture,this.uniforms["envMap"]={value:n.texture},this.uniforms["uEnvironmentSphericalHarmonics"]={value:t},this.uniforms["uEnvironmentLodRange"]={value:r},this.uniforms["uEnvironmentSize"]={value:a},this.uniforms["uIntegrateBRDF"]={value:e.uIntegrateBRDF},e.isMobile&&(this.defines["MOBILE"]=1)}},{key:"syncParam",value:function(e){var n=this;H.forEach((function(t){void 0!=e[t]&&(n[t]=e[t],n.uniforms[t].value=e[t])})),X.forEach((function(t){void 0!=e[t]&&(n.uniforms[t].value=e[t])})),this.uniforms.diffuse.value=e.color||new Color(16777215)}},{key:"initSGWorkflow",value:function(e){this.defines["SPECULAR_GLOSSINESS"]=1;var n=e._extraUniforms,t=n.specular,r=n.glossiness,a=n.specularMap,i=n.glossinessMap;a.value&&(this.defines["USE_SPECULARMAP"]=1,this.uniforms["specularMap"]=a),i.value&&(this.defines["USE_GLOSSINESSMAP"]=1,this.uniforms["glossinessMap"]=i),this.uniforms["specularFactor"]=t,this.uniforms["glossinessFactor"]=r}}]),t}(l["ShaderMaterial"]),z="varying vec3 vViewNormal;\r\n\r\nvoid main() {\r\n    vViewNormal = position;\r\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    pos.z = 1.;\r\n    gl_Position = pos;\r\n}\r\n",Q="uniform samplerCube envMap;\r\nuniform mat3 uEnvironmentTransform;\r\nuniform float uEnvBrightness;\r\nuniform vec2 uEnvironmentSize;\r\n\r\nvarying vec3 vViewNormal;\r\n\r\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float scale ){\r\n    vec3 dir = direction;\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float M = max(max(abs(dir.x), abs(dir.y)), abs(dir.z));\r\n\r\n    if (abs(dir.x) != M) dir.x *= scale;\r\n    if (abs(dir.y) != M) dir.y *= scale;\r\n    if (abs(dir.z) != M) dir.z *= scale;\r\n\r\n    return dir;\r\n}\r\n\r\nvec4 textureCubemap(const in samplerCube tex, const in vec3 dir){\r\n    vec4 rgba = textureCube(tex, dir);\r\n    return LogLuvToLinear(rgba);\r\n}\r\n\r\n// Seamless cubemap for background\r\nvec4 textureCubeFixed(const in samplerCube tex, const in vec3 direction){\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - 1.0 / uEnvironmentSize[0];\r\n    vec3 dir = cubemapSeamlessFixDirection(direction, scale);\r\n    return textureCubemap(tex, dir);\r\n}\r\n\r\nvoid main(){\r\n    vec3 direction = normalize(vViewNormal);\r\n    direction = uEnvironmentTransform * direction;\r\n    vec4 samplerColor = uEnvBrightness * textureCubeFixed(envMap, direction);\r\n    \r\n    gl_FragColor = samplerColor;\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n}\r\n",W=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e){Object(o["a"])(this,t);var r=e.envMap,a=e.uBGEnvironmentSize,i=e.uEnvBrightness,s=e.debug,u=V.uEnvironmentTransform,c={envMap:{value:r},uEnvironmentSize:{value:a},uEnvBrightness:i,uEnvironmentTransform:u};return n.call(this,{uniforms:c,vertexShader:z,fragmentShader:Q,side:l["DoubleSide"],depthTest:!!s})}return t}(l["ShaderMaterial"]),K=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Object(o["a"])(this,t);var i=a/2,s=new l["SphereGeometry"](i,20,20),u=new W(e);return r=n.call(this,s,u),r.radius=i,r.sphere=s,r}return Object(s["a"])(t,[{key:"setSize",value:function(e){var n=e/this.radius;this.scale.setScalar(n)}},{key:"envMap",get:function(){return this.material.envMap},set:function(e){this.material.envMap=e}},{key:"mesh",get:function(){return this.sphere}}]),t}(l["Mesh"]),q=(t("5319"),"vec3 computeDiffuseSPH(vec3 normal, vec3 sphericalHarmonics[9]){\r\n    float x = normal.x;\r\n    float y = normal.y;\r\n    float z = normal.z;\r\n    vec3 result = (\r\n        sphericalHarmonics[0] +\r\n        sphericalHarmonics[1] * y +\r\n        sphericalHarmonics[2] * z +\r\n        sphericalHarmonics[3] * x +\r\n        sphericalHarmonics[4] * y * x +\r\n        sphericalHarmonics[5] * y * z +\r\n        sphericalHarmonics[6] * (3.0 * z * z - 1.0) +\r\n        sphericalHarmonics[7] * (z * x) +\r\n        sphericalHarmonics[8] * (x*x - y*y)\r\n    );\r\n    return max(result, vec3(0.0));\r\n}"),Z="// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\nvec3 integrateBRDF(vec3 specular, float roughness, float NoV) {\r\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\r\n    const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\r\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\r\n    return specular * AB.x + AB.y * 1.0;\r\n}",J="// For y up\r\nvec2 normalToPanoramaUV(vec3 dir){\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n\r\n    pos = acos(pos)*0.31830988618; // RECIPROCAL_PI\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n    pos.y = 1.0-pos.y;\r\n    return pos;\r\n}\r\n\r\n\r\nvec2 computeUVForMipmap(float level, vec2 uv, float size, float maxLOD){\r\n    // width for level\r\n    float widthForLevel = exp2( maxLOD-level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n    // compact version\r\n    float texelSize = 1.0/size;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += size - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\nvec4 texturePanoramaLod(sampler2D tex, vec2 size , vec3 direction, float lod, float maxLOD){\r\n    vec2 uvBase = normalToPanoramaUV(direction);\r\n    // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n    float lod0 = floor(lod);\r\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD);\r\n    vec4 texel0 = texture2D(tex, uv0.xy);\r\n\r\n    float lod1 = ceil(lod);\r\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD);\r\n    vec4 texel1 = texture2D(tex, uv0.xy);\r\n\r\n    return mix(texel0, texel1, fract(lod));\r\n}",$="vec3 precomputeLight(vec3 normal, vec3 viewDir, float perceptualRoughness){\r\n    // perceptually linear roughness to roughness\r\n    float roughness = perceptualRoughness * perceptualRoughness;\r\n    float NoV =  saturate(dot(normal, viewDir));\r\n    return vec3(roughness, roughness * roughness, NoV);\r\n}",ee='// Refer: UE4\r\n\r\n// ************************ Normal Distribution Functions(NDF) **************************\r\n\r\n// [Blinn 1977, "Models of light reflection for computer synthesized pictures"]\r\nfloat D_Blinn(vec3 precomputeLight, float NoH){\r\n    float a2 = precomputeLight.y;\r\n    float n = 2.0 / a2 - 2.0;\r\n    return (n+2.0) / (2.0* PI) * pow(NoH, n);   // 1 mad, 1 exp, 1 mul, 1 log\r\n}\r\n\r\n// [Beckmann 1963, "The scattering of electromagnetic waves from rough surfaces"]\r\nfloat D_Beckmann(vec3 precomputeLight, float NoH){\r\n    float a2 = precomputeLight.y;\r\n    float NoH2 = NoH * NoH;\r\n    return exp( (NoH2 - 1.0) / (a2 * NoH2) ) / ( PI * a2 * NoH2 * NoH2 );\r\n}\r\n\r\n// GGX / Trowbridge-Reitz\r\n// [Walter et al. 2007, "Microfacet models for refraction through rough surfaces"]\r\nfloat D_GGX(vec3 precomputeLight, float NoH){\r\n    float a2 = precomputeLight.y;\r\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\t// 2 mad\r\n    return a2 / (PI * d * d);\t// 4 mul, 1 rcp\r\n}\r\n\r\nfloat D_GGX(float rougness, float NoH){\r\n    float a2 = rougness * rougness;\r\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\t// 2 mad\r\n    return a2 / (PI * d * d);\t// 4 mul, 1 rcp\r\n}\r\n\r\nfloat Specular_D(vec3 precomputeLight, float NoH){\r\n#if defined(NDF_BLINNPHONG)\r\n    return D_Blinn(precomputeLight, NoH);\r\n#elif defined(NDF_BECKMANN)\r\n    return D_Beckmann(precomputeLight, NoH);\r\n#elif defined(NDF_GGX)\r\n    return D_GGX(precomputeLight, NoH);\r\n#else\r\n    return D_GGX(precomputeLight, NoH);\r\n#endif\r\n}\r\n\r\n// ************************************ Fresnel ************************************\r\n\r\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\r\nvec3 F_Schlick(float VoH, vec3 f0, float f90){\r\n    return f0 + (vec3(f90) - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nfloat F_Schlick(float VoH, float f0, float f90) {\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\n// [Cook-Torrance 1982]\r\nvec3 F_CookTorrance(float VoH, vec3 f0, float f90){\r\n    vec3 sqrtSpec = sqrt(f0);\r\n    vec3 n = (1.0 + sqrtSpec) / (1.0 - sqrtSpec);\r\n    float c = saturate(VoH);\r\n    vec3 g = sqrt(n * n + c * c - 1.0);\r\n\r\n    vec3 part1 = (g - c)/(g + c);\r\n    vec3 part2 = ((g + c) * c - 1.0)/((g - c) * c + 1.0);\r\n\r\n    return max(vec3(0.0), 0.5 * part1 * part1 * (1.0 + part2 * part2));\r\n}\r\n\r\nvec3 F_None(vec3 f0){\r\n    return f0;\r\n}\r\n\r\nvec3 Specular_F(float VoH, vec3 f0, float f90) {\r\n#if defined(F_SCHLICK)\r\n    return F_Schlick(VoH, f0, f90);\r\n#elif defined(F_COOKTORRANCE)\r\n    return F_CookTorrance(VoH, f0, f90);\r\n#else // FRESNSEL_NONE\r\n    return F_None(f0);\r\n#endif\r\n}\r\n\r\n// ******************************** Visibility Term *********************************\r\nfloat Vis_Implicit(){\r\n\treturn 0.25;\r\n}\r\n\r\n// [Neumann et al. 1999, "Compact metallic reflectance models"]\r\nfloat Vis_Neumann(vec3 precomputeLight, float NoL){\r\n\tfloat NoV = precomputeLight.z;\r\n\treturn 1. / (4. * max(NoL, NoV));\r\n}\r\n\r\n// [Kelemen 2001, "A microfacet based coupled specular-matte brdf model with importance sampling"]\r\nfloat Vis_Kelemen(float VoH){\r\n\t// constant to prevent NaN\r\n\treturn 1./(4. * VoH * VoH + 1e-5);\r\n}\r\n\r\n// Tuned to match behavior of Vis_Smith\r\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\r\nfloat Vis_Schlick(vec3 precomputeLight, float NoL){\r\n\tfloat a2 = precomputeLight.y;\r\n\tfloat NoV = precomputeLight.z;\r\n\tfloat k = sqrt(a2) * 0.5;\r\n\tfloat Vis_SchlickV = NoV * (1. - k) + k;\r\n\tfloat Vis_SchlickL = NoL * (1. - k) + k;\r\n\treturn 0.25 / (Vis_SchlickV * Vis_SchlickL);\r\n}\r\n\r\n// Smith term for GGX\r\n// [Smith 1967, "Geometrical shadowing of a random rough surface"]\r\nfloat Vis_Smith(vec3 precomputeLight, float NoL){\r\n\tfloat a2 = precomputeLight.y;\r\n\tfloat NoV = precomputeLight.z;\r\n\tfloat Vis_SmithV = NoV + sqrt(NoV * (NoV - NoV * a2) + a2);\r\n\tfloat Vis_SmithL = NoL + sqrt(NoL * (NoL - NoL * a2) + a2);\r\n\treturn 1./(Vis_SmithV * Vis_SmithL);\r\n}\r\n\r\n// Appoximation of joint Smith term for GGX\r\n// [Heitz 2014, "Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs"]\r\nfloat Vis_SmithJointApprox(vec3 precomputeLight, float NoL){\r\n    float roughness = precomputeLight.x;\r\n    float NoV = precomputeLight.z;\r\n    float Vis_SmithV = NoL * (NoV * (1.0 - roughness) + roughness);\r\n    float Vis_SmithL = NoV * (NoL * (1.0 - roughness) + roughness);\r\n    return 0.5 / (Vis_SmithV + Vis_SmithL);\r\n}\r\n\r\n// Hammon 2017, "PBR Diffuse Lighting for GGX+Smith Microsurfaces"\r\nfloat Vis_SmithJointApprox_Hammon(vec3 precomputeLight, float NoL) {\r\n    float roughness = precomputeLight.x;\r\n    float NoV = precomputeLight.z;\r\n\r\n    float v = 0.5 / mix(2.0 * NoL * NoV, NoL + NoV, roughness);\r\n    return v;\r\n}\r\n\r\nfloat Specular_V(vec3 precomputeLight, float NoL, float VoH){\r\n#if defined(V_IMPLICIT)\r\n    return Vis_Implicit();\r\n#elif defined(V_NEUMANN)\r\n    return Vis_Neumann(precomputeLight, NoL);\r\n#elif defined(V_KELEMEN)\r\n    return Vis_Kelemen(VoH);\r\n#elif defined(V_SCHLICK)\r\n    return Vis_Schlick(precomputeLight, NoL);\r\n#elif defined(V_SMITH)\r\n    return Vis_Smith(precomputeLight, NoL);\r\n#elif defined(V_SMITHJOINTAPPROX)\r\n    return Vis_SmithJointApprox(precomputeLight, NoL);\r\n#elif defined(V_HAMMONAPPROX)\r\n    return Vis_SmithJointApprox_Hammon(precomputeLight, NoL);\r\n#else\r\n\treturn 0.25;\r\n#endif\r\n}\r\n\r\nvec3 specularLobe(vec3 precomputeLight, vec3 specular, float NoL, float NoH, float VoH, float f90) {\r\n    float D = Specular_D(precomputeLight, NoH);\r\n    vec3 F = Specular_F(VoH, specular, f90);\r\n    float V = Specular_V(precomputeLight, NoL, VoH);\r\n\t\r\n    return (D * V) * F;\r\n}\r\n\r\n// ************************************ Diffuse ************************************\r\nvec3 Diffuse_Lambert(vec3 diffuse){\r\n\treturn diffuse / PI;\r\n}\r\n\r\n// [Burley 2012, "Physically-Based Shading at Disney"]\r\nvec3 Diffuse_Burley(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n    float Roughness = precomputeLight.x;\r\n    float NoV =  precomputeLight.z;\r\n\r\n\tfloat FD90 = 0.5 + 2. * VoH * VoH * Roughness;\r\n\tfloat FdV = 1. + (FD90 - 1.) * pow5(1. - NoV);\r\n\tfloat FdL = 1. + (FD90 - 1.) * pow5(1. - NoL);\r\n\treturn diffuse * ((1. / PI) * FdV * FdL);\r\n}\r\n\r\n// [Gotanda 2012, "Beyond a Simple Physically Based Blinn-Phong Model in Real-Time"]\r\nvec3 Diffuse_OrenNayar(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n    float Roughness = precomputeLight.x;\r\n\tfloat a = precomputeLight.y;\r\n    float NoV = precomputeLight.z;\r\n\tfloat s = a; // / ( 1.29 + 0.5 * a );\r\n\tfloat s2 = s * s;\r\n\tfloat VoL = 2. * VoH * VoH - 1.;  // double angle identity\r\n\tfloat Cosri = VoL - NoV * NoL;\r\n\tfloat C1 = 1. - 0.5 * s2 / (s2 + 0.33);\r\n\tfloat C2 = 0.45 * s2 / (s2 + 0.09) * Cosri * (Cosri >= 0. ? 1./(max(NoL, NoV)) : 1.);\r\n\treturn diffuse / PI * (C1 + C2) * (1. + Roughness * 0.5);\r\n}\r\n\r\n// [Gotanda 2014, "Designing Reflectance Models for New Consoles"]\r\nvec3 Diffuse_Gotanda(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n    float Roughness = precomputeLight.x;\r\n\tfloat a = precomputeLight.y;\r\n    float NoV = precomputeLight.z;\r\n\tfloat a2 = a * a;\r\n\tfloat F0 = 0.04;\r\n\tfloat VoL = 2. * VoH * VoH - 1.;    // double angle identity\r\n\tfloat Cosri = VoL - NoV * NoL;\r\n\r\n\tfloat a2_13 = a2 + 1.36053;\r\n\tfloat Fr = ( 1. - ( 0.542026*a2 + 0.303573*a ) / a2_13 ) * ( 1. - pow( 1. - NoV, 5. - 4.*a2 ) / a2_13 ) * ( ( -0.733996*a2*a + 1.50912*a2 - 1.16402*a ) * pow( 1. - NoV, 1. + 1./(39.*a2*a2+1.) ) + 1. );\r\n\tfloat Lm = ( max( 1. - 2.*a, 0. ) * ( 1. - pow5( 1. - NoL ) ) + min( 2.*a, 1. ) ) * ( 1. - 0.5*a * (NoL - 1.) ) * NoL;\r\n\tfloat Vd = ( a2 / ( (a2 + 0.09) * (1.31072 + 0.995584 * NoV) ) ) * ( 1. - pow( 1. - NoL, ( 1. - 0.3726732 * NoV * NoV ) / ( 0.188566 + 0.38841 * NoV ) ) );\r\n\tfloat Bp = Cosri < 0. ? 1.4 * NoV * NoL * Cosri : Cosri;\r\n\tfloat Lr = (21.0 / 20.0) * (1. - F0) * ( Fr * Lm + Vd + Bp );\r\n\treturn diffuse / PI * Lr;\r\n}\r\n\r\nvec3 diffuseLobe(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n#if defined(DIFFUSE_LAMBERT)\r\n    return Diffuse_Lambert(diffuse);\r\n#elif defined(DIFFUSE_BURLEY)\r\n    return Diffuse_Burley(precomputeLight, diffuse, NoL, VoH);\r\n#elif defined(DIFFUSE_ORENNAYAR)\r\n    return Diffuse_OrenNayar(precomputeLight, diffuse, NoL, VoH);\r\n#elif defined(DIFFUSE_GOTANDA)\r\n    return Diffuse_Gotanda(precomputeLight, diffuse, NoL, VoH);\r\n#else // DIFFUSE_NONE\r\n    return vec3(0.0);\r\n#endif\r\n}\r\n\r\nvoid surfaceShading(in vec3 normal, in vec3 viewDir, in float NoL, in vec3 precomputeLight, in vec3 diffuse, in vec3 specular, in float attenuation, in vec3 lightColor, in vec3 lightDir, in float f90, out vec3 diffuseOut, out vec3 specularOut, out bool lighted) {\r\n    lighted = NoL > 0.0;\r\n    if (!lighted) {\r\n        specularOut = diffuseOut = vec3(0.0);\r\n        return;\r\n    }\r\n    vec3 H = normalize(viewDir + lightDir);\r\n    float NoH =  saturate(dot(normal, H));\r\n    float VoH =  saturate(dot(viewDir, H));\r\n\t\r\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\r\n    diffuseOut = colorAttenuate * diffuseLobe(precomputeLight, diffuse, NoL, VoH);\r\n    specularOut = colorAttenuate * specularLobe(precomputeLight, specular, NoL, NoH, VoH, f90);\r\n}',ne='// Refer: Filament\r\n// Anisotropy(GGX)\r\n#if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\r\nfloat D_GGX_Anisotropic(float at, float ab, float ToH, float BoH, float NoH) {\r\n    // Burley 2012, "Physically-Based Shading at Disney"\r\n\r\n    // The values at and ab are perceptualRoughness^2, a2 is therefore perceptualRoughness^4\r\n    // The dot product below computes perceptualRoughness^8. We cannot fit in fp16 without clamping\r\n    // the roughness to too high values so we perform the dot product and the division in fp32\r\n    float a2 = at * ab;\r\n    vec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\r\n    float v2 = dot(v, v);\r\n    float w2 = a2 / v2;\r\n    return a2 * w2 * w2 * (1.0 / PI);\r\n}\r\n\r\nfloat V_SmithGGXCorrelated_Anisotropic(float at, float ab, float ToV, float BoV, float ToL, float BoL, float NoV, float NoL) {\r\n    // Heitz 2014, "Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs"\r\n    // TODO: lambdaV can be pre-computed for all the lights, it should be moved out of this function\r\n    float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\r\n    float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\r\n    float v = 0.5 / (lambdaV + lambdaL);\r\n    return v;\r\n}\r\n\r\nvec3 anisotropicLobe(vec3 precomputeGGX, vec3 H, vec3 viewDir, vec3 lightDir, float NoH, float VoH, float NoL, vec3 specular, float f90, in vec3 anisotropicT, in vec3 anisotropicB, in float anisotropy) {\r\n    float roughness = precomputeGGX.x;\r\n    float NoV =  precomputeGGX.z;\r\n\r\n    float ToV = dot(anisotropicT, viewDir);\r\n    float BoV = dot(anisotropicB, viewDir);\r\n    float ToL = dot(anisotropicT, lightDir);\r\n    float BoL = dot(anisotropicB, lightDir);\r\n    float ToH = dot(anisotropicT, H);\r\n    float BoH = dot(anisotropicB, H);\r\n\r\n    // Anisotropic parameters: at and ab are the roughness along the tangent and bitangent\r\n    // to simplify materials, we derive them from a single roughness parameter\r\n    // Kulla 2017, "Revisiting Physically Based Shading at Imageworks"\r\n    float at = max(roughness * (1.0 + anisotropy), MIN_ROUGHNESS);\r\n    float ab = max(roughness * (1.0 - anisotropy), MIN_ROUGHNESS);\r\n\r\n    // Specular anisotropic BRDF\r\n    float D = D_GGX_Anisotropic(at, ab, ToH, BoH, NoH);\r\n    float V = V_SmithGGXCorrelated_Anisotropic(at, ab, ToV, BoV, ToL, BoL, NoV, NoL);\r\n    vec3 F = Specular_F(VoH, specular, f90);\r\n\r\n    return (D * V) * F;\r\n}\r\n\r\nvoid anisotropicSurfaceShading(vec3 normal, vec3 viewDir, float NoL, vec3 precomputeLight, vec3 diffuse, vec3 specular, float attenuation, vec3 lightColor, vec3 lightDir, float f90, vec3 anisotropicT, vec3 anisotropicB, float anisotropy, out vec3 diffuseOut, out vec3 specularOut, out bool lighted) {\r\n    lighted = NoL > 0.0;\r\n    if (!lighted) {\r\n        specularOut = diffuseOut = vec3(0.0);\r\n        return;\r\n    }\r\n    vec3 H = normalize(viewDir + lightDir);\r\n    float NoH =  saturate(dot(normal, H));\r\n    float VoH =  saturate(dot(viewDir, H));\r\n\r\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\r\n    diffuseOut = colorAttenuate * diffuseLobe(precomputeLight, diffuse, NoL, VoH);\r\n    specularOut = colorAttenuate * anisotropicLobe(precomputeLight, H, viewDir, lightDir, NoH, VoH, NoL, specular, f90, anisotropicT, anisotropicB, anisotropy);\r\n}\r\n#endif',te="float pow5(float x) {\r\n\tfloat xx = x * x;\r\n\treturn xx * xx * x;\r\n}\r\n\r\n// http://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/\r\nmat3 rotationMatrix3(vec3 axis, float angle) {\r\n\taxis = normalize(axis);\r\n\tfloat s = sin(angle);\r\n\tfloat c = cos(angle);\r\n\tfloat oc = 1.0 - c;\r\n\treturn mat3(oc * axis.x * axis.x + c,\r\n                oc * axis.x * axis.y - axis.z * s,\r\n                oc * axis.z * axis.x + axis.y * s,\r\n\t\t\t\toc * axis.x * axis.y + axis.z * s,\r\n                oc * axis.y * axis.y + c,\r\n                oc * axis.y * axis.z - axis.x * s,\r\n                oc * axis.z * axis.x - axis.y * s,\r\n                oc * axis.y * axis.z + axis.x * s,\r\n                oc * axis.z * axis.z + c);\r\n}",re="// Shadow\r\nuniform bool receiveShadow;\r\n#ifdef USE_SHADOWMAP\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\r\n        struct DirectionalLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t};\r\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\r\n        \r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\r\n\t#endif\r\n\t\r\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare, float shadowDistance) {\r\n        vec2 centroidCoord = uv / size;\r\n        centroidCoord = centroidCoord + 0.5;\r\n        vec2 f = fract(centroidCoord);\r\n\r\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\r\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\r\n\r\n        vec4 fetches;\r\n        const vec2 offset = vec2( 0.0, 1.0 );\r\n        fetches.x = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xx ));\r\n        fetches.y = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xy ));\r\n        fetches.z = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yx ));\r\n        fetches.w = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yy ));\r\n\r\n        // Shadow distance\r\n        float _a = mix(fetches.x, fetches.y, f.y);\r\n        float _b = mix(fetches.z, fetches.w, f.y);\r\n        shadowDistance = mix(_a, _b, f.x);\r\n\r\n\t\tvec4 st = step(fetches, vec4(0.0));\r\n\r\n        float a = mix(st.x, st.y, f.y);\r\n        float b = mix(st.z, st.w, f.y);\r\n        return mix(a, b, f.x);\r\n\t}\r\n\r\n\tfloat getShadow(bool lighted, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, out float shadowDistance ) {\r\n        bool earlyOut = false;\r\n        float shadow = 1.0;\r\n\r\n        if (!lighted){\r\n            shadow = 0.0;\r\n            earlyOut = true;\r\n        }\r\n\r\n        if(uShadowDepthRange.x == uShadowDepthRange.y){\r\n            earlyOut = true;\r\n        }\r\n\r\n        if (!earlyOut) {\r\n            shadowCoord.xyz /= shadowCoord.w;\r\n            shadowCoord.z += shadowBias;\r\n            // if ( something && something ) breaks ATI OpenGL shader compiler\r\n            // if ( all( something, something ) ) using this instead\r\n            bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n            bool inFrustum = all( inFrustumVec );\r\n            bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n            bool frustumTest = all( frustumTestVec );\r\n            if ( frustumTest ) {\r\n                vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n                // TODO: Shadow jitter\r\n                float res = texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z, shadowDistance);\r\n                shadow = res;\r\n            }\r\n        }\r\n\t\treturn shadow;\r\n\t}\r\n#endif",ae="// Light\r\n// DirectionalLight\r\n#if NUM_DIR_LIGHTS > 0\r\n\tstruct DirectionalLight {\r\n\t\tvec3 direction;\r\n\t\tvec3 color;\r\n\t\tbool visible;\r\n\t};\r\n\r\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n\r\n    void precomputeDirect(vec3 normal, vec3 viewDir, inout DirectionalLight directionalLight, out float attenuation, out vec3 lightDir, out float NoL) {\r\n        attenuation = 1.0;\r\n        lightDir = directionalLight.direction;\r\n        NoL = dot(normal, lightDir);\r\n\t\tdirectionalLight.visible = true;\r\n    }\r\n#endif\r\n// Todo: Spot/Point Light",ie="#preImport <isotropyLightCompute>\r\n#preImport <anisotropyLightCompute>",oe="// IBL\r\n#preImport <precomputeLight>\r\n#preImport <computeDiffuseSPH>\r\n\r\n#ifdef PANORAMA\r\n    #preImport <panoramaSampler>\r\n#endif\r\n\r\nvec3 integrateBRDF(vec3 materialSpecular, float roughness, float NoV) {\r\n    vec4 rgba = texture2D(uIntegrateBRDF, vec2(NoV, roughness));\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0) / 65535.0;\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0) / 65535.0;\r\n    return (1.-materialSpecular) * a + materialSpecular * b;\r\n}\r\n\r\n// frostbite, lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap(float roughnessLinear){\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\nvec3 prefilterEnvMap(float rLinear, vec3 R) {\r\n    vec3 dir = R;\r\n    float lod = linRoughnessToMipmap(rLinear) * uEnvironmentLodRange[1]; //(uEnvironmentMaxLod - 1.0);\r\n    lod = min(uEnvironmentLodRange[0], lod);\r\n#ifdef CUBEMAP_LOD\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / uEnvironmentSize[0];\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n    // cubemapSeamlessFixDirection\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\treturn LogLuvToLinear(textureCubeLodEXT(envMap, dir, lod)).rgb;\r\n#else\r\n    return LogLuvToLinear(panoramaSampler(envMap, uEnvironmentSize, R, lod, uEnvironmentLodRange[0])).rgb;\r\n\t#endif\r\n}\r\n\r\n// Anisotropic\r\n#if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\r\nvec3 computeAnisotropicBentNormal(vec3 normal, vec3 viewDir, float roughness, vec3 anisotropicT, vec3 anisotropicB, float anisotropy) {\r\n    vec3 anisotropyDirection = anisotropy >= 0.0 ? anisotropicB : anisotropicT;\r\n    vec3 anisotropicTangent = cross(anisotropyDirection, viewDir);\r\n    vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);\r\n    float bendFactor = abs(anisotropy) * clamp(5.0 * roughness, 0.0, 1.0);\r\n    vec3  bentNormal = normalize(mix(normal, anisotropicNormal, bendFactor));\r\n    return bentNormal;\r\n}\r\n#endif\r\n\r\n// From Sebastien Lagarde Moving Frostbite to PBR page 69\r\n// We have a better approximation of the off specular peak\r\n// but due to the other approximations we found this one performs better.\r\n// N is the normal direction\r\n// R is the mirror vector\r\n// This approximation works fine for G smith correlated and uncorrelated\r\nvec3 getSpecularDominantDir(vec3 N, vec3 R, float realRoughness) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * (sqrt(smoothness) + realRoughness);\r\n    return mix(N, R, lerpFactor);\r\n}\r\n\r\nvec3 getPrefilteredEnvMapColor(vec3 normal, vec3 viewDir, float roughness) {\r\n    vec3 R = reflect(-viewDir, normal);\r\n    // From Sebastien Lagarde Moving Frostbite to PBR page 69\r\n    vec3 dominantR = getSpecularDominantDir(normal, R, roughness * roughness);\r\n    vec3 dir = uEnvironmentTransform * dominantR;\r\n    vec3 prefilteredColor = prefilterEnvMap(roughness, dir);\r\n\r\n    return prefilteredColor;\r\n}\r\n\r\nvec3 computeIBLSpecularUE4(vec3 specularDFG, vec3 normal, vec3 viewDir, float roughness) {\r\n    return getPrefilteredEnvMapColor(normal, viewDir, roughness) * specularDFG;\r\n}",se=" // ClearCoat\r\n#ifdef ENABLE_CLEARCOAT\r\nvoid computeClearCoatIBL(float clearCoatNoV, vec3 clearCoatNormal, float clearCoatPerceptualRoughness, vec3 viewDir, float specularAO, inout vec3 Fd, inout vec3 Fr){\r\n    // The clear coat layer assumes an IOR of 1.5 (4% reflectance)\r\n    vec3 materialSpecular = vec3(0.04);\r\n    float materialF90 = 1.0;\r\n    float Fc = F_Schlick(clearCoatNoV, materialSpecular.x, materialF90) * uClearCoat;\r\n    float attenuation = 1.0 - Fc;\r\n    Fd *= attenuation;\r\n    Fr *= attenuation;\r\n\r\n    vec3 specularDFG = integrateBRDF(materialSpecular, clearCoatPerceptualRoughness, clearCoatNoV);\r\n    vec3 clearCoatLobe = computeIBLSpecularUE4(specularDFG, clearCoatNormal, viewDir, clearCoatPerceptualRoughness);\r\n    Fr += clearCoatLobe * (specularAO * uClearCoat);\r\n}\r\n\r\nfloat distributionClearCoat(float roughness, float NoH, const vec3 h) {\r\n    return D_GGX(roughness, NoH);\r\n}\r\n\r\nfloat visibilityClearCoat(float LoH) {\r\n    return Vis_Kelemen(LoH);\r\n}\r\n\r\nfloat clearCoatLobe(vec3 h, float clearCoatNoH, float clearCoatLoH, float clearCoatRoughness, out float Fcc){\r\n    // clear coat specular lobe\r\n    float D = distributionClearCoat(clearCoatRoughness, clearCoatNoH, h);\r\n    float V = visibilityClearCoat(clearCoatLoH);\r\n    float F = F_Schlick(clearCoatLoH, 0.04, 1.0) * uClearCoat; // fix IOR to 1.5\r\n\r\n    Fcc = F;\r\n    return D * V * F;\r\n}\r\n#endif",le='#ifdef ENERGY_COMPENSATION\r\nfloat getEnergyCompensation(vec3 dfg, float f0) {\r\n   return 1.0 + f0 * (1.0 / dfg.y - 1.0);\r\n}\r\n#endif\r\n\r\n#ifdef SPECULAR_AO_MARMOSETCO\r\n// http://marmosetco.tumblr.com/post/81245981087\r\nfloat occlusionHorizon(float ao, vec3 normal, vec3 viewDir) {\r\n    float d = dot(normal, viewDir) + ao;\r\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n#ifdef SPECULAR_AO_SEBLAGARDE\r\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat computeSpecularAO(float ao, vec3 precomputeLight) {\r\n    float roughness = precomputeLight.x;\r\n    float NoV =  precomputeLight.z;\r\n    return clamp(pow(NoV + ao, exp2(-16.0 * roughness - 1.0)) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n/**\r\n* Returns a color ambient occlusion based on a pre-computed visibility term.\r\n* The albedo term is meant to be the diffuse color or f0 for the diffuse and\r\n* specular terms respectively.\r\n*/\r\nvec3 gtaoMultiBounce(float visibility, const vec3 albedo) {\r\n    // Jimenez et al. 2016, "Practical Realtime Strategies for Accurate Indirect Occlusion"\r\n    vec3 a =  2.0404 * albedo - 0.3324;\r\n    vec3 b = -4.7951 * albedo + 0.6417;\r\n    vec3 c =  2.7552 * albedo + 0.6903;\r\n\r\n    return max(vec3(visibility), ((visibility * a + b) * visibility + c) * visibility);\r\n}\r\n#ifdef MS_DIFFUSE_AO\r\nvoid multiBounceAO(float visibility, const vec3 albedo, inout vec3 color) {\r\n    color *= gtaoMultiBounce(visibility, albedo);\r\n}\r\n#endif\r\n\r\n#ifdef MS_SPECULAR_AO\r\nvoid multiBounceSpecularAO(float visibility, const vec3 albedo, inout vec3 color) {\r\n    color *= gtaoMultiBounce(visibility, albedo);\r\n}\r\n#endif\r\n\r\n#ifdef GEOMETRIC_SPECULAR_AA\r\nfloat normalFiltering(float perceptualRoughness, const vec3 geometricNormal) {\r\n    // Kaplanyan 2016, "Stable specular highlights"\r\n    // Tokuyoshi 2017, "Error Reduction and Simplification for Shading Anti-Aliasing"\r\n    // Tokuyoshi and Kaplanyan 2019, "Improved Geometric Specular Antialiasing"\r\n\r\n    // This implementation is meant for deferred rendering in the original paper but\r\n    // we use it in forward rendering as well (as discussed in Tokuyoshi and Kaplanyan\r\n    // 2019). The main reason is that the forward version requires an expensive transform\r\n    // of the half vector by the tangent frame for every light. This is therefore an\r\n    // approximation but it works well enough for our needs and provides an improvement\r\n    // over our original implementation based on Vlachos 2015, "Advanced VR Rendering".\r\n\r\n    vec3 du = dFdx(geometricNormal);\r\n    vec3 dv = dFdy(geometricNormal);\r\n\r\n    float variance = uSpecularAAVariance * (dot(du, du) + dot(dv, dv));\r\n\r\n    float roughness = perceptualRoughness * perceptualRoughness;\r\n    float kernelRoughness = min(2.0 * variance, uSpecularAAThreshold);\r\n    float squareRoughness = saturate(roughness * roughness + kernelRoughness);\r\n\r\n    return sqrt(sqrt(squareRoughness));\r\n}\r\n#endif',ue={computeDiffuseSPH:q,integrateBRDFMobile:Z,panoramaSampler:J,precomputeLight:$,isotropyLightCompute:ee,anisotropyLightCompute:ne,math:te,shadow:re,light:ae,brdf:ie,ibl:oe,clearCoat:se,advance:le},ce="uniform mat3 uModelNormalMatrix;\r\nvarying vec3 vViewPosition;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vWorldNormal;\r\n\r\n#ifdef USE_TANGENT\r\n\tvarying vec3 vTangent;\r\n\tvarying vec3 vBitangent;\r\n#endif\r\n\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n\r\nvoid main(){\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n    #include <color_vertex>\r\n    #include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n\tvNormal = normalize(transformedNormal);\r\n\tvWorldNormal = uModelNormalMatrix * objectNormal;\r\n\r\n\t#ifdef USE_TANGENT\r\n\t\tvTangent = normalize(transformedTangent);\r\n\t\tvBitangent = normalize(cross(vNormal, vTangent) * tangent.w);\r\n\t#endif\r\n\r\n    #include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <project_vertex>\r\n\r\n    vViewPosition = mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <shadowmap_vertex>\r\n}\r\n",de="// refer: \r\n// https://github.com/cedricpinson/osgjs\r\n// https://google.github.io/filament/Filament.html\r\n\r\nuniform mat3 uEnvironmentTransform;\r\nuniform float uEnvBrightness;\r\nuniform vec3 uEnvironmentSphericalHarmonics[9];\r\nuniform sampler2D uIntegrateBRDF;\r\n\r\nconst float MIN_ROUGHNESS = 0.001;\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float roughness;\r\nuniform float metalness;\r\nuniform float opacity;\r\nuniform vec2 uShadowDepthRange;\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#ifdef GEOMETRIC_SPECULAR_AA\r\nuniform float uSpecularAAThreshold;\r\nuniform float uSpecularAAVariance;\r\n#endif\r\n\r\n// Anisotropy\r\n#if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\r\nuniform float uAnisotropyRotation;\r\nuniform float uAnisotropyFactor;\r\n#endif\r\n\r\n// ClearCoat\r\n#ifdef ENABLE_CLEARCOAT\r\nuniform float uClearCoat;\r\nuniform float uClearCoatRoughness;\r\n#endif\r\n\r\n#ifdef CUBEMAP_LOD\r\nuniform samplerCube envMap;\r\n#endif\r\n#ifdef PANORAMA\r\nuniform sampler2D envMap;\r\n#endif\r\nuniform vec2 uEnvironmentSize;\r\nuniform vec2 uEnvironmentLodRange;\r\n\r\n#ifdef SPECULAR_GLOSSINESS\r\n    uniform vec3 specularFactor;\r\n    uniform float glossinessFactor;\r\n    #ifdef USE_SPECULARMAP\r\n\t    uniform sampler2D specularMap;\r\n    #endif\r\n    #ifdef USE_GLOSSINESSMAP\r\n\t    uniform sampler2D glossinessMap;\r\n    #endif\r\n#endif\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vWorldNormal;\r\n#ifdef USE_TANGENT\r\n    varying vec3 vTangent;\r\n    varying vec3 vBitangent;\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <roughnessmap_pars_fragment>\r\n#include <metalnessmap_pars_fragment>\r\n#include <packing>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\n#preImport <math>\r\n#preImport <shadow>\r\n#preImport <light>\r\n#preImport <ibl>\r\n#preImport <brdf>\r\n#preImport <advance>\r\n#preImport <clearCoat>\r\n\r\nvoid main(){\r\n    vec3 viewDir = -normalize(vViewPosition);\r\n\r\n    vec4 diffuseColor = vec4(diffuse, opacity);\r\n    vec3 totalEmissiveRadiance = emissive;\r\n    #include <logdepthbuf_fragment>\r\n    #include <color_fragment>\r\n    #include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n    #include <map_fragment>\r\n    #include <emissivemap_fragment>\r\n\r\n    float roughnessVal;\r\n    #ifdef SPECULAR_GLOSSINESS\r\n        roughnessVal = glossinessFactor;\r\n        #ifdef USE_GLOSSINESSMAP\r\n            roughnessVal = texture2D(glossinessMap, vUv).a * glossinessFactor;\r\n        #endif\r\n        roughnessVal = 1.0 - roughnessVal;\r\n    #else\r\n        #include <roughnessmap_fragment>\r\n        roughnessVal = roughnessFactor;\r\n    #endif\r\n\r\n    vec3 materialSpecular;\r\n    vec3 materialDiffuse = diffuseColor.rgb;\r\n    #ifdef SPECULAR_GLOSSINESS\r\n        materialSpecular = specularFactor;\r\n        #ifdef USE_SPECULARMAP\r\n            materialSpecular = sRGBToLinear(texture2D(specularMap, vUv)).rgb * specularFactor;\r\n        #endif\r\n    #else\r\n        #include <metalnessmap_fragment>\r\n        float f0 = 0.04;\r\n        materialSpecular = mix(vec3(f0), diffuseColor.rgb, metalnessFactor);\r\n        // materialSpecular = 0.16 * reflectance * reflectance * (1.0 - metallic) + baseColor * metallic;\r\n        materialDiffuse = diffuseColor.rgb * (1.0 - metalnessFactor);\r\n    #endif\r\n\r\n    float materialF90 = 1.0;\r\n    #ifndef MOBILE\r\n    materialF90 = saturate(dot(materialSpecular, vec3(50.0 * 0.33)));\r\n    // cheap luminance approximation\r\n    // materialF90 = saturate(50.0 * materialSpecular.g);\r\n    #endif\r\n\r\n    // Roughness\r\n    float materialRoughness = clamp(roughnessVal, MIN_ROUGHNESS, 1.0);\r\n    #ifdef GEOMETRIC_SPECULAR_AA\r\n    materialRoughness = normalFiltering(materialRoughness, geometryNormal);\r\n    #endif\r\n\r\n    vec3 prepCompute = precomputeLight(normal, viewDir, max(0.045, materialRoughness));\r\n\r\n    // Anisotropy\r\n    vec3 bentAnisotropicNormal = normal;\r\n    #if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\r\n        float anisotropy = uAnisotropyFactor;\r\n        vec3 anisotropicT = normalize(vTangent.xyz);\r\n        vec3 anisotropicB = normalize(vBitangent.xyz);\r\n        // Change direction\r\n        mat3 anisotropyRotationMatrix = rotationMatrix3(normal, uAnisotropyRotation);\r\n        anisotropicB *= anisotropyRotationMatrix;\r\n        anisotropicT *= anisotropyRotationMatrix;\r\n        bentAnisotropicNormal = computeAnisotropicBentNormal(normal, viewDir, materialRoughness, anisotropicT, anisotropicB, anisotropy);\r\n\t#endif\r\n\r\n    // IBL\r\n    float NoV = dot(bentAnisotropicNormal, viewDir);\r\n    vec3 transformedNormal = uEnvironmentTransform * bentAnisotropicNormal;\r\n    vec3 diffuseIBL = materialDiffuse * computeDiffuseSPH(transformedNormal, uEnvironmentSphericalHarmonics);\r\n    vec3 specularDFG = integrateBRDF(materialSpecular, materialRoughness, NoV);\r\n    vec3 specularIBL = computeIBLSpecularUE4(specularDFG, bentAnisotropicNormal, viewDir, materialRoughness);\r\n    \r\n    // Diffuse AO\r\n    float materialAO = 1.0;\r\n    #ifdef USE_AOMAP\r\n\tmaterialAO = (texture2D(aoMap, vUv2).r - 1.0) * aoMapIntensity + 1.0;\r\n    #endif\r\n    #ifdef MS_DIFFUSE_AO\r\n    multiBounceAO(materialAO, materialDiffuse, diffuseIBL);\r\n    #else\r\n    diffuseIBL *= materialAO;\r\n    #endif\r\n    diffuseIBL *= uEnvBrightness;\r\n    \r\n    // Specular AO\r\n    float specularAO = 1.0;\r\n    #ifdef SPECULAR_AO_SEBLAGARDE\r\n    specularAO = computeSpecularAO(materialAO, prepCompute);\r\n    #elif defined(SPECULAR_AO_MARMOSETCO)\r\n    specularAO = occlusionHorizon(materialAO, normal, viewDir);\r\n    #endif\r\n    float energyCompensation = 1.0;\r\n    #ifdef ENERGY_COMPENSATION\r\n    energyCompensation = getEnergyCompensation(specularDFG, materialSpecular.g);\r\n    #endif\r\n    #ifdef MS_SPECULAR_AO\r\n    multiBounceSpecularAO(materialAO, materialSpecular, specularIBL);\r\n    #endif\r\n\r\n    specularIBL *= uEnvBrightness * specularAO * energyCompensation;\r\n\r\n    // ClearCoat IBL\r\n    #ifdef ENABLE_CLEARCOAT\r\n    // Todo: ClearCoat normalMap\r\n    // Use the geometric normal for the clear coat layer\r\n    float clearCoatNoV = prepCompute.z;\r\n    vec3 clearCoatNormal = geometryNormal;\r\n    float clearCoatPerceptualRoughness = clamp(uClearCoatRoughness, MIN_ROUGHNESS, 1.0);\r\n    #ifdef GEOMETRIC_SPECULAR_AA\r\n    clearCoatPerceptualRoughness = normalFiltering(materialRoughness, geometryNormal);\r\n    #endif\r\n    float clearCoatRoughness = clearCoatPerceptualRoughness * clearCoatPerceptualRoughness;\r\n    computeClearCoatIBL(clearCoatNoV, clearCoatNormal, clearCoatPerceptualRoughness, viewDir, specularAO, diffuseIBL, specularIBL);\r\n    #endif\r\n\r\n    // Light\r\n    float attenuation, NoL;\r\n    vec3 lightDir;\r\n    vec3 lightSpecular;\r\n    vec3 lightDiffuse;\r\n    vec3 resultLightSpecular;\r\n    vec3 resultLightDiffuse;\r\n    float resultLightClearCoat = 0.;\r\n    bool lighted;\r\n    float shadow = 1.0;\r\n    float shadowDistance;\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n        DirectionalLight directionalLight;\r\n        #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\r\n        DirectionalLightShadow directionalLightShadow;\r\n        #endif\r\n        #pragma unroll_loop_start\r\n\t    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            directionalLight = directionalLights[ i ];\r\n            precomputeDirect(normal, viewDir, directionalLight, attenuation, lightDir, NoL);\r\n            // Todo: combine methods\r\n            #if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\r\n            anisotropicSurfaceShading(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, directionalLights[ i ].color, lightDir, materialF90, anisotropicT, anisotropicB, anisotropy, lightDiffuse, lightSpecular, lighted);\r\n            #else\r\n            surfaceShading(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, directionalLights[ i ].color, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\r\n            #endif\r\n            // ClearCoat\r\n            #ifdef ENABLE_CLEARCOAT\r\n            vec3 H = normalize(viewDir + lightDir);\r\n            // Todo: ClearCoat normalMap\r\n            float clearCoatNoH =  saturate(dot(clearCoatNormal, H));\r\n            float clearCoatLoH =  saturate(dot(lightDir, H));\r\n            float Fcc;\r\n            float clearCoat = clearCoatLobe(H, clearCoatNoH, clearCoatLoH, clearCoatRoughness, Fcc);\r\n            float clearCoatAttenuation = 1.0 - Fcc;\r\n\r\n            lightDiffuse *= clearCoatAttenuation;\r\n            lightSpecular *= energyCompensation * clearCoatAttenuation;\r\n            resultLightClearCoat += clearCoat;\r\n            #else\r\n            lightSpecular *= energyCompensation;\r\n            #endif\r\n            \r\n            // Shadow\r\n            // Mobile texture unit too little! \r\n            #if !defined( MOBILE ) && defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\r\n            directionalLightShadow = directionalLightShadows[ i ];\r\n            shadow *= all( bvec2( directionalLight.visible, receiveShadow ) ) ? getShadow( lighted, directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], shadowDistance ) : 1.0;\r\n            lightDiffuse *= shadow;\r\n            lightSpecular *= shadow;\r\n            #endif\r\n\r\n            resultLightDiffuse += lightDiffuse;\r\n            resultLightSpecular += lightSpecular;\r\n        }\r\n        #pragma unroll_loop_end\r\n    #endif\r\n    // Todo: Spot/Point Light\r\n\r\n    // Test\r\n    #ifndef ENABLE_IBL\r\n        diffuseIBL = vec3(0.);\r\n        specularIBL = vec3(0.);\r\n    #endif\r\n    #ifndef ENABLE_LIGHT\r\n        resultLightDiffuse = vec3(0.);\r\n        resultLightSpecular = vec3(0.);\r\n    #endif\r\n\r\n    vec3 resultDiffuse = diffuseIBL + resultLightDiffuse;\r\n    vec3 resultSpecular = specularIBL + resultLightSpecular;\r\n\r\n    vec3 totalResult = resultDiffuse + resultSpecular + totalEmissiveRadiance + resultLightClearCoat;\r\n    vec4 frag = vec4(totalResult, diffuseColor.a);\r\n    gl_FragColor = frag;\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n}",fe=function(){function e(){Object(o["a"])(this,e),this.includePattern=/^[ \t]*#preImport +<([\w\d./]+)>/gm}return Object(s["a"])(e,[{key:"getPBRShader",value:function(){var e=this.preParseShader(ce),n=this.preParseShader(de);return{pbrVS:e,pbrFS:n}}},{key:"preParseShader",value:function(e){var n=this,t=function(e,t){var r=ue[t];if(void 0===r)throw new Error("Can not resolve #preImport <"+t+">");return n.preParseShader(r)};return e.replace(this.includePattern,t)}}]),e}(),pe="./assets/envMap/",he=["Arches","Alexs","GCanyon","Industrial","Milkyway","Outside","PaperMill","Royal","TropicalRuins","Venice"],me=["Lambert","Burley","OrenNayar","Gotanda","None"],ge=["Schlick","CookTorrance","None"],ve=["GGX","BlinnPhong","Beckmann"],_e=["SmithJointApprox","Implicit","Neumann","Kelemen","Schlick","Smith","HammonApprox"],Ae=["ACESFilmic","Linear","Reinhard","Uncharted2","Cineon","No"],xe=["Seblagarde","Marmosetco","None"],be=/(ENABLE_IBL)|(ENABLE_LIGHT)|(ENABLE_ANISOTROPY)|(ENABLE_CLEARCOAT)|(ENERGY_COMPENSATION)|(DIFFUSE_*)|(F_*)|(NDF_*)|(V_*)|(SPECULAR_AO_*)|(GEOMETRIC_SPECULAR_AA)|(MS_SPECULAR_AO)|(MS_DIFFUSE_AO)/;function ye(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=(new l["Box3"]).setFromObject(n),i=a.getSize(new l["Vector3"]),o=Math.max(i.x,i.y,i.z),s=o/(2*Math.atan(Math.PI*e.fov/360)),u=s/e.aspect,c=r*Math.max(s,u);return e.near=c/100,e.far=100*c,e.position.set(0,c/4,c),e.updateProjectionMatrix(),t&&(t.maxDistance=20*c,t.update()),c}function Ee(e,n,t,r){var a=(new l["Box3"]).setFromObject(t);e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024;var i=e.shadow.camera;i.position.copy(e.position),i.lookAt(new l["Vector3"](0,0,0)),i.position.set(0,0,0),i.updateMatrixWorld(!0);var o=new l["Matrix4"];if(o.getInverse(i.matrixWorld),a.applyMatrix4(o),i.left=a.min.x-.01,i.right=a.max.x+.01,i.top=a.min.y-.01,i.bottom=a.max.y+.01,i.near=-a.max.z-.01,i.far=.01-a.min.z,i.updateProjectionMatrix(),e.shadow.bias=-.01,r){var s=new l["DirectionalLightHelper"](e,5,16777215);n.add(s);var u=new l["CameraHelper"](i);n.add(u)}}t("c975"),t("4795");function Te(e){var n;return n=e.currentStyle?e.currentStyle.width:getComputedStyle(e,!1).width,~n.indexOf("px")&&(n=n.slice(0,-2)),n}function Se(e){var n;return n=e.currentStyle?e.currentStyle.height:getComputedStyle(e,!1).height,~n.indexOf("px")&&(n=n.slice(0,-2)),n}function Fe(){var e=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent);return e||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent)}t("13d5"),t("a434");var Le=t("b85c"),Ne=new l["Camera"],Pe=null;function we(){if(null===Pe){var e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),n=new Float32Array([0,0,2,0,0,2]);Pe=new l["BufferGeometry"],void 0!==Pe.setAttribute?(Pe.setAttribute("position",new l["BufferAttribute"](e,3)),Pe.setAttribute("uv",new l["BufferAttribute"](n,2))):(Pe.addAttribute("position",new l["BufferAttribute"](e,3)),Pe.addAttribute("uv",new l["BufferAttribute"](n,2)))}return Pe}var Re=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l["Scene"],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ne;Object(o["a"])(this,e),this.name=n,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}return Object(s["a"])(e,[{key:"getFullscreenMaterial",value:function(){return null!==this.screen?this.screen.material:null}},{key:"setFullscreenMaterial",value:function(e){var n=this.screen;null!==n?n.material=e:(n=new l["Mesh"](we(),e),n.frustumCulled=!1,null===this.scene&&(this.scene=new l["Scene"]),this.scene.add(n),this.screen=n)}},{key:"getDepthTexture",value:function(){return null}},{key:"setDepthTexture",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"render",value:function(e,n,t,r,a){throw new Error("Render method not implemented!")}},{key:"setSize",value:function(e,n){}},{key:"initialize",value:function(e,n,t){}},{key:"dispose",value:function(){var e=this.getFullscreenMaterial();null!==e&&e.dispose();for(var n=0,t=Object.keys(this);n<t.length;n++){var r=t[n];null!==this[r]&&"function"===typeof this[r].dispose&&this[r].dispose()}}},{key:"renderToScreen",get:function(){return!this.rtt},set:function(e){if(this.rtt===e){var n=this.getFullscreenMaterial();null!==n&&(n.needsUpdate=!0),this.rtt=!e}}}]),e}(),Oe=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(){var e;return Object(o["a"])(this,t),e=n.call(this,"ClearMaskPass",null,null),e.needsSwap=!1,e}return Object(s["a"])(t,[{key:"render",value:function(e,n,t,r,a){var i=e.state.buffers.stencil;i.setLocked(!1),i.setTest(!1)}}]),t}(Re),Me=new l["Color"],Ce=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(){var e,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(o["a"])(this,t),e=n.call(this,"ClearPass",null,null),e.needsSwap=!1,e.color=r,e.depth=a,e.stencil=i,e.overrideClearColor=null,e.overrideClearAlpha=-1,e}return Object(s["a"])(t,[{key:"render",value:function(e,n,t,r,a){var i=this.overrideClearColor,o=this.overrideClearAlpha,s=e.getClearAlpha(),l=null!==i,u=o>=0;l?(Me.copy(e.getClearColor()),e.setClearColor(i,u?o:s)):u&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:n),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Me,s):u&&e.setClearAlpha(s)}}]),t}(Re),Ie=t("257e"),Ue=-1,De=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ue,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ue;Object(o["a"])(this,e),this.resizable=n,this.base=new l["Vector2"](1,1),this.target=new l["Vector2"](t,r),this.scale=1}return Object(s["a"])(e,[{key:"width",get:function(){var e,n=this.base,t=this.target;return e=t.x!==Ue?t.x:t.y!==Ue?Math.round(t.y*(n.x/n.y)):Math.round(n.x*this.scale),e},set:function(e){this.target.x=e,this.resizable.setSize(this.base.x,this.base.y)}},{key:"height",get:function(){var e,n=this.base,t=this.target;return e=t.y!==Ue?t.y:t.x!==Ue?Math.round(t.x/(n.x/n.y)):Math.round(n.y*this.scale),e},set:function(e){this.target.y=e,this.resizable.setSize(this.base.x,this.base.y)}}],[{key:"AUTO_SIZE",get:function(){return Ue}}]),e}(),ke=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(o["a"])(this,t),a=n.call(this,"RenderPass",e,r),a.needsSwap=!1,a.overrideMaterial=i,a.clearPass=new Ce,a.depthTexture=null,a}return Object(s["a"])(t,[{key:"getClearPass",value:function(){return this.clearPass}},{key:"getDepthTexture",value:function(){return this.depthTexture}},{key:"setDepthTexture",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.depthTexture=e}},{key:"render",value:function(e,n,t,r,a){var i=this.scene,o=this.renderToScreen?null:n,s=i.overrideMaterial;null===this.depthTexture||this.renderToScreen||(n.depthTexture=this.depthTexture,t.depthTexture=null),this.clear&&(this.clearPass.renderToScreen=this.renderToScreen,this.clearPass.render(e,n)),i.overrideMaterial=this.overrideMaterial,e.setRenderTarget(o),e.render(i,this.camera),i.overrideMaterial=s}},{key:"clear",get:function(){return this.clearPass.enabled},set:function(e){this.clearPass.enabled=e}}]),t}(Re),Be=(t("a630"),t("4e82"),t("4d63"),t("25f0"),t("6062"),t("498a"),t("45eb")),He=t("7e84"),Xe={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},Ve="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn min(x + y, 1.0) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",Ge="vec3 blend(const in vec3 x, const in vec3 y, const in float opacity) {\r\n\r\n\treturn y * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tfloat a = min(y.a, opacity);\r\n\r\n\treturn vec4(blend(x.rgb, y.rgb, a), max(x.a, a));\r\n\r\n}\r\n",je="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn (x + y) * 0.5 * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",Ye="float blend(const in float x, const in float y) {\r\n\r\n\treturn (y == 0.0) ? y : max(1.0 - (1.0 - x) / y, 0.0);\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tvec4 z = vec4(blend(x.r, y.r), blend(x.g, y.g), blend(x.b, y.b), blend(x.a, y.a));\r\n\r\n\treturn z * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",ze="float blend(const in float x, const in float y) {\r\n\r\n\treturn (y == 1.0) ? y : min(x / (1.0 - y), 1.0);\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tvec4 z = vec4(blend(x.r, y.r), blend(x.g, y.g), blend(x.b, y.b), blend(x.a, y.a));\r\n\r\n\treturn z * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",Qe="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn min(x, y) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",We="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn abs(x - y) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",Ke="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn (x + y - 2.0 * x * y) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",qe="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn max(x, y) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",Ze="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn x * y * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",Je="float blend(const in float x, const in float y) {\r\n\r\n\treturn (y > 0.0) ? min(x / y, 1.0) : 1.0;\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tvec4 z = vec4(blend(x.r, y.r), blend(x.g, y.g), blend(x.b, y.b), blend(x.a, y.a));\r\n\r\n\treturn z * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",$e="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn (1.0 - abs(1.0 - x - y)) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",en="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn y * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",nn="float blend(const in float x, const in float y) {\r\n\r\n\treturn (x < 0.5) ? (2.0 * x * y) : (1.0 - 2.0 * (1.0 - x) * (1.0 - y));\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tvec4 z = vec4(blend(x.r, y.r), blend(x.g, y.g), blend(x.b, y.b), blend(x.a, y.a));\r\n\r\n\treturn z * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",tn="float blend(const in float x, const in float y) {\r\n\r\n\treturn (y == 1.0) ? y : min(x * x / (1.0 - y), 1.0);\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tvec4 z = vec4(blend(x.r, y.r), blend(x.g, y.g), blend(x.b, y.b), blend(x.a, y.a));\r\n\r\n\treturn z * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",rn="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn (1.0 - (1.0 - x) * (1.0 - y)) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",an="float blend(const in float x, const in float y) {\r\n\r\n\treturn (y < 0.5) ?\r\n\t\t(2.0 * x * y + x * x * (1.0 - 2.0 * y)) :\r\n\t\t(sqrt(x) * (2.0 * y - 1.0) + 2.0 * x * (1.0 - y));\r\n\r\n}\r\n\r\nvec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\tvec4 z = vec4(blend(x.r, y.r), blend(x.g, y.g), blend(x.b, y.b), blend(x.a, y.a));\r\n\r\n\treturn z * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",on="vec4 blend(const in vec4 x, const in vec4 y, const in float opacity) {\r\n\r\n\treturn max(x + y - 1.0, 0.0) * opacity + x * (1.0 - opacity);\r\n\r\n}\r\n",sn=new Map([[Xe.SKIP,null],[Xe.ADD,Ve],[Xe.ALPHA,Ge],[Xe.AVERAGE,je],[Xe.COLOR_BURN,Ye],[Xe.COLOR_DODGE,ze],[Xe.DARKEN,Qe],[Xe.DIFFERENCE,We],[Xe.EXCLUSION,Ke],[Xe.LIGHTEN,qe],[Xe.MULTIPLY,Ze],[Xe.DIVIDE,Je],[Xe.NEGATION,$e],[Xe.NORMAL,en],[Xe.OVERLAY,nn],[Xe.REFLECT,tn],[Xe.SCREEN,rn],[Xe.SOFT_LIGHT,an],[Xe.SUBTRACT,on]]),ln=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(o["a"])(this,e),this.blendFunction=n,this.opacity=new l["Uniform"](t)}return Object(s["a"])(e,[{key:"getShaderCode",value:function(){return sn.get(this.blendFunction)}}]),e}(),un=function(){function e(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.attributes,i=void 0===a?cn.NONE:a,s=r.blendFunction,l=void 0===s?Xe.SCREEN:s,u=r.defines,c=void 0===u?new Map:u,d=r.uniforms,f=void 0===d?new Map:d,p=r.extensions,h=void 0===p?null:p,m=r.vertexShader,g=void 0===m?null:m;Object(o["a"])(this,e),this.name=n,this.attributes=i,this.fragmentShader=t,this.vertexShader=g,this.defines=c,this.uniforms=f,this.extensions=h,this.blendMode=new ln(l)}return Object(s["a"])(e,[{key:"setDepthTexture",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"update",value:function(e,n,t){}},{key:"setSize",value:function(e,n){}},{key:"initialize",value:function(e,n,t){}},{key:"dispose",value:function(){for(var e=0,n=Object.keys(this);e<n.length;e++){var t=n[e];null!==this[t]&&"function"===typeof this[t].dispose&&this[t].dispose()}}}]),e}(),cn={CONVOLUTION:2,DEPTH:1,NONE:0},dn="uniform sampler2D inputBuffer;\r\nuniform float opacity;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel = texture2D(inputBuffer, vUv);\r\n\tgl_FragColor = opacity * texel;\r\n\r\n\t#include <encodings_fragment>\r\n\r\n}\r\n",fn="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = position.xy * 0.5 + 0.5;\r\n\tgl_Position = vec4(position.xy, 1.0, 1.0);\r\n\r\n}\r\n",pn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(){var e;return Object(o["a"])(this,t),e=n.call(this,{type:"CopyMaterial",uniforms:{inputBuffer:new l["Uniform"](null),opacity:new l["Uniform"](1)},fragmentShader:dn,vertexShader:fn,depthWrite:!1,depthTest:!1}),e.toneMapped=!1,e}return t}(l["ShaderMaterial"]),hn=(t("a9e3"),t("b680"),"#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n\r\nuniform sampler2D inputBuffer;\r\n\r\n#ifdef GL_FRAGMENT_PRECISION_HIGH\r\n\r\n\tuniform highp sampler2D depthBuffer;\r\n\r\n#else\r\n\r\n\tuniform mediump sampler2D depthBuffer;\r\n\r\n#endif\r\n\r\nuniform vec2 resolution;\r\nuniform vec2 texelSize;\r\n\r\nuniform float cameraNear;\r\nuniform float cameraFar;\r\nuniform float aspect;\r\nuniform float time;\r\n\r\nvarying vec2 vUv;\r\n\r\nfloat readDepth(const in vec2 uv) {\r\n\r\n\t#if DEPTH_PACKING == 3201\r\n\r\n\t\treturn unpackRGBAToDepth(texture2D(depthBuffer, uv));\r\n\r\n\t#else\r\n\r\n\t\treturn texture2D(depthBuffer, uv).r;\r\n\r\n\t#endif\r\n\r\n}\r\n\r\nfloat getViewZ(const in float depth) {\r\n\r\n\t#ifdef PERSPECTIVE_CAMERA\r\n\r\n\t\treturn perspectiveDepthToViewZ(depth, cameraNear, cameraFar);\r\n\r\n\t#else\r\n\r\n\t\treturn orthographicDepthToViewZ(depth, cameraNear, cameraFar);\r\n\r\n\t#endif\r\n\r\n}\r\n\r\nFRAGMENT_HEAD\r\n\r\nvoid main() {\r\n\r\n\tFRAGMENT_MAIN_UV\r\n\r\n\tvec4 color0 = texture2D(inputBuffer, UV);\r\n\tvec4 color1 = vec4(0.0);\r\n\r\n\tFRAGMENT_MAIN_IMAGE\r\n\r\n\tgl_FragColor = color0;\r\n\r\n\t#ifdef ENCODE_OUTPUT\r\n\r\n\t\t#include <encodings_fragment>\r\n\r\n\t#endif\r\n\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n"),mn="uniform vec2 resolution;\r\nuniform vec2 texelSize;\r\n\r\nuniform float cameraNear;\r\nuniform float cameraFar;\r\nuniform float aspect;\r\nuniform float time;\r\n\r\nvarying vec2 vUv;\r\n\r\nVERTEX_HEAD\r\n\r\nvoid main() {\r\n\r\n\tvUv = position.xy * 0.5 + 0.5;\r\n\r\n\tVERTEX_MAIN_SUPPORT\r\n\r\n\tgl_Position = vec4(position.xy, 1.0, 1.0);\r\n\r\n}\r\n",gn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(o["a"])(this,t),e=n.call(this,{type:"EffectMaterial",defines:{DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new l["Uniform"](null),depthBuffer:new l["Uniform"](null),resolution:new l["Uniform"](new l["Vector2"]),texelSize:new l["Uniform"](new l["Vector2"]),cameraNear:new l["Uniform"](.3),cameraFar:new l["Uniform"](1e3),aspect:new l["Uniform"](1),time:new l["Uniform"](0)},depthWrite:!1,depthTest:!1,dithering:u}),e.toneMapped=!1,null!==r&&e.setShaderParts(r),null!==a&&e.setDefines(a),null!==i&&e.setUniforms(i),e.adoptCameraSettings(s),e}return Object(s["a"])(t,[{key:"setShaderParts",value:function(e){return this.fragmentShader=hn.replace(vn.FRAGMENT_HEAD,e.get(vn.FRAGMENT_HEAD)).replace(vn.FRAGMENT_MAIN_UV,e.get(vn.FRAGMENT_MAIN_UV)).replace(vn.FRAGMENT_MAIN_IMAGE,e.get(vn.FRAGMENT_MAIN_IMAGE)),this.vertexShader=mn.replace(vn.VERTEX_HEAD,e.get(vn.VERTEX_HEAD)).replace(vn.VERTEX_MAIN_SUPPORT,e.get(vn.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}},{key:"setDefines",value:function(e){var n,t=Object(Le["a"])(e.entries());try{for(t.s();!(n=t.n()).done;){var r=n.value;this.defines[r[0]]=r[1]}}catch(a){t.e(a)}finally{t.f()}return this.needsUpdate=!0,this}},{key:"setUniforms",value:function(e){var n,t=Object(Le["a"])(e.entries());try{for(t.s();!(n=t.n()).done;){var r=n.value;this.uniforms[r[0]]=r[1]}}catch(a){t.e(a)}finally{t.f()}return this}},{key:"adoptCameraSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof l["PerspectiveCamera"]?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},{key:"setSize",value:function(e,n){e=Math.max(e,1),n=Math.max(n,1),this.uniforms.resolution.value.set(e,n),this.uniforms.texelSize.value.set(1/e,1/n),this.uniforms.aspect.value=e/n}},{key:"depthPacking",get:function(){return Number(this.defines.DEPTH_PACKING)},set:function(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}}]),t}(l["ShaderMaterial"]),vn={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},_n="uniform sampler2D inputBuffer;\r\n\r\nuniform vec2 resolution;\r\n\r\nvarying vec2 vUv;\r\n\r\n// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\r\n//----------------------------------------------------------------------------------\r\n// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\r\n// SDK Version: v3.00\r\n// Email:       gameworks@nvidia.com\r\n// Site:        http://developer.nvidia.com/\r\n\r\n// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\r\n\r\n// Redistribution and use in source and binary forms, with or without\r\n// modification, are permitted provided that the following conditions\r\n// are met:\r\n//  * Redistributions of source code must retain the above copyright\r\n//    notice, this list of conditions and the following disclaimer.\r\n//  * Redistributions in binary form must reproduce the above copyright\r\n//    notice, this list of conditions and the following disclaimer in the\r\n//    documentation and/or other materials provided with the distribution.\r\n//  * Neither the name of NVIDIA CORPORATION nor the names of its\r\n//    contributors may be used to endorse or promote products derived\r\n//    from this software without specific prior written permission.\r\n\r\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\r\n// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\r\n// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\r\n// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\r\n// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\r\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n\r\n//----------------------------------------------------------------------------------\r\n\r\n#define FXAA_PC 1\r\n#define FXAA_GLSL_100 1\r\n#define FXAA_QUALITY_PRESET 12\r\n\r\n#define FXAA_GREEN_AS_LUMA 1\r\n\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_PC_CONSOLE\r\n    //\r\n    // The console algorithm for PC is included\r\n    // for developers targeting really low spec machines.\r\n    // Likely better to just run FXAA_PC, and use a really low preset.\r\n    //\r\n    #define FXAA_PC_CONSOLE 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_GLSL_120\r\n    #define FXAA_GLSL_120 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_GLSL_130\r\n    #define FXAA_GLSL_130 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_HLSL_3\r\n    #define FXAA_HLSL_3 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_HLSL_4\r\n    #define FXAA_HLSL_4 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_HLSL_5\r\n    #define FXAA_HLSL_5 0\r\n#endif\r\n/*==========================================================================*/\r\n#ifndef FXAA_GREEN_AS_LUMA\r\n    //\r\n    // For those using non-linear color,\r\n    // and either not able to get luma in alpha, or not wanting to,\r\n    // this enables FXAA to run using green as a proxy for luma.\r\n    // So with this enabled, no need to pack luma in alpha.\r\n    //\r\n    // This will turn off AA on anything which lacks some amount of green.\r\n    // Pure red and blue or combination of only R and B, will get no AA.\r\n    //\r\n    // Might want to lower the settings for both,\r\n    //    fxaaConsoleEdgeThresholdMin\r\n    //    fxaaQualityEdgeThresholdMin\r\n    // In order to insure AA does not get turned off on colors\r\n    // which contain a minor amount of green.\r\n    //\r\n    // 1 = On.\r\n    // 0 = Off.\r\n    //\r\n    #define FXAA_GREEN_AS_LUMA 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_EARLY_EXIT\r\n    //\r\n    // Controls algorithm's early exit path.\r\n    // On PS3 turning this ON adds 2 cycles to the shader.\r\n    // On 360 turning this OFF adds 10ths of a millisecond to the shader.\r\n    // Turning this off on console will result in a more blurry image.\r\n    // So this defaults to on.\r\n    //\r\n    // 1 = On.\r\n    // 0 = Off.\r\n    //\r\n    #define FXAA_EARLY_EXIT 1\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_DISCARD\r\n    //\r\n    // Only valid for PC OpenGL currently.\r\n    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\r\n    //\r\n    // 1 = Use discard on pixels which don't need AA.\r\n    //     For APIs which enable concurrent TEX+ROP from same surface.\r\n    // 0 = Return unchanged color on pixels which don't need AA.\r\n    //\r\n    #define FXAA_DISCARD 0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_FAST_PIXEL_OFFSET\r\n    //\r\n    // Used for GLSL 120 only.\r\n    //\r\n    // 1 = GL API supports fast pixel offsets\r\n    // 0 = do not use fast pixel offsets\r\n    //\r\n    #ifdef GL_EXT_gpu_shader4\r\n        #define FXAA_FAST_PIXEL_OFFSET 1\r\n    #endif\r\n    #ifdef GL_NV_gpu_shader5\r\n        #define FXAA_FAST_PIXEL_OFFSET 1\r\n    #endif\r\n    #ifdef GL_ARB_gpu_shader5\r\n        #define FXAA_FAST_PIXEL_OFFSET 1\r\n    #endif\r\n    #ifndef FXAA_FAST_PIXEL_OFFSET\r\n        #define FXAA_FAST_PIXEL_OFFSET 0\r\n    #endif\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#ifndef FXAA_GATHER4_ALPHA\r\n    //\r\n    // 1 = API supports gather4 on alpha channel.\r\n    // 0 = API does not support gather4 on alpha channel.\r\n    //\r\n    #if (FXAA_HLSL_5 == 1)\r\n        #define FXAA_GATHER4_ALPHA 1\r\n    #endif\r\n    #ifdef GL_ARB_gpu_shader5\r\n        #define FXAA_GATHER4_ALPHA 1\r\n    #endif\r\n    #ifdef GL_NV_gpu_shader5\r\n        #define FXAA_GATHER4_ALPHA 1\r\n    #endif\r\n    #ifndef FXAA_GATHER4_ALPHA\r\n        #define FXAA_GATHER4_ALPHA 0\r\n    #endif\r\n#endif\r\n\r\n\r\n/*============================================================================\r\n                        FXAA QUALITY - TUNING KNOBS\r\n------------------------------------------------------------------------------\r\nNOTE the other tuning knobs are now in the shader function inputs!\r\n============================================================================*/\r\n#ifndef FXAA_QUALITY_PRESET\r\n    //\r\n    // Choose the quality preset.\r\n    // This needs to be compiled into the shader as it effects code.\r\n    // Best option to include multiple presets is to\r\n    // in each shader define the preset, then include this file.\r\n    //\r\n    // OPTIONS\r\n    // -----------------------------------------------------------------------\r\n    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\r\n    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\r\n    // 39       - no dither, very expensive\r\n    //\r\n    // NOTES\r\n    // -----------------------------------------------------------------------\r\n    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\r\n    // 13 = about same speed as FXAA 3.9 and better than 12\r\n    // 23 = closest to FXAA 3.9 visually and performance wise\r\n    //  _ = the lowest digit is directly related to performance\r\n    // _  = the highest digit is directly related to style\r\n    //\r\n    #define FXAA_QUALITY_PRESET 12\r\n#endif\r\n\r\n\r\n/*============================================================================\r\n\r\n                           FXAA QUALITY - PRESETS\r\n\r\n============================================================================*/\r\n\r\n/*============================================================================\r\n                     FXAA QUALITY - MEDIUM DITHER PRESETS\r\n============================================================================*/\r\n#if (FXAA_QUALITY_PRESET == 10)\r\n    #define FXAA_QUALITY_PS 3\r\n    #define FXAA_QUALITY_P0 1.5\r\n    #define FXAA_QUALITY_P1 3.0\r\n    #define FXAA_QUALITY_P2 12.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 11)\r\n    #define FXAA_QUALITY_PS 4\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 3.0\r\n    #define FXAA_QUALITY_P3 12.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 12)\r\n    #define FXAA_QUALITY_PS 5\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 4.0\r\n    #define FXAA_QUALITY_P4 12.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 13)\r\n    #define FXAA_QUALITY_PS 6\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 4.0\r\n    #define FXAA_QUALITY_P5 12.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 14)\r\n    #define FXAA_QUALITY_PS 7\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 4.0\r\n    #define FXAA_QUALITY_P6 12.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 15)\r\n    #define FXAA_QUALITY_PS 8\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 2.0\r\n    #define FXAA_QUALITY_P6 4.0\r\n    #define FXAA_QUALITY_P7 12.0\r\n#endif\r\n\r\n/*============================================================================\r\n                     FXAA QUALITY - LOW DITHER PRESETS\r\n============================================================================*/\r\n#if (FXAA_QUALITY_PRESET == 20)\r\n    #define FXAA_QUALITY_PS 3\r\n    #define FXAA_QUALITY_P0 1.5\r\n    #define FXAA_QUALITY_P1 2.0\r\n    #define FXAA_QUALITY_P2 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 21)\r\n    #define FXAA_QUALITY_PS 4\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 22)\r\n    #define FXAA_QUALITY_PS 5\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 23)\r\n    #define FXAA_QUALITY_PS 6\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 24)\r\n    #define FXAA_QUALITY_PS 7\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 3.0\r\n    #define FXAA_QUALITY_P6 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 25)\r\n    #define FXAA_QUALITY_PS 8\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 2.0\r\n    #define FXAA_QUALITY_P6 4.0\r\n    #define FXAA_QUALITY_P7 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 26)\r\n    #define FXAA_QUALITY_PS 9\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 2.0\r\n    #define FXAA_QUALITY_P6 2.0\r\n    #define FXAA_QUALITY_P7 4.0\r\n    #define FXAA_QUALITY_P8 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 27)\r\n    #define FXAA_QUALITY_PS 10\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 2.0\r\n    #define FXAA_QUALITY_P6 2.0\r\n    #define FXAA_QUALITY_P7 2.0\r\n    #define FXAA_QUALITY_P8 4.0\r\n    #define FXAA_QUALITY_P9 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 28)\r\n    #define FXAA_QUALITY_PS 11\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 2.0\r\n    #define FXAA_QUALITY_P6 2.0\r\n    #define FXAA_QUALITY_P7 2.0\r\n    #define FXAA_QUALITY_P8 2.0\r\n    #define FXAA_QUALITY_P9 4.0\r\n    #define FXAA_QUALITY_P10 8.0\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_QUALITY_PRESET == 29)\r\n    #define FXAA_QUALITY_PS 12\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.5\r\n    #define FXAA_QUALITY_P2 2.0\r\n    #define FXAA_QUALITY_P3 2.0\r\n    #define FXAA_QUALITY_P4 2.0\r\n    #define FXAA_QUALITY_P5 2.0\r\n    #define FXAA_QUALITY_P6 2.0\r\n    #define FXAA_QUALITY_P7 2.0\r\n    #define FXAA_QUALITY_P8 2.0\r\n    #define FXAA_QUALITY_P9 2.0\r\n    #define FXAA_QUALITY_P10 4.0\r\n    #define FXAA_QUALITY_P11 8.0\r\n#endif\r\n\r\n/*============================================================================\r\n                     FXAA QUALITY - EXTREME QUALITY\r\n============================================================================*/\r\n#if (FXAA_QUALITY_PRESET == 39)\r\n    #define FXAA_QUALITY_PS 12\r\n    #define FXAA_QUALITY_P0 1.0\r\n    #define FXAA_QUALITY_P1 1.0\r\n    #define FXAA_QUALITY_P2 1.0\r\n    #define FXAA_QUALITY_P3 1.0\r\n    #define FXAA_QUALITY_P4 1.0\r\n    #define FXAA_QUALITY_P5 1.5\r\n    #define FXAA_QUALITY_P6 2.0\r\n    #define FXAA_QUALITY_P7 2.0\r\n    #define FXAA_QUALITY_P8 2.0\r\n    #define FXAA_QUALITY_P9 2.0\r\n    #define FXAA_QUALITY_P10 4.0\r\n    #define FXAA_QUALITY_P11 8.0\r\n#endif\r\n\r\n\r\n\r\n/*============================================================================\r\n\r\n                                API PORTING\r\n\r\n============================================================================*/\r\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\r\n    #define FxaaBool bool\r\n    #define FxaaDiscard discard\r\n    #define FxaaFloat float\r\n    #define FxaaFloat2 vec2\r\n    #define FxaaFloat3 vec3\r\n    #define FxaaFloat4 vec4\r\n    #define FxaaHalf float\r\n    #define FxaaHalf2 vec2\r\n    #define FxaaHalf3 vec3\r\n    #define FxaaHalf4 vec4\r\n    #define FxaaInt2 ivec2\r\n    #define FxaaSat(x) clamp(x, 0.0, 1.0)\r\n    #define FxaaTex sampler2D\r\n#else\r\n    #define FxaaBool bool\r\n    #define FxaaDiscard clip(-1)\r\n    #define FxaaFloat float\r\n    #define FxaaFloat2 float2\r\n    #define FxaaFloat3 float3\r\n    #define FxaaFloat4 float4\r\n    #define FxaaHalf half\r\n    #define FxaaHalf2 half2\r\n    #define FxaaHalf3 half3\r\n    #define FxaaHalf4 half4\r\n    #define FxaaSat(x) saturate(x)\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_GLSL_100 == 1)\r\n  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\r\n  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_GLSL_120 == 1)\r\n    // Requires,\r\n    //  #version 120\r\n    // And at least,\r\n    //  #extension GL_EXT_gpu_shader4 : enable\r\n    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\r\n    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\r\n    #if (FXAA_FAST_PIXEL_OFFSET == 1)\r\n        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\r\n    #else\r\n        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\r\n    #endif\r\n    #if (FXAA_GATHER4_ALPHA == 1)\r\n        // use #extension GL_ARB_gpu_shader5 : enable\r\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\r\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\r\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\r\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\r\n    #endif\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_GLSL_130 == 1)\r\n    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\r\n    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\r\n    #if (FXAA_GATHER4_ALPHA == 1)\r\n        // use #extension GL_ARB_gpu_shader5 : enable\r\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\r\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\r\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\r\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\r\n    #endif\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_HLSL_3 == 1)\r\n    #define FxaaInt2 float2\r\n    #define FxaaTex sampler2D\r\n    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\r\n    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_HLSL_4 == 1)\r\n    #define FxaaInt2 int2\r\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\r\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\r\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\r\n#endif\r\n/*--------------------------------------------------------------------------*/\r\n#if (FXAA_HLSL_5 == 1)\r\n    #define FxaaInt2 int2\r\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\r\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\r\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\r\n    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\r\n    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\r\n    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\r\n    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\r\n#endif\r\n\r\n\r\n/*============================================================================\r\n                   GREEN AS LUMA OPTION SUPPORT FUNCTION\r\n============================================================================*/\r\n#if (FXAA_GREEN_AS_LUMA == 0)\r\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\r\n#else\r\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\r\n#endif\r\n\r\n\r\n\r\n\r\n/*============================================================================\r\n\r\n                             FXAA3 QUALITY - PC\r\n\r\n============================================================================*/\r\n#if (FXAA_PC == 1)\r\n/*--------------------------------------------------------------------------*/\r\nFxaaFloat4 FxaaPixelShader(\r\n    //\r\n    // Use noperspective interpolation here (turn off perspective interpolation).\r\n    // {xy} = center of pixel\r\n    FxaaFloat2 pos,\r\n    //\r\n    // Used only for FXAA Console, and not used on the 360 version.\r\n    // Use noperspective interpolation here (turn off perspective interpolation).\r\n    // {xy_} = upper left of pixel\r\n    // {_zw} = lower right of pixel\r\n    FxaaFloat4 fxaaConsolePosPos,\r\n    //\r\n    // Input color texture.\r\n    // {rgb_} = color in linear or perceptual color space\r\n    // if (FXAA_GREEN_AS_LUMA == 0)\r\n    //     {__a} = luma in perceptual color space (not linear)\r\n    FxaaTex tex,\r\n    //\r\n    // Only used on the optimized 360 version of FXAA Console.\r\n    // For everything but 360, just use the same input here as for tex.\r\n    // For 360, same texture, just alias with a 2nd sampler.\r\n    // This sampler needs to have an exponent bias of -1.\r\n    FxaaTex fxaaConsole360TexExpBiasNegOne,\r\n    //\r\n    // Only used on the optimized 360 version of FXAA Console.\r\n    // For everything but 360, just use the same input here as for tex.\r\n    // For 360, same texture, just alias with a 3nd sampler.\r\n    // This sampler needs to have an exponent bias of -2.\r\n    FxaaTex fxaaConsole360TexExpBiasNegTwo,\r\n    //\r\n    // Only used on FXAA Quality.\r\n    // This must be from a constant/uniform.\r\n    // {x_} = 1.0/screenWidthInPixels\r\n    // {_y} = 1.0/screenHeightInPixels\r\n    FxaaFloat2 fxaaQualityRcpFrame,\r\n    //\r\n    // Only used on FXAA Console.\r\n    // This must be from a constant/uniform.\r\n    // This effects sub-pixel AA quality and inversely sharpness.\r\n    //   Where N ranges between,\r\n    //     N = 0.50 (default)\r\n    //     N = 0.33 (sharper)\r\n    // {x__} = -N/screenWidthInPixels\r\n    // {_y_} = -N/screenHeightInPixels\r\n    // {_z_} =  N/screenWidthInPixels\r\n    // {__w} =  N/screenHeightInPixels\r\n    FxaaFloat4 fxaaConsoleRcpFrameOpt,\r\n    //\r\n    // Only used on FXAA Console.\r\n    // Not used on 360, but used on PS3 and PC.\r\n    // This must be from a constant/uniform.\r\n    // {x__} = -2.0/screenWidthInPixels\r\n    // {_y_} = -2.0/screenHeightInPixels\r\n    // {_z_} =  2.0/screenWidthInPixels\r\n    // {__w} =  2.0/screenHeightInPixels\r\n    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\r\n    //\r\n    // Only used on FXAA Console.\r\n    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\r\n    // This must be from a constant/uniform.\r\n    // {x__} =  8.0/screenWidthInPixels\r\n    // {_y_} =  8.0/screenHeightInPixels\r\n    // {_z_} = -4.0/screenWidthInPixels\r\n    // {__w} = -4.0/screenHeightInPixels\r\n    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\r\n    //\r\n    // Only used on FXAA Quality.\r\n    // This used to be the FXAA_QUALITY_SUBPIX define.\r\n    // It is here now to allow easier tuning.\r\n    // Choose the amount of sub-pixel aliasing removal.\r\n    // This can effect sharpness.\r\n    //   1.00 - upper limit (softer)\r\n    //   0.75 - default amount of filtering\r\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\r\n    //   0.25 - almost off\r\n    //   0.00 - completely off\r\n    FxaaFloat fxaaQualitySubpix,\r\n    //\r\n    // Only used on FXAA Quality.\r\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\r\n    // It is here now to allow easier tuning.\r\n    // The minimum amount of local contrast required to apply algorithm.\r\n    //   0.333 - too little (faster)\r\n    //   0.250 - low quality\r\n    //   0.166 - default\r\n    //   0.125 - high quality\r\n    //   0.063 - overkill (slower)\r\n    FxaaFloat fxaaQualityEdgeThreshold,\r\n    //\r\n    // Only used on FXAA Quality.\r\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\r\n    // It is here now to allow easier tuning.\r\n    // Trims the algorithm from processing darks.\r\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\r\n    //   0.0625 - high quality (faster)\r\n    //   0.0312 - visible limit (slower)\r\n    // Special notes when using FXAA_GREEN_AS_LUMA,\r\n    //   Likely want to set this to zero.\r\n    //   As colors that are mostly not-green\r\n    //   will appear very dark in the green channel!\r\n    //   Tune by looking at mostly non-green content,\r\n    //   then start at zero and increase until aliasing is a problem.\r\n    FxaaFloat fxaaQualityEdgeThresholdMin,\r\n    //\r\n    // Only used on FXAA Console.\r\n    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\r\n    // It is here now to allow easier tuning.\r\n    // This does not effect PS3, as this needs to be compiled in.\r\n    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\r\n    //   Due to the PS3 being ALU bound,\r\n    //   there are only three safe values here: 2 and 4 and 8.\r\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\r\n    // For all other platforms can be a non-power of two.\r\n    //   8.0 is sharper (default!!!)\r\n    //   4.0 is softer\r\n    //   2.0 is really soft (good only for vector graphics inputs)\r\n    FxaaFloat fxaaConsoleEdgeSharpness,\r\n    //\r\n    // Only used on FXAA Console.\r\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\r\n    // It is here now to allow easier tuning.\r\n    // This does not effect PS3, as this needs to be compiled in.\r\n    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\r\n    //   Due to the PS3 being ALU bound,\r\n    //   there are only two safe values here: 1/4 and 1/8.\r\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\r\n    // The console setting has a different mapping than the quality setting.\r\n    // Other platforms can use other values.\r\n    //   0.125 leaves less aliasing, but is softer (default!!!)\r\n    //   0.25 leaves more aliasing, and is sharper\r\n    FxaaFloat fxaaConsoleEdgeThreshold,\r\n    //\r\n    // Only used on FXAA Console.\r\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\r\n    // It is here now to allow easier tuning.\r\n    // Trims the algorithm from processing darks.\r\n    // The console setting has a different mapping than the quality setting.\r\n    // This only applies when FXAA_EARLY_EXIT is 1.\r\n    // This does not apply to PS3,\r\n    // PS3 was simplified to avoid more shader instructions.\r\n    //   0.06 - faster but more aliasing in darks\r\n    //   0.05 - default\r\n    //   0.04 - slower and less aliasing in darks\r\n    // Special notes when using FXAA_GREEN_AS_LUMA,\r\n    //   Likely want to set this to zero.\r\n    //   As colors that are mostly not-green\r\n    //   will appear very dark in the green channel!\r\n    //   Tune by looking at mostly non-green content,\r\n    //   then start at zero and increase until aliasing is a problem.\r\n    FxaaFloat fxaaConsoleEdgeThresholdMin,\r\n    //\r\n    // Extra constants for 360 FXAA Console only.\r\n    // Use zeros or anything else for other platforms.\r\n    // These must be in physical constant registers and NOT immediates.\r\n    // Immediates will result in compiler un-optimizing.\r\n    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\r\n    FxaaFloat4 fxaaConsole360ConstDir\r\n) {\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat2 posM;\r\n    posM.x = pos.x;\r\n    posM.y = pos.y;\r\n    #if (FXAA_GATHER4_ALPHA == 1)\r\n        #if (FXAA_DISCARD == 0)\r\n            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\r\n            #if (FXAA_GREEN_AS_LUMA == 0)\r\n                #define lumaM rgbyM.w\r\n            #else\r\n                #define lumaM rgbyM.y\r\n            #endif\r\n        #endif\r\n        #if (FXAA_GREEN_AS_LUMA == 0)\r\n            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\r\n            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\r\n        #else\r\n            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\r\n            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\r\n        #endif\r\n        #if (FXAA_DISCARD == 1)\r\n            #define lumaM luma4A.w\r\n        #endif\r\n        #define lumaE luma4A.z\r\n        #define lumaS luma4A.x\r\n        #define lumaSE luma4A.y\r\n        #define lumaNW luma4B.w\r\n        #define lumaN luma4B.z\r\n        #define lumaW luma4B.x\r\n    #else\r\n        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\r\n        #if (FXAA_GREEN_AS_LUMA == 0)\r\n            #define lumaM rgbyM.w\r\n        #else\r\n            #define lumaM rgbyM.y\r\n        #endif\r\n        #if (FXAA_GLSL_100 == 1)\r\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\r\n        #else\r\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\r\n        #endif\r\n    #endif\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat maxSM = max(lumaS, lumaM);\r\n    FxaaFloat minSM = min(lumaS, lumaM);\r\n    FxaaFloat maxESM = max(lumaE, maxSM);\r\n    FxaaFloat minESM = min(lumaE, minSM);\r\n    FxaaFloat maxWN = max(lumaN, lumaW);\r\n    FxaaFloat minWN = min(lumaN, lumaW);\r\n    FxaaFloat rangeMax = max(maxWN, maxESM);\r\n    FxaaFloat rangeMin = min(minWN, minESM);\r\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r\n    FxaaFloat range = rangeMax - rangeMin;\r\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r\n    FxaaBool earlyExit = range < rangeMaxClamped;\r\n/*--------------------------------------------------------------------------*/\r\n    if(earlyExit)\r\n        #if (FXAA_DISCARD == 1)\r\n            FxaaDiscard;\r\n        #else\r\n            return rgbyM;\r\n        #endif\r\n/*--------------------------------------------------------------------------*/\r\n    #if (FXAA_GATHER4_ALPHA == 0)\r\n        #if (FXAA_GLSL_100 == 1)\r\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\r\n        #else\r\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\r\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\r\n        #endif\r\n    #else\r\n        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\r\n        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\r\n    #endif\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat lumaNS = lumaN + lumaS;\r\n    FxaaFloat lumaWE = lumaW + lumaE;\r\n    FxaaFloat subpixRcpRange = 1.0/range;\r\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\r\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\r\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\r\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\r\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\r\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\r\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\r\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\r\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\r\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r\n/*--------------------------------------------------------------------------*/\r\n    if(!horzSpan) lumaN = lumaW;\r\n    if(!horzSpan) lumaS = lumaE;\r\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\r\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat gradientN = lumaN - lumaM;\r\n    FxaaFloat gradientS = lumaS - lumaM;\r\n    FxaaFloat lumaNN = lumaN + lumaM;\r\n    FxaaFloat lumaSS = lumaS + lumaM;\r\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\r\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\r\n    if(pairN) lengthSign = -lengthSign;\r\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat2 posB;\r\n    posB.x = posM.x;\r\n    posB.y = posM.y;\r\n    FxaaFloat2 offNP;\r\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\r\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\r\n    if(!horzSpan) posB.x += lengthSign * 0.5;\r\n    if( horzSpan) posB.y += lengthSign * 0.5;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat2 posN;\r\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\r\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\r\n    FxaaFloat2 posP;\r\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\r\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\r\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\r\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\r\n    FxaaFloat subpixE = subpixC * subpixC;\r\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\r\n/*--------------------------------------------------------------------------*/\r\n    if(!pairN) lumaNN = lumaSS;\r\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\r\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\r\n    FxaaFloat subpixF = subpixD * subpixE;\r\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\r\n/*--------------------------------------------------------------------------*/\r\n    lumaEndN -= lumaNN * 0.5;\r\n    lumaEndP -= lumaNN * 0.5;\r\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\r\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\r\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\r\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\r\n    FxaaBool doneNP = (!doneN) || (!doneP);\r\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\r\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\r\n/*--------------------------------------------------------------------------*/\r\n    if(doneNP) {\r\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n        doneN = abs(lumaEndN) >= gradientScaled;\r\n        doneP = abs(lumaEndP) >= gradientScaled;\r\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\r\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\r\n        doneNP = (!doneN) || (!doneP);\r\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\r\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\r\n/*--------------------------------------------------------------------------*/\r\n        #if (FXAA_QUALITY_PS > 3)\r\n        if(doneNP) {\r\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n            doneN = abs(lumaEndN) >= gradientScaled;\r\n            doneP = abs(lumaEndP) >= gradientScaled;\r\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\r\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\r\n            doneNP = (!doneN) || (!doneP);\r\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\r\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\r\n/*--------------------------------------------------------------------------*/\r\n            #if (FXAA_QUALITY_PS > 4)\r\n            if(doneNP) {\r\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                doneN = abs(lumaEndN) >= gradientScaled;\r\n                doneP = abs(lumaEndP) >= gradientScaled;\r\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\r\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\r\n                doneNP = (!doneN) || (!doneP);\r\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\r\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\r\n/*--------------------------------------------------------------------------*/\r\n                #if (FXAA_QUALITY_PS > 5)\r\n                if(doneNP) {\r\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                    doneN = abs(lumaEndN) >= gradientScaled;\r\n                    doneP = abs(lumaEndP) >= gradientScaled;\r\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\r\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\r\n                    doneNP = (!doneN) || (!doneP);\r\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\r\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\r\n/*--------------------------------------------------------------------------*/\r\n                    #if (FXAA_QUALITY_PS > 6)\r\n                    if(doneNP) {\r\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                        doneN = abs(lumaEndN) >= gradientScaled;\r\n                        doneP = abs(lumaEndP) >= gradientScaled;\r\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\r\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\r\n                        doneNP = (!doneN) || (!doneP);\r\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\r\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\r\n/*--------------------------------------------------------------------------*/\r\n                        #if (FXAA_QUALITY_PS > 7)\r\n                        if(doneNP) {\r\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                            doneN = abs(lumaEndN) >= gradientScaled;\r\n                            doneP = abs(lumaEndP) >= gradientScaled;\r\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\r\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\r\n                            doneNP = (!doneN) || (!doneP);\r\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\r\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\r\n/*--------------------------------------------------------------------------*/\r\n    #if (FXAA_QUALITY_PS > 8)\r\n    if(doneNP) {\r\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n        doneN = abs(lumaEndN) >= gradientScaled;\r\n        doneP = abs(lumaEndP) >= gradientScaled;\r\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\r\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\r\n        doneNP = (!doneN) || (!doneP);\r\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\r\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\r\n/*--------------------------------------------------------------------------*/\r\n        #if (FXAA_QUALITY_PS > 9)\r\n        if(doneNP) {\r\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n            doneN = abs(lumaEndN) >= gradientScaled;\r\n            doneP = abs(lumaEndP) >= gradientScaled;\r\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\r\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\r\n            doneNP = (!doneN) || (!doneP);\r\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\r\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\r\n/*--------------------------------------------------------------------------*/\r\n            #if (FXAA_QUALITY_PS > 10)\r\n            if(doneNP) {\r\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                doneN = abs(lumaEndN) >= gradientScaled;\r\n                doneP = abs(lumaEndP) >= gradientScaled;\r\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\r\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\r\n                doneNP = (!doneN) || (!doneP);\r\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\r\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\r\n/*--------------------------------------------------------------------------*/\r\n                #if (FXAA_QUALITY_PS > 11)\r\n                if(doneNP) {\r\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                    doneN = abs(lumaEndN) >= gradientScaled;\r\n                    doneP = abs(lumaEndP) >= gradientScaled;\r\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\r\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\r\n                    doneNP = (!doneN) || (!doneP);\r\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\r\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\r\n/*--------------------------------------------------------------------------*/\r\n                    #if (FXAA_QUALITY_PS > 12)\r\n                    if(doneNP) {\r\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\r\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\r\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                        doneN = abs(lumaEndN) >= gradientScaled;\r\n                        doneP = abs(lumaEndP) >= gradientScaled;\r\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\r\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\r\n                        doneNP = (!doneN) || (!doneP);\r\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\r\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\r\n/*--------------------------------------------------------------------------*/\r\n                    }\r\n                    #endif\r\n/*--------------------------------------------------------------------------*/\r\n                }\r\n                #endif\r\n/*--------------------------------------------------------------------------*/\r\n            }\r\n            #endif\r\n/*--------------------------------------------------------------------------*/\r\n        }\r\n        #endif\r\n/*--------------------------------------------------------------------------*/\r\n    }\r\n    #endif\r\n/*--------------------------------------------------------------------------*/\r\n                        }\r\n                        #endif\r\n/*--------------------------------------------------------------------------*/\r\n                    }\r\n                    #endif\r\n/*--------------------------------------------------------------------------*/\r\n                }\r\n                #endif\r\n/*--------------------------------------------------------------------------*/\r\n            }\r\n            #endif\r\n/*--------------------------------------------------------------------------*/\r\n        }\r\n        #endif\r\n/*--------------------------------------------------------------------------*/\r\n    }\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat dstN = posM.x - posN.x;\r\n    FxaaFloat dstP = posP.x - posM.x;\r\n    if(!horzSpan) dstN = posM.y - posN.y;\r\n    if(!horzSpan) dstP = posP.y - posM.y;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r\n    FxaaFloat spanLength = (dstP + dstN);\r\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaBool directionN = dstN < dstP;\r\n    FxaaFloat dst = min(dstN, dstP);\r\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\r\n    FxaaFloat subpixG = subpixF * subpixF;\r\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\r\n/*--------------------------------------------------------------------------*/\r\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\r\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\r\n    #if (FXAA_DISCARD == 1)\r\n        return FxaaTexTop(tex, posM);\r\n    #else\r\n        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\r\n    #endif\r\n}\r\n/*==========================================================================*/\r\n#endif\r\n\r\nvoid main() {\r\n  gl_FragColor = FxaaPixelShader(\r\n    vUv,\r\n    vec4(0.0),\r\n    inputBuffer,\r\n    inputBuffer,\r\n    inputBuffer,\r\n    resolution,\r\n    vec4(0.0),\r\n    vec4(0.0),\r\n    vec4(0.0),\r\n    0.75,\r\n    0.166,\r\n    0.0833,\r\n    0.0,\r\n    0.0,\r\n    0.0,\r\n    vec4(0.0)\r\n  );\r\n\r\n  // TODO avoid querying texture twice for same texel\r\n  gl_FragColor.a = texture2D(inputBuffer, vUv).a;\r\n//   gl_FragColor = texture2D(inputBuffer, vUv);\r\n//   gl_FragColor = vec4(vUv, 0., 1.);\r\n  #include <encodings_fragment>\r\n}",An=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(){var e;return Object(o["a"])(this,t),e=n.call(this,{type:"FXAAMaterial",uniforms:{inputBuffer:new l["Uniform"](null),resolution:{value:new l["Vector2"](1/1024,1/512)}},fragmentShader:_n,vertexShader:fn,depthWrite:!1,depthTest:!1}),e.toneMapped=!1,e}return t}(l["ShaderMaterial"]);function xn(e,n){var t,r=[];while(null!==(t=e.exec(n)))r.push(t[1]);return r}function bn(e,n,t){var r,a,i,o=Object(Le["a"])(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;r="$1"+e+s.charAt(0).toUpperCase()+s.slice(1),a=new RegExp("([^\\.])(\\b"+s+"\\b)","g");var l,u=Object(Le["a"])(t.entries());try{for(u.s();!(l=u.n()).done;){var c=l.value;null!==c[1]&&t.set(c[0],c[1].replace(a,r))}}catch(d){u.e(d)}finally{u.f()}}}catch(d){o.e(d)}finally{o.f()}}function yn(e,n,t,r,a,i,o){var s=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,l=/(?:varying\s+\w+\s+(\w*))/g,u=n.blendMode,c=new Map([["fragment",n.fragmentShader],["vertex",n.vertexShader]]),d=void 0!==c.get("fragment")&&c.get("fragment").indexOf("mainImage")>=0,f=void 0!==c.get("fragment")&&c.get("fragment").indexOf("mainUv")>=0,p=[],h=[],m=!1,g=!1;if(void 0===c.get("fragment"))console.error("Missing fragment shader",n);else if(f&&0!==(o&cn.CONVOLUTION))console.error("Effects that transform UV coordinates are incompatible with convolution effects",n);else if(d||f){if(f&&(t.set(vn.FRAGMENT_MAIN_UV,t.get(vn.FRAGMENT_MAIN_UV)+"\t"+e+"MainUv(UV);\n"),m=!0),null!==c.get("vertex")&&c.get("vertex").indexOf("mainSupport")>=0){var v="\t"+e+"MainSupport(";c.get("vertex").indexOf("uv")>=0&&(v+="vUv"),v+=");\n",t.set(vn.VERTEX_MAIN_SUPPORT,t.get(vn.VERTEX_MAIN_SUPPORT)+v),p=p.concat(xn(l,c.get("vertex"))),h=h.concat(p).concat(xn(s,c.get("vertex")))}if(h=h.concat(xn(s,c.get("fragment"))).concat(Array.from(n.defines.keys()).map((function(e){return e.replace(/\([\w\s,]*\)/g,"")}))).concat(Array.from(n.uniforms.keys())),n.uniforms.forEach((function(n,t){return i.set(e+t.charAt(0).toUpperCase()+t.slice(1),n)})),n.defines.forEach((function(n,t){return a.set(e+t.charAt(0).toUpperCase()+t.slice(1),n)})),bn(e,h,a),bn(e,h,c),r.set(u.blendFunction,u),d){var _=e+"MainImage(color0, UV, ";0!==(o&cn.DEPTH)&&c.get("fragment").indexOf("depth")>=0&&(_+="depth, ",g=!0),_+="color1);\n\t";var A=e+"BlendOpacity";i.set(A,u.opacity),_+="color0 = blend"+u.blendFunction+"(color0, color1, "+A+");\n\n\t",t.set(vn.FRAGMENT_MAIN_IMAGE,t.get(vn.FRAGMENT_MAIN_IMAGE)+_),t.set(vn.FRAGMENT_HEAD,t.get(vn.FRAGMENT_HEAD)+"uniform float "+A+";\n\n")}t.set(vn.FRAGMENT_HEAD,t.get(vn.FRAGMENT_HEAD)+c.get("fragment")+"\n"),null!==c.get("vertex")&&t.set(vn.VERTEX_HEAD,t.get(vn.VERTEX_HEAD)+c.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",n);return{varyings:p,transformedUv:m,readDepth:g}}var En=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e){var r;Object(o["a"])(this,t),r=n.call(this,"EffectPass"),r.setFullscreenMaterial(new gn(null,null,null,e));for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];return r.effects=i.sort((function(e,n){return n.attributes-e.attributes})),r.skipRendering=!1,r.uniforms=0,r.varyings=0,r.minTime=1,r.maxTime=1e3,r}return Object(s["a"])(t,[{key:"updateMaterial",value:function(){var e,n,t=/\bblend\b/g,r=new Map([[vn.FRAGMENT_HEAD,""],[vn.FRAGMENT_MAIN_UV,""],[vn.FRAGMENT_MAIN_IMAGE,""],[vn.VERTEX_HEAD,""],[vn.VERTEX_MAIN_SUPPORT,""]]),a=new Map,i=new Map,o=new Map,s=new Set,l=0,u=0,c=0,d=!1,f=!1,p=Object(Le["a"])(this.effects);try{for(p.s();!(n=p.n()).done;){var h=n.value;if(h.blendMode.blendFunction===Xe.SKIP)c|=h.attributes&cn.DEPTH;else if(0!==(c&cn.CONVOLUTION)&&0!==(h.attributes&cn.CONVOLUTION))console.error("Convolution effects cannot be merged",h);else if(c|=h.attributes,e=yn("e"+l++,h,r,a,i,o,c),u+=e.varyings.length,d=d||e.transformedUv,f=f||e.readDepth,null!==h.extensions){var m,g=Object(Le["a"])(h.extensions);try{for(g.s();!(m=g.n()).done;){var v=m.value;s.add(v)}}catch(S){g.e(S)}finally{g.f()}}}}catch(S){p.e(S)}finally{p.f()}var _,A=Object(Le["a"])(a.values());try{for(A.s();!(_=A.n()).done;){var x=_.value;r.set(vn.FRAGMENT_HEAD,r.get(vn.FRAGMENT_HEAD)+x.getShaderCode().replace(t,"blend"+x.blendFunction)+"\n")}}catch(S){A.e(S)}finally{A.f()}0!==(c&cn.DEPTH)?(f&&r.set(vn.FRAGMENT_MAIN_IMAGE,"float depth = readDepth(UV);\n\n\t"+r.get(vn.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,d?(r.set(vn.FRAGMENT_MAIN_UV,"vec2 transformedUv = vUv;\n"+r.get(vn.FRAGMENT_MAIN_UV)),i.set("UV","transformedUv")):i.set("UV","vUv"),r.forEach((function(e,n,t){return t.set(n,e.trim().replace(/^#/,"\n#"))})),this.uniforms=o.size,this.varyings=u,this.skipRendering=0===l,this.needsSwap=!this.skipRendering;var b=this.getFullscreenMaterial();if(b.setShaderParts(r).setDefines(i).setUniforms(o),b.extensions={},s.size>0){var y,E=Object(Le["a"])(s);try{for(E.s();!(y=E.n()).done;){var T=y.value;b.extensions[T]=!0}}catch(S){E.e(S)}finally{E.f()}}}},{key:"recompile",value:function(){this.updateMaterial()}},{key:"getDepthTexture",value:function(){return this.getFullscreenMaterial().uniforms.depthBuffer.value}},{key:"setDepthTexture",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=this.getFullscreenMaterial();t.uniforms.depthBuffer.value=e,t.depthPacking=n,t.needsUpdate=!0;var r,a=Object(Le["a"])(this.effects);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.setDepthTexture(e,n)}}catch(o){a.e(o)}finally{a.f()}}},{key:"render",value:function(e,n,t,r,a){var i,o=this.getFullscreenMaterial(),s=o.uniforms.time.value+r,l=Object(Le["a"])(this.effects);try{for(l.s();!(i=l.n()).done;){var u=i.value;u.update(e,n,r)}}catch(c){l.e(c)}finally{l.f()}this.skipRendering&&!this.renderToScreen||(o.uniforms.inputBuffer.value=n.texture,o.uniforms.time.value=s<=this.maxTime?s:this.minTime,e.setRenderTarget(this.renderToScreen?null:t),e.render(this.scene,this.camera))}},{key:"setSize",value:function(e,n){this.getFullscreenMaterial().setSize(e,n);var t,r=Object(Le["a"])(this.effects);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.setSize(e,n)}}catch(i){r.e(i)}finally{r.f()}}},{key:"initialize",value:function(e,n,t){var r,a=Object(Le["a"])(this.effects);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.initialize(e,n,t)}}catch(l){a.e(l)}finally{a.f()}this.updateMaterial();var o=e.capabilities,s=Math.min(o.maxFragmentUniforms,o.maxVertexUniforms);this.uniforms>s&&console.warn("The current rendering context doesn't support more than "+s+" uniforms, but "+this.uniforms+" were defined"),s=o.maxVaryings,this.varyings>s&&console.warn("The current rendering context doesn't support more than "+s+" varyings, but "+this.varyings+" were defined")}},{key:"dispose",value:function(){Object(Be["a"])(Object(He["a"])(t.prototype),"dispose",this).call(this);var e,n=Object(Le["a"])(this.effects);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.dispose()}}catch(a){n.e(a)}finally{n.f()}}},{key:"encodeOutput",get:function(){return void 0!==this.getFullscreenMaterial().defines.ENCODE_OUTPUT},set:function(e){if(this.encodeOutput!==e){var n=this.getFullscreenMaterial();n.needsUpdate=!0,e?n.defines.ENCODE_OUTPUT="1":delete n.defines.ENCODE_OUTPUT}}},{key:"dithering",get:function(){return this.getFullscreenMaterial().dithering},set:function(e){var n=this.getFullscreenMaterial();n.dithering!==e&&(n.dithering=e,n.needsUpdate=!0)}}]),t}(Re),Tn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e,r){var a;return Object(o["a"])(this,t),a=n.call(this,"MaskPass",e,r),a.needsSwap=!1,a.clearPass=new Ce(!1,!1,!0),a.inverse=!1,a}return Object(s["a"])(t,[{key:"render",value:function(e,n,t,r,a){var i=e.getContext(),o=e.state.buffers,s=this.scene,l=this.camera,u=this.clearPass,c=this.inverse?0:1,d=1-c;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.stencil.setFunc(i.ALWAYS,c,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clear&&(this.renderToScreen?u.render(e,null):(u.render(e,n),u.render(e,t))),this.renderToScreen?(e.setRenderTarget(null),e.render(s,l)):(e.setRenderTarget(n),e.render(s,l),e.setRenderTarget(t),e.render(s,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(i.EQUAL,1,4294967295),o.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.stencil.setLocked(!0)}},{key:"clear",get:function(){return this.clearPass.enabled},set:function(e){this.clearPass.enabled=e}}]),t}(Re),Sn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.resolutionScale,u=void 0===s?1:s,c=i.width,d=void 0===c?De.AUTO_SIZE:c,f=i.height,p=void 0===f?De.AUTO_SIZE:f,h=i.renderTarget;Object(o["a"])(this,t),a=n.call(this,"NormalPass"),a.needsSwap=!1,a.renderPass=new ke(e,r,new l["MeshNormalMaterial"]({morphTargets:!0,morphNormals:!0,skinning:!0}));var m=a.renderPass.getClearPass();return m.overrideClearColor=new l["Color"](7829503),m.overrideClearAlpha=1,a.renderTarget=h,void 0===a.renderTarget&&(a.renderTarget=new l["WebGLRenderTarget"](1,1,{minFilter:l["LinearFilter"],magFilter:l["LinearFilter"],format:l["RGBFormat"],stencilBuffer:!1}),a.renderTarget.texture.name="NormalPass.Target"),a.resolution=new De(Object(Ie["a"])(a),d,p),a.resolution.scale=u,a}return Object(s["a"])(t,[{key:"getResolutionScale",value:function(){return this.resolutionScale}},{key:"setResolutionScale",value:function(e){this.resolutionScale=e,this.setSize(this.originalSize.x,this.originalSize.y)}},{key:"render",value:function(e,n,t,r,a){var i=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,i,i)}},{key:"setSize",value:function(e,n){var t=this.resolution;t.base.set(e,n),e=t.width,n=t.height,this.renderTarget.setSize(e,n)}}]),t}(Re),Fn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inputBuffer";return Object(o["a"])(this,t),r=n.call(this,"ShaderPass"),r.setFullscreenMaterial(e),r.uniform=null,r.setInput(a),r}return Object(s["a"])(t,[{key:"setInput",value:function(e){var n=this.getFullscreenMaterial();if(this.uniform=null,null!==n){var t=n.uniforms;void 0!==t&&void 0!==t[e]&&(this.uniform=t[e])}}},{key:"render",value:function(e,n,t,r,a){null!==this.uniform&&null!==n&&(this.uniform.value=n.texture),e.setRenderTarget(this.renderToScreen?null:t),e.render(this.scene,this.camera)}}]),t}(Re),Ln=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.depthBuffer,a=void 0===r||r,i=t.stencilBuffer,s=void 0!==i&&i,l=t.multisampling,u=void 0===l?0:l,c=t.frameBufferType;Object(o["a"])(this,e),this.renderer=n,this.inputBuffer=null,this.outputBuffer=null,null!==this.renderer&&(this.renderer.autoClear=!1,this.inputBuffer=this.createBuffer(a,s,c,u),this.outputBuffer=this.inputBuffer.clone(),this.enableExtensions()),this.copyPass=new Fn(new pn),this.depthTexture=null,this.passes=[],this.autoRenderToScreen=!0}return Object(s["a"])(e,[{key:"getRenderer",value:function(){return this.renderer}},{key:"enableExtensions",value:function(){var e=this.inputBuffer.texture.type,n=this.renderer.capabilities,t=this.renderer.getContext();e!==l["UnsignedByteType"]&&(n.isWebGL2?t.getExtension("EXT_color_buffer_float"):t.getExtension("EXT_color_buffer_half_float"))}},{key:"replaceRenderer",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=this.renderer;if(null!==t&&t!==e){var r=t.getSize(new l["Vector2"]),a=e.getSize(new l["Vector2"]),i=t.domElement.parentNode;this.renderer=e,this.renderer.autoClear=!1,r.equals(a)||this.setSize(),n&&null!==i&&(i.removeChild(t.domElement),i.appendChild(e.domElement)),this.enableExtensions()}return t}},{key:"createDepthTexture",value:function(){var e=this.depthTexture=new l["DepthTexture"];return this.inputBuffer.stencilBuffer?(e.format=l["DepthStencilFormat"],e.type=l["UnsignedInt248Type"]):e.type=l["UnsignedIntType"],e}},{key:"createBuffer",value:function(e,n,t,r){var a=this.renderer.getDrawingBufferSize(new l["Vector2"]),i=this.renderer.getContext().getContextAttributes().alpha,o={format:i||t!==l["UnsignedByteType"]?l["RGBAFormat"]:l["RGBFormat"],minFilter:l["LinearFilter"],magFilter:l["LinearFilter"],stencilBuffer:n,depthBuffer:e,type:t},s=r>0?new l["WebGLMultisampleRenderTarget"](a.width,a.height,o):new l["WebGLRenderTarget"](a.width,a.height,o);return r>0&&(s.samples=r),s.texture.name="EffectComposer.Buffer",s.texture.generateMipmaps=!1,s}},{key:"addPass",value:function(e,n){var t=this.passes,r=this.renderer,a=r.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type,o=r.getDrawingBufferSize(new l["Vector2"]);if(e.setSize(o.width,o.height),e.initialize(r,a,i),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==n?t.splice(n,0,e):t.push(e),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){var s,u=this.createDepthTexture(),c=Object(Le["a"])(t);try{for(c.s();!(s=c.n()).done;)e=s.value,e.setDepthTexture(u)}catch(d){c.e(d)}finally{c.f()}}else e.setDepthTexture(this.depthTexture)}},{key:"removePass",value:function(e){var n=this.passes,t=n.indexOf(e),r=n.splice(t,1).length>0;if(r){if(null!==this.depthTexture){var a=function(e,n){return e||n.needsDepthTexture},i=n.reduce(a,!1);if(!i){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.outputBuffer.depthTexture=null,e.setDepthTexture(null);var o,s=Object(Le["a"])(n);try{for(s.s();!(o=s.n()).done;)e=o.value,e.setDepthTexture(null)}catch(l){s.e(l)}finally{s.f()}}}this.autoRenderToScreen&&n.length>0&&t===n.length&&(n[n.length-1].renderToScreen=!0)}}},{key:"render",value:function(e){var n,t,r,a,i=this.renderer,o=this.copyPass,s=this.inputBuffer,l=this.outputBuffer,u=!1,c=Object(Le["a"])(this.passes);try{for(c.s();!(a=c.n()).done;){var d=a.value;d.enabled&&(d.render(i,s,l,e,u),d.needsSwap&&(u&&(o.renderToScreen=d.renderToScreen,n=i.getContext(),t=i.state.buffers.stencil,t.setFunc(n.NOTEQUAL,1,4294967295),o.render(i,s,l,e,u),t.setFunc(n.EQUAL,1,4294967295)),r=s,s=l,l=r),d instanceof Tn?u=!0:d instanceof Oe&&(u=!1))}}catch(f){c.e(f)}finally{c.f()}}},{key:"setSize",value:function(e,n,t){var r=this.renderer;if(void 0===e||void 0===n){var a=r.getSize(new l["Vector2"]);e=a.width,n=a.height}r.setSize(e,n,t);var i=r.getDrawingBufferSize(new l["Vector2"]);this.inputBuffer.setSize(i.width,i.height),this.outputBuffer.setSize(i.width,i.height);var o,s=Object(Le["a"])(this.passes);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.setSize(i.width,i.height)}}catch(c){s.e(c)}finally{s.f()}}},{key:"reset",value:function(){var e=this.inputBuffer.clone();this.dispose(),this.inputBuffer=e,this.outputBuffer=e.clone(),this.depthTexture=null,this.copyPass=new Fn(new pn),this.autoRenderToScreen=!0}},{key:"dispose",value:function(){var e,n=Object(Le["a"])(this.passes);try{for(n.s();!(e=n.n()).done;){var t=e.value;t.dispose()}}catch(r){n.e(r)}finally{n.f()}this.passes=[],null!==this.inputBuffer&&(this.inputBuffer.dispose(),this.inputBuffer=null),null!==this.outputBuffer&&(this.outputBuffer.dispose(),this.outputBuffer=null),null!==this.depthTexture&&this.depthTexture.dispose(),this.copyPass.dispose()}},{key:"multisampling",get:function(){return this.inputBuffer instanceof l["WebGLMultisampleRenderTarget"]?this.inputBuffer.samples:0},set:function(e){var n=this.inputBuffer,t=this.multisampling;t>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e):t!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,e),this.outputBuffer=this.inputBuffer.clone())}}]),e}(),Nn="void mainImage(const in vec4 inputColor, const in vec2 uv, const in float depth, out vec4 outputColor) {\r\n\r\n\t#ifdef INVERTED\r\n\r\n\t\tvec3 color = vec3(1.0 - depth);\r\n\r\n\t#else\r\n\r\n\t\tvec3 color = vec3(depth);\r\n\r\n\t#endif\r\n\r\n\toutputColor = vec4(color, inputColor.a);\r\n\r\n}\r\n",Pn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.blendFunction,i=void 0===a?Xe.NORMAL:a,s=r.inverted,l=void 0!==s&&s;return Object(o["a"])(this,t),e=n.call(this,"DepthEffect",Nn,{blendFunction:i,attributes:cn.DEPTH}),e.inverted=l,e}return Object(s["a"])(t,[{key:"inverted",get:function(){return this.defines.has("INVERTED")},set:function(e){e?this.defines.set("INVERTED","1"):this.defines["delete"]("INVERTED")}}]),t}(un),wn="uniform sampler2D normalBuffer;\r\n\r\nuniform mat4 cameraProjectionMatrix;\r\nuniform mat4 cameraInverseProjectionMatrix;\r\n\r\nuniform vec2 radiusStep;\r\nuniform vec2 distanceCutoff;\r\nuniform vec2 proximityCutoff;\r\nuniform float seed;\r\nuniform float luminanceInfluence;\r\nuniform float scale;\r\nuniform float bias;\r\n\r\nvec3 getViewPosition(const in vec2 screenPosition, const in float depth, const in float viewZ) {\r\n\r\n\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\r\n\tvec4 clipPosition = vec4((vec3(screenPosition, depth) - 0.5) * 2.0, 1.0);\r\n\tclipPosition *= clipW; // Unproject.\r\n\r\n\treturn (cameraInverseProjectionMatrix * clipPosition).xyz;\r\n\r\n}\r\n\r\nfloat getOcclusion(const in vec3 p, const in vec3 n, const in vec3 sampleViewPosition) {\r\n\r\n\tvec3 viewDelta = sampleViewPosition - p;\r\n\tfloat d = length(viewDelta) * scale;\r\n\r\n\treturn max(0.0, dot(n, viewDelta) / d - bias) / (1.0 + pow2(d));\r\n\r\n}\r\n\r\nfloat getAmbientOcclusion(const in vec3 p, const in vec3 n, const in float depth, const in vec2 uv) {\r\n\r\n\tvec2 radius = radiusStep;\r\n\tfloat angle = rand(uv + seed) * PI2;\r\n\tfloat occlusionSum = 0.0;\r\n\r\n\tfor(int i = 0; i < SAMPLES_INT; ++i) {\r\n\r\n\t\tvec2 coord = uv + vec2(cos(angle), sin(angle)) * radius;\r\n\t\tradius += radiusStep;\r\n\t\tangle += ANGLE_STEP;\r\n\r\n\t\tfloat sampleDepth = readDepth(coord);\r\n\t\tfloat viewZ = getViewZ(sampleDepth);\r\n\r\n\t\t#ifdef PERSPECTIVE_CAMERA\r\n\r\n\t\t\tfloat linearSampleDepth = viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\r\n\r\n\t\t#else\r\n\r\n\t\t\tfloat linearSampleDepth = sampleDepth;\r\n\r\n\t\t#endif\r\n\r\n\t\tfloat proximity = abs(depth - linearSampleDepth);\r\n\r\n\t\tif(linearSampleDepth < distanceCutoff.y && proximity < proximityCutoff.y) {\r\n\r\n\t\t\tfloat falloff = 1.0 - smoothstep(proximityCutoff.x, proximityCutoff.y, proximity);\r\n\t\t\tvec3 sampleViewPosition = getViewPosition(coord, sampleDepth, viewZ);\r\n\t\t\tocclusionSum += getOcclusion(p, n, sampleViewPosition) * falloff;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn occlusionSum / SAMPLES_FLOAT;\r\n\r\n}\r\n\r\nvoid mainImage(const in vec4 inputColor, const in vec2 uv, const in float depth, out vec4 outputColor) {\r\n\r\n\tfloat ao = 1.0;\r\n\tfloat viewZ = getViewZ(depth);\r\n\r\n\t#ifdef PERSPECTIVE_CAMERA\r\n\r\n\t\tfloat linearDepth = viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\r\n\r\n\t#else\r\n\r\n\t\tfloat linearDepth = depth;\r\n\r\n\t#endif\r\n\r\n\t// Skip fragments of objects that are too far away.\r\n\tif(linearDepth < distanceCutoff.y) {\r\n\r\n\t\tvec3 viewPosition = getViewPosition(uv, depth, viewZ);\r\n\t\tvec3 viewNormal = unpackRGBToNormal(texture2D(normalBuffer, uv).xyz);\r\n\t\tao -= getAmbientOcclusion(viewPosition, viewNormal, linearDepth, uv);\r\n\r\n\t\t// Fade AO based on luminance and depth.\r\n\t\tfloat l = linearToRelativeLuminance(inputColor.rgb);\r\n\t\tfloat d = smoothstep(distanceCutoff.x, distanceCutoff.y, linearDepth);\r\n\t\tfloat f = max(l * luminanceInfluence, d);\r\n\t\tao = mix(ao, 1.0, f);\r\n\t}\r\n\r\n\toutputColor = vec4(vec3(ao), inputColor.a);\r\n\r\n}\r\n",Rn=function(e){Object(k["a"])(t,e);var n=Object(B["a"])(t);function t(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.blendFunction,u=void 0===s?Xe.MULTIPLY:s,c=i.samples,d=void 0===c?11:c,f=i.rings,p=void 0===f?4:f,h=i.distanceThreshold,m=void 0===h?.97:h,g=i.distanceFalloff,v=void 0===g?.03:g,_=i.rangeThreshold,A=void 0===_?5e-4:_,x=i.rangeFalloff,b=void 0===x?.001:x,y=i.luminanceInfluence,E=void 0===y?.7:y,T=i.radius,S=void 0===T?18.25:T,F=i.scale,L=void 0===F?1:F,N=i.bias,P=void 0===N?0:N;return Object(o["a"])(this,t),a=n.call(this,"SSAOEffect",wn,{blendFunction:u,attributes:cn.DEPTH,defines:new Map([["RINGS_INT","0"],["SAMPLES_INT","0"],["SAMPLES_FLOAT","0.0"]]),uniforms:new Map([["normalBuffer",new l["Uniform"](r)],["cameraInverseProjectionMatrix",new l["Uniform"](new l["Matrix4"])],["cameraProjectionMatrix",new l["Uniform"](new l["Matrix4"])],["radiusStep",new l["Uniform"](new l["Vector2"])],["distanceCutoff",new l["Uniform"](new l["Vector2"])],["proximityCutoff",new l["Uniform"](new l["Vector2"])],["seed",new l["Uniform"](Math.random())],["luminanceInfluence",new l["Uniform"](E)],["scale",new l["Uniform"](L)],["bias",new l["Uniform"](P)]])}),a.r=0,a.resolution=new l["Vector2"](1,1),a.camera=e,a.samples=d,a.rings=p,a.radius=S,a.setDistanceCutoff(m,v),a.setProximityCutoff(A,b),a}return Object(s["a"])(t,[{key:"updateAngleStep",value:function(){this.defines.set("ANGLE_STEP",(2*Math.PI*this.rings/this.samples).toFixed(11))}},{key:"updateRadiusStep",value:function(){var e=this.r/this.samples;this.uniforms.get("radiusStep").value.set(e,e).divide(this.resolution)}},{key:"setDistanceCutoff",value:function(e,n){this.uniforms.get("distanceCutoff").value.set(Math.min(Math.max(e,0),1),Math.min(Math.max(e+n,0),1))}},{key:"setProximityCutoff",value:function(e,n){this.uniforms.get("proximityCutoff").value.set(Math.min(Math.max(e,0),1),Math.min(Math.max(e+n,0),1))}},{key:"setSize",value:function(e,n){this.resolution.set(e,n),this.updateRadiusStep(),this.uniforms.get("cameraInverseProjectionMatrix").value.getInverse(this.camera.projectionMatrix),this.uniforms.get("cameraProjectionMatrix").value.copy(this.camera.projectionMatrix)}},{key:"samples",get:function(){return Number(this.defines.get("SAMPLES_INT"))},set:function(e){e=Math.floor(e),this.defines.set("SAMPLES_INT",e.toFixed(0)),this.defines.set("SAMPLES_FLOAT",e.toFixed(1)),this.updateAngleStep(),this.updateRadiusStep()}},{key:"rings",get:function(){return Number(this.defines.get("RINGS_INT"))},set:function(e){e=Math.floor(e),this.defines.set("RINGS_INT",e.toFixed(0)),this.updateAngleStep()}},{key:"radius",get:function(){return this.r},set:function(e){this.r=e,this.updateRadiusStep()}}]),t}(un),On=(t("a4d3"),t("e01a"),t("d28b"),t("277d"),t("a15b"),t("0d03"),t("1d1c"),t("7a82"),t("e439"),t("3410"),t("131a"),t("acd8"),t("e25e"),t("1276"),t("53ca"));function Mn(e){if(e&&"undefined"!==typeof window){var n=document.createElement("style");return n.setAttribute("type","text/css"),n.innerHTML=e,document.head.appendChild(n),e}}function Cn(e,n){var t=e.__state.conversionName.toString(),r=Math.round(e.r),a=Math.round(e.g),i=Math.round(e.b),o=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(n||"THREE_CHAR_HEX"===t||"SIX_CHAR_HEX"===t){var c=e.hex.toString(16);while(c.length<6)c="0"+c;return"#"+c}return"CSS_RGB"===t?"rgb("+r+","+a+","+i+")":"CSS_RGBA"===t?"rgba("+r+","+a+","+i+","+o+")":"HEX"===t?"0x"+e.hex.toString(16):"RGB_ARRAY"===t?"["+r+","+a+","+i+"]":"RGBA_ARRAY"===t?"["+r+","+a+","+i+","+o+"]":"RGB_OBJ"===t?"{r:"+r+",g:"+a+",b:"+i+"}":"RGBA_OBJ"===t?"{r:"+r+",g:"+a+",b:"+i+",a:"+o+"}":"HSV_OBJ"===t?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===t?"{h:"+s+",s:"+l+",v:"+u+",a:"+o+"}":"unknown format"}var In=Array.prototype.forEach,Un=Array.prototype.slice,Dn={BREAK:{},extend:function(e){return this.each(Un.call(arguments,1),(function(n){var t=this.isObject(n)?Object.keys(n):[];t.forEach(function(t){this.isUndefined(n[t])||(e[t]=n[t])}.bind(this))}),this),e},defaults:function(e){return this.each(Un.call(arguments,1),(function(n){var t=this.isObject(n)?Object.keys(n):[];t.forEach(function(t){this.isUndefined(e[t])&&(e[t]=n[t])}.bind(this))}),this),e},compose:function(){var e=Un.call(arguments);return function(){for(var n=Un.call(arguments),t=e.length-1;t>=0;t--)n=[e[t].apply(this,n)];return n[0]}},each:function(e,n,t){if(e)if(In&&e.forEach&&e.forEach===In)e.forEach(n,t);else if(e.length===e.length+0){var r=void 0,a=void 0;for(r=0,a=e.length;r<a;r++)if(r in e&&n.call(t,e[r],r)===this.BREAK)return}else for(var i in e)if(n.call(t,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,n,t){var r=void 0;return function(){var a=this,i=arguments;function o(){r=null,t||e.apply(a,i)}var s=t||!r;clearTimeout(r),r=setTimeout(o,n),s&&e.apply(a,i)}},toArray:function(e){return e.toArray?e.toArray():Un.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function n(){return e.apply(this,arguments)}return n.toString=function(){return e.toString()},n}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},kn=[{litmus:Dn.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==n&&{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:Cn},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return null!==n&&{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:Cn},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==n&&{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:Cn},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==n&&{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:Cn}}},{litmus:Dn.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Dn.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Dn.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Dn.isNumber(e.r)&&Dn.isNumber(e.g)&&Dn.isNumber(e.b)&&Dn.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Dn.isNumber(e.r)&&Dn.isNumber(e.g)&&Dn.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Dn.isNumber(e.h)&&Dn.isNumber(e.s)&&Dn.isNumber(e.v)&&Dn.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Dn.isNumber(e.h)&&Dn.isNumber(e.s)&&Dn.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Bn=void 0,Hn=void 0,Xn=function(){Hn=!1;var e=arguments.length>1?Dn.toArray(arguments):arguments[0];return Dn.each(kn,(function(n){if(n.litmus(e))return Dn.each(n.conversions,(function(n,t){if(Bn=n.read(e),!1===Hn&&!1!==Bn)return Hn=Bn,Bn.conversionName=t,Bn.conversion=n,Dn.BREAK})),Dn.BREAK})),Hn},Vn=void 0,Gn={hsv_to_rgb:function(e,n,t){var r=Math.floor(e/60)%6,a=e/60-Math.floor(e/60),i=t*(1-n),o=t*(1-a*n),s=t*(1-(1-a)*n),l=[[t,s,i],[o,t,i],[i,t,s],[i,o,t],[s,i,t],[t,i,o]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,n,t){var r=Math.min(e,n,t),a=Math.max(e,n,t),i=a-r,o=void 0,s=void 0;return 0===a?{h:NaN,s:0,v:0}:(s=i/a,o=e===a?(n-t)/i:n===a?2+(t-e)/i:4+(e-n)/i,o/=6,o<0&&(o+=1),{h:360*o,s:s,v:a/255})},rgb_to_hex:function(e,n,t){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,n),r=this.hex_with_component(r,0,t),r},component_from_hex:function(e,n){return e>>8*n&255},hex_with_component:function(e,n,t){return t<<(Vn=8*n)|e&~(255<<Vn)}},jn="function"===typeof Symbol&&"symbol"===Object(On["a"])(Symbol.iterator)?function(e){return Object(On["a"])(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":Object(On["a"])(e)},Yn=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},zn=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),Qn=function e(n,t,r){null===n&&(n=Function.prototype);var a=Object.getOwnPropertyDescriptor(n,t);if(void 0===a){var i=Object.getPrototypeOf(n);return null===i?void 0:e(i,t,r)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(r):void 0},Wn=function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+Object(On["a"])(n));e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},Kn=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==Object(On["a"])(n)&&"function"!==typeof n?e:n},qn=function(){function e(){if(Yn(this,e),this.__state=Xn.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return zn(e,[{key:"toString",value:function(){return Cn(this)}},{key:"toHexString",value:function(){return Cn(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Zn(e,n,t){Object.defineProperty(e,n,{get:function(){return"RGB"===this.__state.space||qn.recalculateRGB(this,n,t),this.__state[n]},set:function(e){"RGB"!==this.__state.space&&(qn.recalculateRGB(this,n,t),this.__state.space="RGB"),this.__state[n]=e}})}function Jn(e,n){Object.defineProperty(e,n,{get:function(){return"HSV"===this.__state.space||qn.recalculateHSV(this),this.__state[n]},set:function(e){"HSV"!==this.__state.space&&(qn.recalculateHSV(this),this.__state.space="HSV"),this.__state[n]=e}})}qn.recalculateRGB=function(e,n,t){if("HEX"===e.__state.space)e.__state[n]=Gn.component_from_hex(e.__state.hex,t);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Dn.extend(e.__state,Gn.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},qn.recalculateHSV=function(e){var n=Gn.rgb_to_hsv(e.r,e.g,e.b);Dn.extend(e.__state,{s:n.s,v:n.v}),Dn.isNaN(n.h)?Dn.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h},qn.COMPONENTS=["r","g","b","h","s","v","hex","a"],Zn(qn.prototype,"r",2),Zn(qn.prototype,"g",1),Zn(qn.prototype,"b",0),Jn(qn.prototype,"h"),Jn(qn.prototype,"s"),Jn(qn.prototype,"v"),Object.defineProperty(qn.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(qn.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Gn.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var $n=function(){function e(n,t){Yn(this,e),this.initialValue=n[t],this.domElement=document.createElement("div"),this.object=n,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return zn(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),et={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},nt={};Dn.each(et,(function(e,n){Dn.each(e,(function(e){nt[e]=n}))}));var tt=/(\d+(\.\d+)?)px/;function rt(e){if("0"===e||Dn.isUndefined(e))return 0;var n=e.match(tt);return Dn.isNull(n)?0:parseFloat(n[1])}var at={makeSelectable:function(e,n){void 0!==e&&void 0!==e.style&&(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,t){var r=t,a=n;Dn.isUndefined(a)&&(a=!0),Dn.isUndefined(r)&&(r=!0),e.style.position="absolute",a&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,t,r){var a=t||{},i=nt[n];if(!i)throw new Error("Event type "+n+" not supported.");var o=document.createEvent(i);switch(i){case"MouseEvents":var s=a.x||a.clientX||0,l=a.y||a.clientY||0;o.initMouseEvent(n,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=o.initKeyboardEvent||o.initKeyEvent;Dn.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(n,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break;default:o.initEvent(n,a.bubbles||!1,a.cancelable||!0);break}Dn.defaults(o,r),e.dispatchEvent(o)},bind:function(e,n,t,r){var a=r||!1;return e.addEventListener?e.addEventListener(n,t,a):e.attachEvent&&e.attachEvent("on"+n,t),at},unbind:function(e,n,t,r){var a=r||!1;return e.removeEventListener?e.removeEventListener(n,t,a):e.detachEvent&&e.detachEvent("on"+n,t),at},addClass:function(e,n){if(void 0===e.className)e.className=n;else if(e.className!==n){var t=e.className.split(/ +/);-1===t.indexOf(n)&&(t.push(n),e.className=t.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return at},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var t=e.className.split(/ +/),r=t.indexOf(n);-1!==r&&(t.splice(r,1),e.className=t.join(" "))}else e.className=void 0;return at},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return rt(n["border-left-width"])+rt(n["border-right-width"])+rt(n["padding-left"])+rt(n["padding-right"])+rt(n.width)},getHeight:function(e){var n=getComputedStyle(e);return rt(n["border-top-width"])+rt(n["border-bottom-width"])+rt(n["padding-top"])+rt(n["padding-bottom"])+rt(n.height)},getOffset:function(e){var n=e,t={left:0,top:0};if(n.offsetParent)do{t.left+=n.offsetLeft,t.top+=n.offsetTop,n=n.offsetParent}while(n);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},it=function(e){function n(e,t){Yn(this,n);var r=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t)),a=r;function i(){a.setValue(!a.__prev)}return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),at.bind(r.__checkbox,"change",i,!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return Wn(n,e),zn(n,[{key:"setValue",value:function(e){var t=Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"updateDisplay",this).call(this)}}]),n}($n),ot=function(e){function n(e,t,r){Yn(this,n);var a=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t)),i=r,o=a;if(a.__select=document.createElement("select"),Dn.isArray(i)){var s={};Dn.each(i,(function(e){s[e]=e})),i=s}return Dn.each(i,(function(e,n){var t=document.createElement("option");t.innerHTML=n,t.setAttribute("value",e),o.__select.appendChild(t)})),a.updateDisplay(),at.bind(a.__select,"change",(function(){var e=this.options[this.selectedIndex].value;o.setValue(e)})),a.domElement.appendChild(a.__select),a}return Wn(n,e),zn(n,[{key:"setValue",value:function(e){var t=Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t}},{key:"updateDisplay",value:function(){return at.isActive(this.__select)?this:(this.__select.value=this.getValue(),Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"updateDisplay",this).call(this))}}]),n}($n),st=function(e){function n(e,t){Yn(this,n);var r=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t)),a=r;function i(){a.setValue(a.__input.value)}function o(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),at.bind(r.__input,"keyup",i),at.bind(r.__input,"change",i),at.bind(r.__input,"blur",o),at.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Wn(n,e),zn(n,[{key:"updateDisplay",value:function(){return at.isActive(this.__input)||(this.__input.value=this.getValue()),Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"updateDisplay",this).call(this)}}]),n}($n);function lt(e){var n=e.toString();return n.indexOf(".")>-1?n.length-n.indexOf(".")-1:0}var ut=function(e){function n(e,t,r){Yn(this,n);var a=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t)),i=r||{};return a.__min=i.min,a.__max=i.max,a.__step=i.step,Dn.isUndefined(a.__step)?0===a.initialValue?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=lt(a.__impliedStep),a}return Wn(n,e),zn(n,[{key:"setValue",value:function(e){var t=e;return void 0!==this.__min&&t<this.__min?t=this.__min:void 0!==this.__max&&t>this.__max&&(t=this.__max),void 0!==this.__step&&t%this.__step!==0&&(t=Math.round(t/this.__step)*this.__step),Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setValue",this).call(this,t)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=lt(e),this}}]),n}($n);function ct(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t}var dt=function(e){function n(e,t,r){Yn(this,n);var a=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,r));a.__truncationSuspended=!1;var i=a,o=void 0;function s(){var e=parseFloat(i.__input.value);Dn.isNaN(e)||i.setValue(e)}function l(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function u(){l()}function c(e){var n=o-e.clientY;i.setValue(i.getValue()+n*i.__impliedStep),o=e.clientY}function d(){at.unbind(window,"mousemove",c),at.unbind(window,"mouseup",d),l()}function f(e){at.bind(window,"mousemove",c),at.bind(window,"mouseup",d),o=e.clientY}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),at.bind(a.__input,"change",s),at.bind(a.__input,"blur",u),at.bind(a.__input,"mousedown",f),at.bind(a.__input,"keydown",(function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,l())})),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return Wn(n,e),zn(n,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():ct(this.getValue(),this.__precision),Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"updateDisplay",this).call(this)}}]),n}(ut);function ft(e,n,t,r,a){return r+(e-n)/(t-n)*(a-r)}var pt=function(e){function n(e,t,r,a,i){Yn(this,n);var o=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,{min:r,max:a,step:i})),s=o;function l(e){document.activeElement.blur(),at.bind(window,"mousemove",u),at.bind(window,"mouseup",c),u(e)}function u(e){e.preventDefault();var n=s.__background.getBoundingClientRect();return s.setValue(ft(e.clientX,n.left,n.right,s.__min,s.__max)),!1}function c(){at.unbind(window,"mousemove",u),at.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function d(e){1===e.touches.length&&(at.bind(window,"touchmove",f),at.bind(window,"touchend",p),f(e))}function f(e){var n=e.touches[0].clientX,t=s.__background.getBoundingClientRect();s.setValue(ft(n,t.left,t.right,s.__min,s.__max))}function p(){at.unbind(window,"touchmove",f),at.unbind(window,"touchend",p),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),at.bind(o.__background,"mousedown",l),at.bind(o.__background,"touchstart",d),at.addClass(o.__background,"slider"),at.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return Wn(n,e),zn(n,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Qn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"updateDisplay",this).call(this)}}]),n}(ut),ht=function(e){function n(e,t,r){Yn(this,n);var a=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t)),i=a;return a.__button=document.createElement("div"),a.__button.innerHTML=void 0===r?"Fire":r,at.bind(a.__button,"click",(function(e){return e.preventDefault(),i.fire(),!1})),at.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return Wn(n,e),zn(n,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),n}($n),mt=function(e){function n(e,t){Yn(this,n);var r=Kn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));r.__color=new qn(r.getValue()),r.__temp=new qn(0);var a=r;r.domElement=document.createElement("div"),at.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",at.bind(r.__input,"keydown",(function(e){13===e.keyCode&&c.call(this)})),at.bind(r.__input,"blur",c),at.bind(r.__selector,"mousedown",(function(){at.addClass(this,"drag").bind(window,"mouseup",(function(){at.removeClass(a.__selector,"drag")}))})),at.bind(r.__selector,"touchstart",(function(){at.addClass(this,"drag").bind(window,"touchend",(function(){at.removeClass(a.__selector,"drag")}))}));var i=document.createElement("div");function o(e){f(e),at.bind(window,"mousemove",f),at.bind(window,"touchmove",f),at.bind(window,"mouseup",l),at.bind(window,"touchend",l)}function s(e){p(e),at.bind(window,"mousemove",p),at.bind(window,"touchmove",p),at.bind(window,"mouseup",u),at.bind(window,"touchend",u)}function l(){at.unbind(window,"mousemove",f),at.unbind(window,"touchmove",f),at.unbind(window,"mouseup",l),at.unbind(window,"touchend",l),d()}function u(){at.unbind(window,"mousemove",p),at.unbind(window,"touchmove",p),at.unbind(window,"mouseup",u),at.unbind(window,"touchend",u),d()}function c(){var e=Xn(this.value);!1!==e?(a.__color.__state=e,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function d(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function f(e){-1===e.type.indexOf("touch")&&e.preventDefault();var n=a.__saturation_field.getBoundingClientRect(),t=e.touches&&e.touches[0]||e,r=t.clientX,i=t.clientY,o=(r-n.left)/(n.right-n.left),s=1-(i-n.top)/(n.bottom-n.top);return s>1?s=1:s<0&&(s=0),o>1?o=1:o<0&&(o=0),a.__color.v=s,a.__color.s=o,a.setValue(a.__color.toOriginal()),!1}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var n=a.__hue_field.getBoundingClientRect(),t=e.touches&&e.touches[0]||e,r=t.clientY,i=1-(r-n.top)/(n.bottom-n.top);return i>1?i=1:i<0&&(i=0),a.__color.h=360*i,a.setValue(a.__color.toOriginal()),!1}return Dn.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Dn.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Dn.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Dn.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Dn.extend(i.style,{width:"100%",height:"100%",background:"none"}),vt(i,"top","rgba(0,0,0,0)","#000"),Dn.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),_t(r.__hue_field),Dn.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),at.bind(r.__saturation_field,"mousedown",o),at.bind(r.__saturation_field,"touchstart",o),at.bind(r.__field_knob,"mousedown",o),at.bind(r.__field_knob,"touchstart",o),at.bind(r.__hue_field,"mousedown",s),at.bind(r.__hue_field,"touchstart",s),r.__saturation_field.appendChild(i),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return Wn(n,e),zn(n,[{key:"updateDisplay",value:function(){var e=Xn(this.getValue());if(!1!==e){var n=!1;Dn.each(qn.COMPONENTS,(function(t){if(!Dn.isUndefined(e[t])&&!Dn.isUndefined(this.__color.__state[t])&&e[t]!==this.__color.__state[t])return n=!0,{}}),this),n&&Dn.extend(this.__color.__state,e)}Dn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var t=this.__color.v<.5||this.__color.s>.5?255:0,r=255-t;Dn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+t+","+t+","+t+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,vt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Dn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+t+","+t+","+t+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),n}($n),gt=["-moz-","-o-","-webkit-","-ms-",""];function vt(e,n,t,r){e.style.background="",Dn.each(gt,(function(a){e.style.cssText+="background: "+a+"linear-gradient("+n+", "+t+" 0%, "+r+" 100%); "}))}function _t(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var At={load:function(e,n){var t=n||document,r=t.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,n){var t=n||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var a=t.getElementsByTagName("head")[0];try{a.appendChild(r)}catch(i){}}},xt='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',bt=function(e,n){var t=e[n];return Dn.isArray(arguments[2])||Dn.isObject(arguments[2])?new ot(e,n,arguments[2]):Dn.isNumber(t)?Dn.isNumber(arguments[2])&&Dn.isNumber(arguments[3])?Dn.isNumber(arguments[4])?new pt(e,n,arguments[2],arguments[3],arguments[4]):new pt(e,n,arguments[2],arguments[3]):Dn.isNumber(arguments[4])?new dt(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new dt(e,n,{min:arguments[2],max:arguments[3]}):Dn.isString(t)?new st(e,n):Dn.isFunction(t)?new ht(e,n,""):Dn.isBoolean(t)?new it(e,n):null};function yt(e){setTimeout(e,1e3/60)}var Et=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||yt,Tt=function(){function e(){Yn(this,e),this.backgroundElement=document.createElement("div"),Dn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),at.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Dn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;at.bind(this.backgroundElement,"click",(function(){n.hide()}))}return zn(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Dn.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,n=function n(){e.domElement.style.display="none",e.backgroundElement.style.display="none",at.unbind(e.domElement,"webkitTransitionEnd",n),at.unbind(e.domElement,"transitionend",n),at.unbind(e.domElement,"oTransitionEnd",n)};at.bind(this.domElement,"webkitTransitionEnd",n),at.bind(this.domElement,"transitionend",n),at.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-at.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-at.getHeight(this.domElement)/2+"px"}}]),e}(),St=Mn(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");At.inject(St);var Ft="dg",Lt=72,Nt=20,Pt="Default",wt=function(){try{return!!window.localStorage}catch(e){return!1}}(),Rt=void 0,Ot=!0,Mt=void 0,Ct=!1,It=[],Ut=function e(n){var t=this,r=n||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),at.addClass(this.domElement,Ft),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Dn.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=Dn.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Dn.isUndefined(r.load)?r.load={preset:Pt}:r.preset&&(r.load.preset=r.preset),Dn.isUndefined(r.parent)&&r.hideable&&It.push(this),r.resizable=Dn.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Dn.isUndefined(r.scrollable)&&(r.scrollable=!0);var a=wt&&"true"===localStorage.getItem(Gt(this,"isLocal")),i=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:r.load.preset},set:function(e){t.parent?t.getRoot().preset=e:r.load.preset=e,qt(this),t.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,Wt(t,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,o&&(o.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(n){r.closed=n,r.closed?at.addClass(t.__ul,e.CLASS_CLOSED):at.removeClass(t.__ul,e.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=n?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(e){wt&&(a=e,e?at.bind(window,"unload",i):at.unbind(window,"unload",i),localStorage.setItem(Gt(t,"isLocal"),e))}}}),Dn.isUndefined(r.parent)){if(this.closed=r.closed||!1,at.addClass(this.domElement,e.CLASS_MAIN),at.makeSelectable(this.domElement,!1),wt&&a){t.useLocalStorage=!0;var s=localStorage.getItem(Gt(this,"gui"));s&&(r.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,at.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(at.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(at.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),at.bind(this.__closeButton,"click",(function(){t.closed=!t.closed}))}else{void 0===r.closed&&(r.closed=!0);var l=document.createTextNode(r.name);at.addClass(l,"controller-name"),o=Dt(t,l);var u=function(e){return e.preventDefault(),t.closed=!t.closed,!1};at.addClass(this.__ul,e.CLASS_CLOSED),at.addClass(o,"title"),at.bind(o,"click",u),r.closed||(this.closed=!1)}function c(){var e=t.getRoot();e.width+=1,Dn.defer((function(){e.width-=1}))}r.autoPlace&&(Dn.isUndefined(r.parent)&&(Ot&&(Mt=document.createElement("div"),at.addClass(Mt,Ft),at.addClass(Mt,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Mt),Ot=!1),Mt.appendChild(this.domElement),at.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||Wt(t,r.width)),this.__resizeHandler=function(){t.onResizeDebounced()},at.bind(window,"resize",this.__resizeHandler),at.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),at.bind(this.__ul,"transitionend",this.__resizeHandler),at.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Qt(this),i=function(){wt&&"true"===localStorage.getItem(Gt(t,"isLocal"))&&localStorage.setItem(Gt(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=i,r.parent||c()};function Dt(e,n,t){var r=document.createElement("li");return n&&r.appendChild(n),t?e.__ul.insertBefore(r,t):e.__ul.appendChild(r),e.onResize(),r}function kt(e){at.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&at.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Bt(e,n){var t=e.__preset_select[e.__preset_select.selectedIndex];t.innerHTML=n?t.value+"*":t.value}function Ht(e,n,t){if(t.__li=n,t.__gui=e,Dn.extend(t,{options:function(n){if(arguments.length>1){var r=t.__li.nextElementSibling;return t.remove(),Vt(e,t.object,t.property,{before:r,factoryArgs:[Dn.toArray(arguments)]})}if(Dn.isArray(n)||Dn.isObject(n)){var a=t.__li.nextElementSibling;return t.remove(),Vt(e,t.object,t.property,{before:a,factoryArgs:[n]})}},name:function(e){return t.__li.firstElementChild.firstElementChild.innerHTML=e,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof pt){var r=new dt(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});Dn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var n=t[e],a=r[e];t[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return a.apply(r,e),n.apply(t,e)}})),at.addClass(n,"has-slider"),t.domElement.insertBefore(r.domElement,t.domElement.firstElementChild)}else if(t instanceof dt){var a=function(n){if(Dn.isNumber(t.__min)&&Dn.isNumber(t.__max)){var r=t.__li.firstElementChild.firstElementChild.innerHTML,a=t.__gui.__listening.indexOf(t)>-1;t.remove();var i=Vt(e,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return i.name(r),a&&i.listen(),i}return n};t.min=Dn.compose(a,t.min),t.max=Dn.compose(a,t.max)}else t instanceof it?(at.bind(n,"click",(function(){at.fakeEvent(t.__checkbox,"click")})),at.bind(t.__checkbox,"click",(function(e){e.stopPropagation()}))):t instanceof ht?(at.bind(n,"click",(function(){at.fakeEvent(t.__button,"click")})),at.bind(n,"mouseover",(function(){at.addClass(t.__button,"hover")})),at.bind(n,"mouseout",(function(){at.removeClass(t.__button,"hover")}))):t instanceof mt&&(at.addClass(n,"color"),t.updateDisplay=Dn.compose((function(e){return n.style.borderLeftColor=t.__color.toString(),e}),t.updateDisplay),t.updateDisplay());t.setValue=Dn.compose((function(n){return e.getRoot().__preset_select&&t.isModified()&&Bt(e.getRoot(),!0),n}),t.setValue)}function Xt(e,n){var t=e.getRoot(),r=t.__rememberedObjects.indexOf(n.object);if(-1!==r){var a=t.__rememberedObjectIndecesToControllers[r];if(void 0===a&&(a={},t.__rememberedObjectIndecesToControllers[r]=a),a[n.property]=n,t.load&&t.load.remembered){var i=t.load.remembered,o=void 0;if(i[e.preset])o=i[e.preset];else{if(!i[Pt])return;o=i[Pt]}if(o[r]&&void 0!==o[r][n.property]){var s=o[r][n.property];n.initialValue=s,n.setValue(s)}}}}function Vt(e,n,t,r){if(void 0===n[t])throw new Error('Object "'+n+'" has no property "'+t+'"');var a=void 0;if(r.color)a=new mt(n,t);else{var i=[n,t].concat(r.factoryArgs);a=bt.apply(e,i)}r.before instanceof $n&&(r.before=r.before.__li),Xt(e,a),at.addClass(a.domElement,"c");var o=document.createElement("span");at.addClass(o,"property-name"),o.innerHTML=a.property;var s=document.createElement("div");s.appendChild(o),s.appendChild(a.domElement);var l=Dt(e,s,r.before);return at.addClass(l,Ut.CLASS_CONTROLLER_ROW),a instanceof mt?at.addClass(l,"color"):at.addClass(l,jn(a.getValue())),Ht(e,l,a),e.__controllers.push(a),a}function Gt(e,n){return document.location.href+"."+n}function jt(e,n,t){var r=document.createElement("option");r.innerHTML=n,r.value=n,e.__preset_select.appendChild(r),t&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Yt(e,n){n.style.display=e.useLocalStorage?"block":"none"}function zt(e){var n=e.__save_row=document.createElement("li");at.addClass(e.domElement,"has-save"),e.__ul.insertBefore(n,e.__ul.firstChild),at.addClass(n,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",at.addClass(t,"button gears");var r=document.createElement("span");r.innerHTML="Save",at.addClass(r,"button"),at.addClass(r,"save");var a=document.createElement("span");a.innerHTML="New",at.addClass(a,"button"),at.addClass(a,"save-as");var i=document.createElement("span");i.innerHTML="Revert",at.addClass(i,"button"),at.addClass(i,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?Dn.each(e.load.remembered,(function(n,t){jt(e,t,t===e.preset)})):jt(e,Pt,!1),at.bind(o,"change",(function(){for(var n=0;n<e.__preset_select.length;n++)e.__preset_select[n].innerHTML=e.__preset_select[n].value;e.preset=this.value})),n.appendChild(o),n.appendChild(t),n.appendChild(r),n.appendChild(a),n.appendChild(i),wt){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block","true"===localStorage.getItem(Gt(e,"isLocal"))&&l.setAttribute("checked","checked"),Yt(e,s),at.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,Yt(e,s)}))}var c=document.getElementById("dg-new-constructor");at.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Rt.hide()})),at.bind(t,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Rt.show(),c.focus(),c.select()})),at.bind(r,"click",(function(){e.save()})),at.bind(a,"click",(function(){var n=prompt("Enter a new preset name.");n&&e.saveAs(n)})),at.bind(i,"click",(function(){e.revert()}))}function Qt(e){var n=void 0;function t(t){return t.preventDefault(),e.width+=n-t.clientX,e.onResize(),n=t.clientX,!1}function r(){at.removeClass(e.__closeButton,Ut.CLASS_DRAG),at.unbind(window,"mousemove",t),at.unbind(window,"mouseup",r)}function a(a){return a.preventDefault(),n=a.clientX,at.addClass(e.__closeButton,Ut.CLASS_DRAG),at.bind(window,"mousemove",t),at.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),Dn.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),at.bind(e.__resize_handle,"mousedown",a),at.bind(e.__closeButton,"mousedown",a),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function Wt(e,n){e.domElement.style.width=n+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=n+"px"),e.__closeButton&&(e.__closeButton.style.width=n+"px")}function Kt(e,n){var t={};return Dn.each(e.__rememberedObjects,(function(r,a){var i={},o=e.__rememberedObjectIndecesToControllers[a];Dn.each(o,(function(e,t){i[t]=n?e.initialValue:e.getValue()})),t[a]=i})),t}function qt(e){for(var n=0;n<e.__preset_select.length;n++)e.__preset_select[n].value===e.preset&&(e.__preset_select.selectedIndex=n)}function Zt(e){0!==e.length&&Et.call(window,(function(){Zt(e)})),Dn.each(e,(function(e){e.updateDisplay()}))}Ut.toggleHide=function(){Ct=!Ct,Dn.each(It,(function(e){e.domElement.style.display=Ct?"none":""}))},Ut.CLASS_AUTO_PLACE="a",Ut.CLASS_AUTO_PLACE_CONTAINER="ac",Ut.CLASS_MAIN="main",Ut.CLASS_CONTROLLER_ROW="cr",Ut.CLASS_TOO_TALL="taller-than-window",Ut.CLASS_CLOSED="closed",Ut.CLASS_CLOSE_BUTTON="close-button",Ut.CLASS_CLOSE_TOP="close-top",Ut.CLASS_CLOSE_BOTTOM="close-bottom",Ut.CLASS_DRAG="drag",Ut.DEFAULT_WIDTH=245,Ut.TEXT_CLOSED="Close Controls",Ut.TEXT_OPEN="Open Controls",Ut._keydownHandler=function(e){"text"===document.activeElement.type||e.which!==Lt&&e.keyCode!==Lt||Ut.toggleHide()},at.bind(window,"keydown",Ut._keydownHandler,!1),Dn.extend(Ut.prototype,{add:function(e,n){return Vt(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return Vt(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;Dn.defer((function(){n.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Mt.removeChild(this.domElement);var e=this;Dn.each(this.__folders,(function(n){e.removeFolder(n)})),at.unbind(window,"keydown",Ut._keydownHandler,!1),kt(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var t=new Ut(n);this.__folders[e]=t;var r=Dt(this,t.domElement);return at.addClass(r,"folder"),t},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],kt(e);var n=this;Dn.each(e.__folders,(function(n){e.removeFolder(n)})),Dn.defer((function(){n.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=at.getOffset(e.__ul).top,t=0;Dn.each(e.__ul.childNodes,(function(n){e.autoPlace&&n===e.__save_row||(t+=at.getHeight(n))})),window.innerHeight-n-Nt<t?(at.addClass(e.domElement,Ut.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-Nt+"px"):(at.removeClass(e.domElement,Ut.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Dn.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Dn.debounce((function(){this.onResize()}),50),remember:function(){if(Dn.isUndefined(Rt)&&(Rt=new Tt,Rt.domElement.innerHTML=xt),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Dn.each(Array.prototype.slice.call(arguments),(function(n){0===e.__rememberedObjects.length&&zt(e),-1===e.__rememberedObjects.indexOf(n)&&e.__rememberedObjects.push(n)})),this.autoPlace&&Wt(this,this.width)},getRoot:function(){var e=this;while(e.parent)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Kt(this)),e.folders={},Dn.each(this.__folders,(function(n,t){e.folders[t]=n.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Kt(this),Bt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Pt]=Kt(this,!0)),this.load.remembered[e]=Kt(this),this.preset=e,jt(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Dn.each(this.__controllers,(function(n){this.getRoot().load.remembered?Xt(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),this),Dn.each(this.__folders,(function(e){e.revert(e)})),e||Bt(this.getRoot(),!1)},listen:function(e){var n=0===this.__listening.length;this.__listening.push(e),n&&Zt(this.__listening)},updateDisplay:function(){Dn.each(this.__controllers,(function(e){e.updateDisplay()})),Dn.each(this.__folders,(function(e){e.updateDisplay()}))}});var Jt=Ut,$t=function(){function e(n,t,r){Object(o["a"])(this,e),this.gltf=t,this.gltfScene=t.scene,this.clock=new l["Clock"],this.animationMixer=null,this.debug=!1,this.program=new fe,this.isMobile=Fe(),this.envRotation=0,this.envRotationFromPanel=(new l["Matrix4"]).makeRotationY(this.envRotation),this.envRotationMat4=(new l["Matrix4"]).copy(this.envRotationFromPanel),this.envRotationMat={value:(new l["Matrix3"]).setFromMatrix4(this.envRotationMat4)},this.envRotationMatBG={value:(new l["Matrix3"]).copy(this.envRotationMat.value)},this.envBrightness={value:1},this.cameraRotationMatrix=new l["Matrix4"],this.sunLightPanelRotateMat=new l["Matrix4"],this.renderer=n.renderer,this.renderer.toneMapping=l["".concat(Ae[0],"ToneMapping")],this.scene=n.scene,this.camera=n.camera,this.container=n.container,this.width=n.width,this.height=n.height,this.callBack=r,this.control=new c(this.camera,this.container),this.initScene(),this.initPostProcessing()}return Object(s["a"])(e,[{key:"loadEnvMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he[0],n="".concat(pe).concat(e,"/");return new D(this).loadPackage(n)}},{key:"loadSunLight",value:function(e){this.sunLight||(this.sunLight=new l["DirectionalLight"](16777215,1)),this.sunLight.position.copy(e.position),this.sunLight.castShadow=!0,this.scene.add(this.sunLight)}},{key:"loadBackground",value:function(e,n){this.background?(this.background.material.uniforms.envMap.value=e.texture,this.background.material.uniforms.uEnvironmentSize.value=n):(this.background=new K({envMap:e.texture,uBGEnvironmentSize:n,uEnvBrightness:this.envBrightness,debug:this.debug},500),this.background.material.uniforms.uEnvironmentTransform=this.envRotationMatBG)}},{key:"updateEnvMap",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(n,t){var r,a,i,o,s,l,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadEnvMap(n);case 2:r=e.sent,a=r.mapEnv,i=r.backgroundEnv,o=r.uEnvironmentSphericalHarmonics,s=r.uEnvironmentLodRange,l=r.uEnvironmentSize,u=r.uBGEnvironmentSize,c=r.sunlightInfo,this.loadSunLight(c),this.sunLightStartPos=this.sunLight.position.clone(),this.loadBackground(i,u),this.gltfScene.traverse((function(e){e.isMesh&&(e.material.uniforms.envMap.value=a.texture,e.material.uniforms["uEnvironmentSphericalHarmonics"]={value:o},e.material.uniforms["uEnvironmentLodRange"]={value:s},e.material.uniforms["uEnvironmentSize"]={value:l},e.material.needsUpdate=!0)})),"function"==typeof t&&t();case 9:case"end":return e.stop()}}),e,this)})));function n(n,t){return e.apply(this,arguments)}return n}()},{key:"initScene",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var n,t,r,a,i,o,s,u,c,d,f,p,h,m,g=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadEnvMap();case 2:if(n=e.sent,t=n.backgroundEnv,r=n.uBGEnvironmentSize,a=n.sunlightInfo,i=this.scene,this.loadSunLight(a),this.loadBackground(t,r),i.add(this.background),o=this.gltfScene,s=this.gltf.animations,s&&s.length)for(this.animationMixer=new l["AnimationMixer"](o),u=0;u<s.length;u++)c=s[u],d=this.animationMixer.clipAction(c),d.play();i.add(o),this.adjustFactorFromBox(o),f=this.program.getPBRShader(),p=f.pbrVS,h=f.pbrFS,m=this.shadowDepthRange=new l["Vector2"](this.sunLight.shadow.camera.near,this.sunLight.shadow.camera.far),o.traverse((function(e){e.isMesh&&(e.material=new Y(e,n,{pbrVS:p,pbrFS:h,shadowDepthRange:m}),e.material.uniforms.uEnvironmentTransform=g.envRotationMat,e.material.uniforms.uEnvBrightness=g.envBrightness,e.castShadow=!0,e.receiveShadow=!0,e.material.uniforms.uEnableIBL=g.enableIBL,e.material.uniforms.uEnableLight=g.enableLight)})),this.initEvent(),this.initGUI(),"function"===typeof this.callBack&&this.callBack();case 19:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}()},{key:"adjustFactorFromBox",value:function(e){var n=this.box=(new l["Box3"]).setFromObject(e),t=n.getSize(new l["Vector3"]),r=Math.max(t.x,t.y,t.z);if(r<100){var a=100/r;e.scale.setScalar(a)}n=this.box=(new l["Box3"]).setFromObject(e);var i=n.getCenter(new l["Vector3"]);if(e.position.sub(i),this.debug){var o=new l["BoxHelper"](e,16776960);this.scene.add(o)}ye(this.camera,e,this.control,2),this.background.setSize(this.camera.far),Ee(this.sunLight,this.scene,e,this.debug),this.sunLightStartPos=this.sunLight.position.clone()}},{key:"initEvent",value:function(){var e=this,n={x:0};window.addEventListener("mousemove",(function(t){var r=t.which||t.button;if(t.altKey&&r){t.stopPropagation();var a=t.clientX-n.x;e.envRotation+=.01*a}n.x=t.clientX}),!0)}},{key:"initPostProcessing",value:function(){var e=this.scene,n=this.camera,t=this.renderer,r=this.renderPass=new ke(e,n),a=this.normalPass=new Sn(e,n),i=new Pn({blendFunction:Xe.SKIP}),o=this.ssaoEffect=new Rn(n,a.renderTarget.texture,{blendFunction:Xe.MULTIPLY,samples:11,rings:4,distanceThreshold:.02,distanceFalloff:.0025,rangeThreshold:3e-4,rangeFalloff:1e-4,luminanceInfluence:.7,radius:30,scale:1,bias:.05}),s=this.ssaoEffectPass=new En(n,o,i);s.encodeOutput=!0;var u=new An,c=t.getPixelRatio();u.uniforms["resolution"].value.x=1/(this.width*c),u.uniforms["resolution"].value.y=1/(this.height*c);var d=this.fxaaPass=new Fn(u),f=this.composer=new Ln(t,{frameBufferType:l["HalfFloatType"],autoRenderToScreen:!1});f.addPass(r),f.addPass(a),f.addPass(s),f.addPass(d)}},{key:"toggleSSAOEffect",value:function(e){this.ssaoEffectPass.enabled=e}},{key:"toggleAAEffect",value:function(e){this.fxaaPass.enabled=e,this.ssaoEffectPass.enabled?this.ssaoEffectPass.renderToScreen=!e:this.renderPass.renderToScreen=!e}},{key:"initGUI",value:function(){var e=this,n=new Jt;this.isMobile&&n.close();var t=this.gltfScene,r=this.guiParams={enableIBL:!!j.ENABLE_IBL,enableLight:!!j.ENABLE_LIGHT,envRotation:this.envRotation,envBrightness:this.envBrightness.value,envMap:he[0],metalness:G.metalness.value,roughness:G.roughness.value,diffuseEquation:me[0],specularFresnelEquation:ge[0],specularNDFEquation:ve[0],specularVisEquation:_e[0],enableAnisotropy:!!j.ENABLE_ANISOTROPY,anisotropyFactor:G.uAnisotropyFactor.value,anisotropyRotation:G.uAnisotropyRotation.value,enableClearCoat:!!j.ENABLE_CLEARCOAT,clearCoatRoughness:G.uClearCoatRoughness.value,clearCoat:G.uClearCoat.value,enableCompensation:!!j.ENERGY_COMPENSATION,enableSpecularAA:!!j.GEOMETRIC_SPECULAR_AA,specularAAVariance:G.uSpecularAAVariance.value,specularAAThreshold:G.uSpecularAAThreshold.value,specularAO:xe[0],enableMSSpecularAO:!!j.MS_SPECULAR_AO,enableMSDiffuseAO:!!j.MS_DIFFUSE_AO,toneMapping:Ae[0],enableSSAO:!0,enableFXAA:!0},a=n.addFolder("PBR");a.add(r,"enableIBL").onChange((function(n){e.guiParams.enableIBL=n,e.reCompileShader()})),a.add(r,"enableLight").name("enableSunLight").onChange((function(n){e.guiParams.enableLight=n,e.reCompileShader()})),a.add(r,"envMap",he).onChange((function(n){document.querySelector("#wrapper").classList.add("isLoading"),e.updateEnvMap(n,(function(){document.querySelector("#wrapper").classList.remove("isLoading")}))})),a.add(r,"envRotation",-Math.PI,Math.PI).step(.1).onChange((function(n){e.envRotation=n})),a.add(r,"envBrightness",0,2).step(.1).onChange((function(n){e.envBrightness.value=n})),a.add(r,"metalness",0,1).step(.01).onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.metalness.value=e)}))})),a.add(r,"roughness",0,1).step(.01).onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.roughness.value=e)}))})),a.open();var i=n.addFolder("Equations");i.add(r,"diffuseEquation",me).name("diffuse").onChange((function(n){e.guiParams.diffuseEquation=n,e.reCompileShader()})),i.add(r,"specularFresnelEquation",ge).name("fresnel").onChange((function(n){e.guiParams.specularFresnelEquation=n,e.reCompileShader()})),i.add(r,"specularNDFEquation",ve).name("NDF").onChange((function(n){e.guiParams.specularNDFEquation=n,e.reCompileShader()})),i.add(r,"specularVisEquation",_e).name("geometry").onChange((function(n){e.guiParams.specularVisEquation=n,e.reCompileShader()})),i.open();var o=n.addFolder("Anisotropy");o.add(r,"enableAnisotropy").name("enable").onChange((function(n){e.guiParams.enableAnisotropy=n,e.reCompileShader()})),o.add(r,"anisotropyRotation",-3.14,3.14).step(.01).name("rotation").onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.uAnisotropyRotation.value=e)}))})),o.add(r,"anisotropyFactor",0,1).name("factor").step(.01).onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.uAnisotropyFactor.value=e)}))}));var s=n.addFolder("ClearCoat");s.add(r,"enableClearCoat").name("enable").onChange((function(n){e.guiParams.enableClearCoat=n,e.reCompileShader()})),s.add(r,"clearCoat",0,1).step(.01).name("clearCoat").onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.uClearCoat.value=e)}))})),s.add(r,"clearCoatRoughness",0,1).step(.01).name("roughness").onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.uClearCoatRoughness.value=e)}))}));var u=n.addFolder("Advance");u.add(r,"enableCompensation").name("compensation").onChange((function(n){e.guiParams.enableCompensation=n,e.reCompileShader()})),u.add(r,"enableSpecularAA").name("specularAA").onChange((function(n){e.guiParams.enableSpecularAA=n,e.reCompileShader()})),u.add(r,"specularAAVariance",0,1).name("sAAVariance").step(.01).onChange((function(e){t.traverse((function(n){n.isMesh&&(n.material.uniforms.uSpecularAAVariance.value=e)}))})),u.add(r,"enableMSSpecularAO").name("msSpecularAO").onChange((function(n){e.guiParams.enableMSSpecularAO=n,e.reCompileShader()})),u.add(r,"enableMSDiffuseAO").name("msDiffuseAO").onChange((function(n){e.guiParams.enableMSDiffuseAO=n,e.reCompileShader()})),u.add(r,"specularAO",xe).onChange((function(n){e.guiParams.specularAO=n,e.reCompileShader()}));var c=n.addFolder("Post-Processing");c.add(r,"toneMapping",Ae).onChange((function(n){e.renderer.toneMapping=l["".concat(n,"ToneMapping")],e.reCompileShader(!0)})),c.add(r,"enableSSAO").name("SSAO").onChange((function(n){e.toggleSSAOEffect(n)})),c.add(r,"enableFXAA").name("FXAA").onChange((function(n){e.toggleAAEffect(n)})),c.open()}},{key:"setDefinesFromGUI",value:function(e){var n=this.guiParams,t=be;return Object.keys(e).map((function(n){t.test(n)&&delete e[n]})),n.enableIBL&&(e.ENABLE_IBL=1),n.enableLight&&(e.ENABLE_LIGHT=1),n.enableAnisotropy&&(e.ENABLE_ANISOTROPY=1),n.enableClearCoat&&(e.ENABLE_CLEARCOAT=1),n.enableCompensation&&(e.ENERGY_COMPENSATION=1),n.enableSpecularAA&&(e.GEOMETRIC_SPECULAR_AA=1),n.enableMSSpecularAO&&(e.MS_SPECULAR_AO=1),n.enableMSDiffuseAO&&(e.MS_DIFFUSE_AO=1),e["DIFFUSE_".concat(n.diffuseEquation.toUpperCase())]=1,e["F_".concat(n.specularFresnelEquation.toUpperCase())]=1,e["NDF_".concat(n.specularNDFEquation.toUpperCase())]=1,e["V_".concat(n.specularVisEquation.toUpperCase())]=1,e["SPECULAR_AO_".concat(n.specularAO.toUpperCase())]=1,e}},{key:"reCompileShader",value:function(e){var n=this;this.gltfScene.traverse((function(e){e.isMesh&&e.material&&(n.setDefinesFromGUI(e.material.defines),e.material.needsUpdate=!0)})),e&&(this.background.material.needsUpdate=!0)}},{key:"updateEnvironmentRotation",value:function(e){this.envRotationFromPanel.makeRotationY(e),this.cameraRotationMatrix.makeRotationFromQuaternion(this.camera.quaternion),this.envRotationMat4.multiplyMatrices(this.envRotationFromPanel,this.cameraRotationMatrix),this.envRotationMat.value.setFromMatrix4(this.envRotationMat4),this.envRotationMatBG.value.setFromMatrix4(this.envRotationFromPanel);var n=this.sunLightStartPos.clone();this.sunLightPanelRotateMat.getInverse(this.envRotationFromPanel),n.applyMatrix4(this.sunLightPanelRotateMat),this.sunLight.position.copy(n)}},{key:"resize",value:function(e,n){this.width=e,this.height=n,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.composer.setSize(e,n)}},{key:"update",value:function(){var e=this.clock.getDelta();this.updateEnvironmentRotation(this.envRotation),this.animationMixer&&this.animationMixer.update(e),this.composer.render(e)}}]),e}(),er=function(){function e(n,t,r){Object(o["a"])(this,e),this.container=n,this.time=0,this.width=Te(n),this.height=Se(n);var a=this.camera=new l["PerspectiveCamera"](45,this.width/this.height,.1,1e3);a.position.set(0,0,10);var i=this.renderer=new l["WebGLRenderer"]({antialias:!1});i.domElement.id="canvasWebGL",i.setPixelRatio(window.devicePixelRatio),i.setSize(this.width,this.height),i.setClearColor(16777215,1),i.shadowMap.enabled=!0,i.gammaFactor=2.2,i.outputEncoding=l["sRGBEncoding"],n.appendChild(i.domElement),this.initScene(t,r),this.initEvents()}return Object(s["a"])(e,[{key:"initScene",value:function(e,n){var t=this;this.scene=new l["Scene"],this.modelViewer=new $t(this,e,(function(){t.loaded=!0,t.onWindowResize(),"function"===typeof n&&n()})),this.animete()}},{key:"initEvents",value:function(){window.addEventListener("resize",this.onWindowResize.bind(this),!1)}},{key:"onWindowResize",value:function(){this.loaded&&(this.width=Te(this.container),this.height=Se(this.container),this.modelViewer.resize(this.width,this.height))}},{key:"animete",value:function(e){this.loaded&&this.modelViewer.update(e),requestAnimationFrame(this.animete.bind(this))}}]),e}(),nr=t("3835"),tr=(t("b420"),t("38cf"),t("fd87"),t("8b09"),t("84c3"),t("fb2c"),function(){function e(e){l["Loader"].call(this,e),this.dracoLoader=null,this.ddsLoader=null}function n(){var e={};return{get:function(n){return e[n]},add:function(n,t){e[n]=t},remove:function(n){delete e[n]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(l["Loader"].prototype),{constructor:e,load:function(e,n,t,r){var a,i=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:l["LoaderUtils"].extractUrlBase(e),i.manager.itemStart(e);var o=function(n){r?r(n):console.error(n),i.manager.itemError(e),i.manager.itemEnd(e)},s=new l["FileLoader"](i.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===i.crossOrigin&&s.setWithCredentials(!0),s.load(e,(function(t){try{i.parse(t,a,(function(t){n(t),i.manager.itemEnd(e)}),o)}catch(r){o(r)}}),t,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,n,u,c){var h,v={};if("string"===typeof e)h=e;else{var _=l["LoaderUtils"].decodeText(new Uint8Array(e,0,4));if(_===s){try{v[t.KHR_BINARY_GLTF]=new d(e)}catch(T){return void(c&&c(T))}h=v[t.KHR_BINARY_GLTF].content}else h=l["LoaderUtils"].decodeText(new Uint8Array(e))}var A=JSON.parse(h);if(void 0===A.asset||A.asset.version[0]<2)c&&c(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(A.extensionsUsed)for(var x=0;x<A.extensionsUsed.length;++x){var b=A.extensionsUsed[x],y=A.extensionsRequired||[];switch(b){case t.KHR_LIGHTS_PUNCTUAL:v[b]=new a(A);break;case t.KHR_MATERIALS_CLEARCOAT:v[b]=new o;break;case t.KHR_MATERIALS_UNLIT:v[b]=new i;break;case t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:v[b]=new m;break;case t.KHR_DRACO_MESH_COMPRESSION:v[b]=new f(A,this.dracoLoader);break;case t.MSFT_TEXTURE_DDS:v[b]=new r(this.ddsLoader);break;case t.KHR_TEXTURE_TRANSFORM:v[b]=new p;break;case t.KHR_MESH_QUANTIZATION:v[b]=new g;break;default:y.indexOf(b)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}var E=new U(A,v,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});E.parse(u,c)}}});var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=t.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.name=t.KHR_LIGHTS_PUNCTUAL;var n=e.extensions&&e.extensions[t.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=n.lights||[]}function i(){this.name=t.KHR_MATERIALS_UNLIT}function o(){this.name=t.KHR_MATERIALS_CLEARCOAT}a.prototype.loadLight=function(e){var n,t=this.lightDefs[e],r=new l["Color"](16777215);void 0!==t.color&&r.fromArray(t.color);var a=void 0!==t.range?t.range:0;switch(t.type){case"directional":n=new l["DirectionalLight"](r),n.target.position.set(0,0,-1),n.add(n.target);break;case"point":n=new l["PointLight"](r),n.distance=a;break;case"spot":n=new l["SpotLight"](r),n.distance=a,t.spot=t.spot||{},t.spot.innerConeAngle=void 0!==t.spot.innerConeAngle?t.spot.innerConeAngle:0,t.spot.outerConeAngle=void 0!==t.spot.outerConeAngle?t.spot.outerConeAngle:Math.PI/4,n.angle=t.spot.outerConeAngle,n.penumbra=1-t.spot.innerConeAngle/t.spot.outerConeAngle,n.target.position.set(0,0,-1),n.add(n.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+t.type+'".')}return n.position.set(0,0,0),n.decay=2,void 0!==t.intensity&&(n.intensity=t.intensity),n.name=t.name||"light_"+e,Promise.resolve(n)},i.prototype.getMaterialType=function(){return l["MeshBasicMaterial"]},i.prototype.extendParams=function(e,n,t){var r=[];e.color=new l["Color"](1,1,1),e.opacity=1;var a=n.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var i=a.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}void 0!==a.baseColorTexture&&r.push(t.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(r)},o.prototype.getMaterialType=function(){return l["MeshPhysicalMaterial"]},o.prototype.extendParams=function(e,n,t){var r=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(e.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(t.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(t.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(t.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var i=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new l["Vector2"](i,i)}return Promise.all(r)};var s="glTF",u=12,c={JSON:1313821514,BIN:5130562};function d(e){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(e,0,u);if(this.header={magic:l["LoaderUtils"].decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var r=new DataView(e,u),a=0;while(a<r.byteLength){var i=r.getUint32(a,!0);a+=4;var o=r.getUint32(a,!0);if(a+=4,o===c.JSON){var d=new Uint8Array(e,u+a,i);this.content=l["LoaderUtils"].decodeText(d)}else if(o===c.BIN){var f=u+a;this.body=e.slice(f,f+i)}a+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function f(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=t.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}function p(){this.name=t.KHR_TEXTURE_TRANSFORM}function h(e){l["MeshStandardMaterial"].call(this),this.isGLTFSpecularGlossinessMaterial=!0;var n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),t=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new l["Color"]).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var s in o)e.uniforms[s]=o[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",a),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function m(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return h},extendParams:function(e,n,t){var r=n.extensions[this.name];e.color=new l["Color"](1,1,1),e.opacity=1;var a=[];if(Array.isArray(r.diffuseFactor)){var i=r.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(void 0!==r.diffuseTexture&&a.push(t.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new l["Color"](0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new l["Color"](1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var o=r.specularGlossinessTexture;a.push(t.assignTexture(e,"glossinessMap",o)),a.push(t.assignTexture(e,"specularMap",o))}return Promise.all(a)},createMaterial:function(e){var n=new h(e);return n.fog=!0,n.color=e.color,n.map=void 0===e.map?null:e.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===e.aoMap?null:e.aoMap,n.aoMapIntensity=1,n.emissive=e.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,n.bumpMap=void 0===e.bumpMap?null:e.bumpMap,n.bumpScale=1,n.normalMap=void 0===e.normalMap?null:e.normalMap,n.normalMapType=l["TangentSpaceNormalMap"],e.normalScale&&(n.normalScale=e.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===e.specularMap?null:e.specularMap,n.specular=e.specular,n.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,n.glossiness=e.glossiness,n.alphaMap=null,n.envMap=void 0===e.envMap?null:e.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}}function g(){this.name=t.KHR_MESH_QUANTIZATION}function v(e,n,t,r){l["Interpolant"].call(this,e,n,t,r)}f.prototype.decodePrimitive=function(e,n){var t=this.json,r=this.dracoLoader,a=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},s={},l={};for(var u in i){var c=E[u]||u.toLowerCase();o[c]=i[u]}for(u in e.attributes){c=E[u]||u.toLowerCase();if(void 0!==i[u]){var d=t.accessors[e.attributes[u]],f=A[d.componentType];l[c]=f,s[c]=!0===d.normalized}}return n.getDependency("bufferView",a).then((function(e){return new Promise((function(n){r.decodeDracoFile(e,(function(e){for(var t in e.attributes){var r=e.attributes[t],a=s[t];void 0!==a&&(r.normalized=a)}n(e)}),o,l)}))}))},p.prototype.extendTexture=function(e,n){return e=e.clone(),void 0!==n.offset&&e.offset.fromArray(n.offset),void 0!==n.rotation&&(e.rotation=n.rotation),void 0!==n.scale&&e.repeat.fromArray(n.scale),void 0!==n.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},h.prototype=Object.create(l["MeshStandardMaterial"].prototype),h.prototype.constructor=h,h.prototype.copy=function(e){return l["MeshStandardMaterial"].prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},v.prototype=Object.create(l["Interpolant"].prototype),v.prototype.constructor=v,v.prototype.copySampleValue_=function(e){for(var n=this.resultBuffer,t=this.sampleValues,r=this.valueSize,a=e*r*3+r,i=0;i!==r;i++)n[i]=t[a+i];return n},v.prototype.beforeStart_=v.prototype.copySampleValue_,v.prototype.afterEnd_=v.prototype.copySampleValue_,v.prototype.interpolate_=function(e,n,t,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=r-n,c=(t-n)/u,d=c*c,f=d*c,p=e*l,h=p-l,m=-2*f+3*d,g=f-d,v=1-m,_=g-d+c,A=0;A!==o;A++){var x=i[h+A+o],b=i[h+A+s]*u,y=i[p+A+o],E=i[p+A]*u;a[A]=v*x+_*b+m*y+g*E}return a};var _={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},A={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:l["NearestFilter"],9729:l["LinearFilter"],9984:l["NearestMipmapNearestFilter"],9985:l["LinearMipmapNearestFilter"],9986:l["NearestMipmapLinearFilter"],9987:l["LinearMipmapLinearFilter"]},b={33071:l["ClampToEdgeWrapping"],33648:l["MirroredRepeatWrapping"],10497:l["RepeatWrapping"]},y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},T={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:void 0,LINEAR:l["InterpolateLinear"],STEP:l["InterpolateDiscrete"]},F={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},L={"image/png":l["RGBAFormat"],"image/jpeg":l["RGBFormat"]};function N(e,n){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}function P(e){return void 0===e["DefaultMaterial"]&&(e["DefaultMaterial"]=new l["MeshStandardMaterial"]({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l["FrontSide"]})),e["DefaultMaterial"]}function w(e,n,t){for(var r in t.extensions)void 0===e[r]&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[r]=t.extensions[r])}function R(e,n){void 0!==n.extras&&("object"===Object(On["a"])(n.extras)?Object.assign(e.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function O(e,n,t){for(var r=!1,a=!1,i=0,o=n.length;i<o;i++){var s=n[i];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(a=!0),r&&a)break}if(!r&&!a)return Promise.resolve(e);var l=[],u=[];for(i=0,o=n.length;i<o;i++){s=n[i];if(r){var c=void 0!==s.POSITION?t.getDependency("accessor",s.POSITION):e.attributes.position;l.push(c)}if(a){c=void 0!==s.NORMAL?t.getDependency("accessor",s.NORMAL):e.attributes.normal;u.push(c)}}return Promise.all([Promise.all(l),Promise.all(u)]).then((function(n){var t=n[0],i=n[1];return r&&(e.morphAttributes.position=t),a&&(e.morphAttributes.normal=i),e.morphTargetsRelative=!0,e}))}function M(e,n){if(e.updateMorphTargets(),void 0!==n.weights)for(var t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t];if(n.extras&&Array.isArray(n.extras.targetNames)){var a=n.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(t=0,r=a.length;t<r;t++)e.morphTargetDictionary[a[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function C(e){var n,r=e.extensions&&e.extensions[t.KHR_DRACO_MESH_COMPRESSION];return n=r?"draco:"+r.bufferView+":"+r.indices+":"+I(r.attributes):e.indices+":"+I(e.attributes)+":"+e.mode,n}function I(e){for(var n="",t=Object.keys(e).sort(),r=0,a=t.length;r<a;r++)n+=t[r]+":"+e[t[r]]+";";return n}function U(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new n,this.primitiveCache={},this.textureLoader=new l["TextureLoader"](this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new l["FileLoader"](this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function D(e,n,t){var r=n.attributes,a=new l["Box3"];if(void 0!==r.POSITION){var i=t.json.accessors[r.POSITION],o=i.min,s=i.max;if(void 0!==o&&void 0!==s){a.set(new l["Vector3"](o[0],o[1],o[2]),new l["Vector3"](s[0],s[1],s[2]));var u=n.targets;if(void 0!==u){for(var c=new l["Vector3"],d=new l["Vector3"],f=0,p=u.length;f<p;f++){var h=u[f];if(void 0!==h.POSITION){i=t.json.accessors[h.POSITION],o=i.min,s=i.max;void 0!==o&&void 0!==s?(d.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),d.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),d.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),c.max(d)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(c)}e.boundingBox=a;var m=new l["Sphere"];a.getCenter(m.center),m.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function k(e,n,t){var r=n.attributes,a=[];function i(n,r){return t.getDependency("accessor",n).then((function(n){e.setAttribute(r,n)}))}for(var o in r){var s=E[o]||o.toLowerCase();s in e.attributes||a.push(i(r[o],s))}if(void 0!==n.indices&&!e.index){var l=t.getDependency("accessor",n.indices).then((function(n){e.setIndex(n)}));a.push(l)}return R(e,n),D(e,n,t),Promise.all(a).then((function(){return void 0!==n.targets?O(e,n.targets,t):e}))}function B(e,n){var t=e.getIndex();if(null===t){var r=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<a.count;i++)r.push(i);e.setIndex(r),t=e.getIndex()}var o=t.count-2,s=[];if(n===l["TriangleFanDrawMode"])for(i=1;i<=o;i++)s.push(t.getX(0)),s.push(t.getX(i)),s.push(t.getX(i+1));else for(i=0;i<o;i++)i%2===0?(s.push(t.getX(i)),s.push(t.getX(i+1)),s.push(t.getX(i+2))):(s.push(t.getX(i+2)),s.push(t.getX(i+1)),s.push(t.getX(i)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(s),u}return U.prototype.parse=function(e,n){var t=this,r=this.json,a=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(n){var i={scene:n[0][r.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:r.asset,parser:t,userData:{}};w(a,i,r),R(i,r),e(i)}))["catch"](n)},U.prototype.markDefs=function(){for(var e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[],r={},a={},i=0,o=n.length;i<o;i++)for(var s=n[i].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var c=0,d=e.length;c<d;c++){var f=e[c];void 0!==f.mesh&&(void 0===r[f.mesh]&&(r[f.mesh]=a[f.mesh]=0),r[f.mesh]++,void 0!==f.skin&&(t[f.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=a},U.prototype.getDependency=function(e,n){var r=e+":"+n,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(n);break;case"node":a=this.loadNode(n);break;case"mesh":a=this.loadMesh(n);break;case"accessor":a=this.loadAccessor(n);break;case"bufferView":a=this.loadBufferView(n);break;case"buffer":a=this.loadBuffer(n);break;case"material":a=this.loadMaterial(n);break;case"texture":a=this.loadTexture(n);break;case"skin":a=this.loadSkin(n);break;case"animation":a=this.loadAnimation(n);break;case"camera":a=this.loadCamera(n);break;case"light":a=this.extensions[t.KHR_LIGHTS_PUNCTUAL].loadLight(n);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},U.prototype.getDependencies=function(e){var n=this.cache.get(e);if(!n){var t=this,r=this.json[e+("mesh"===e?"es":"s")]||[];n=Promise.all(r.map((function(n,r){return t.getDependency(e,r)}))),this.cache.add(e,n)}return n},U.prototype.loadBuffer=function(e){var n=this.json.buffers[e],r=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===e)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var a=this.options;return new Promise((function(e,t){r.load(N(n.uri,a.path),e,void 0,(function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))}))}))},U.prototype.loadBufferView=function(e){var n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then((function(e){var t=n.byteLength||0,r=n.byteOffset||0;return e.slice(r,r+t)}))},U.prototype.loadAccessor=function(e){var n=this,t=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then((function(e){var a,i,o=e[0],s=y[r.type],u=A[r.componentType],c=u.BYTES_PER_ELEMENT,d=c*s,f=r.byteOffset||0,p=void 0!==r.bufferView?t.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;if(p&&p!==d){var m=Math.floor(f/p),g="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count,v=n.cache.get(g);v||(a=new u(o,m*p,r.count*p/c),v=new l["InterleavedBuffer"](a,p/c),n.cache.add(g,v)),i=new l["InterleavedBufferAttribute"](v,s,f%p/c,h)}else a=null===o?new u(r.count*s):new u(o,f,r.count*s),i=new l["BufferAttribute"](a,s,h);if(void 0!==r.sparse){var _=y.SCALAR,x=A[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,E=r.sparse.values.byteOffset||0,T=new x(e[1],b,r.sparse.count*_),S=new u(e[2],E,r.sparse.count*s);null!==o&&(i=new l["BufferAttribute"](i.array.slice(),i.itemSize,i.normalized));for(var F=0,L=T.length;F<L;F++){var N=T[F];if(i.setX(N,S[F*s]),s>=2&&i.setY(N,S[F*s+1]),s>=3&&i.setZ(N,S[F*s+2]),s>=4&&i.setW(N,S[F*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},U.prototype.loadTexture=function(e){var n,r=this,a=this.json,i=this.options,o=this.textureLoader,s=self.URL||self.webkitURL,u=a.textures[e],c=u.extensions||{};n=c[t.MSFT_TEXTURE_DDS]?a.images[c[t.MSFT_TEXTURE_DDS].source]:a.images[u.source];var d=n.uri,f=!1;return void 0!==n.bufferView&&(d=r.getDependency("bufferView",n.bufferView).then((function(e){f=!0;var t=new Blob([e],{type:n.mimeType});return d=s.createObjectURL(t),d}))),Promise.resolve(d).then((function(e){var n=i.manager.getHandler(e);return n||(n=c[t.MSFT_TEXTURE_DDS]?r.extensions[t.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise((function(t,r){n.load(N(e,i.path),t,void 0,r)}))})).then((function(e){!0===f&&s.revokeObjectURL(d),e.flipY=!1,u.name&&(e.name=u.name),n.mimeType in L&&(e.format=L[n.mimeType]);var t=a.samplers||{},r=t[u.sampler]||{};return e.magFilter=x[r.magFilter]||l["LinearFilter"],e.minFilter=x[r.minFilter]||l["LinearMipmapLinearFilter"],e.wrapS=b[r.wrapS]||l["RepeatWrapping"],e.wrapT=b[r.wrapT]||l["RepeatWrapping"],e}))},U.prototype.assignTexture=function(e,n,r){var a=this;return this.getDependency("texture",r.index).then((function(i){if(!i.isCompressedTexture)switch(n){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":i.format=l["RGBFormat"];break}if(void 0===r.texCoord||0==r.texCoord||"aoMap"===n&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+n+" not yet supported."),a.extensions[t.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[t.KHR_TEXTURE_TRANSFORM]:void 0;o&&(i=a.extensions[t.KHR_TEXTURE_TRANSFORM].extendTexture(i,o))}e[n]=i}))},U.prototype.assignFinalMaterial=function(e){var n=e.geometry,t=e.material,r=void 0!==n.attributes.tangent,a=void 0!==n.attributes.color,i=void 0===n.attributes.normal,o=!0===e.isSkinnedMesh,s=Object.keys(n.morphAttributes).length>0,u=s&&void 0!==n.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+t.uuid,d=this.cache.get(c);d||(d=new l["PointsMaterial"],l["Material"].prototype.copy.call(d,t),d.color.copy(t.color),d.map=t.map,d.sizeAttenuation=!1,this.cache.add(c,d)),t=d}else if(e.isLine){c="LineBasicMaterial:"+t.uuid;var f=this.cache.get(c);f||(f=new l["LineBasicMaterial"],l["Material"].prototype.copy.call(f,t),f.color.copy(t.color),this.cache.add(c,f)),t=f}if(r||a||i||o||s){c="ClonedMaterial:"+t.uuid+":";t.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),o&&(c+="skinning:"),r&&(c+="vertex-tangents:"),a&&(c+="vertex-colors:"),i&&(c+="flat-shading:"),s&&(c+="morph-targets:"),u&&(c+="morph-normals:");var p=this.cache.get(c);p||(p=t.clone(),o&&(p.skinning=!0),r&&(p.vertexTangents=!0),a&&(p.vertexColors=!0),i&&(p.flatShading=!0),s&&(p.morphTargets=!0),u&&(p.morphNormals=!0),this.cache.add(c,p)),t=p}t.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",new l["BufferAttribute"](n.attributes.uv.array,2)),t.normalScale&&!r&&(t.normalScale.y=-t.normalScale.y),t.clearcoatNormalScale&&!r&&(t.clearcoatNormalScale.y=-t.clearcoatNormalScale.y),e.material=t},U.prototype.loadMaterial=function(e){var n,r=this,a=this.json,i=this.extensions,o=a.materials[e],s={},u=o.extensions||{},c=[];if(u[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var d=i[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];n=d.getMaterialType(),c.push(d.extendParams(s,o,r))}else if(u[t.KHR_MATERIALS_UNLIT]){var f=i[t.KHR_MATERIALS_UNLIT];n=f.getMaterialType(),c.push(f.extendParams(s,o,r))}else{n=l["MeshStandardMaterial"];var p=o.pbrMetallicRoughness||{};if(s.color=new l["Color"](1,1,1),s.opacity=1,Array.isArray(p.baseColorFactor)){var m=p.baseColorFactor;s.color.fromArray(m),s.opacity=m[3]}void 0!==p.baseColorTexture&&c.push(r.assignTexture(s,"map",p.baseColorTexture)),s.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,s.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(c.push(r.assignTexture(s,"metalnessMap",p.metallicRoughnessTexture)),c.push(r.assignTexture(s,"roughnessMap",p.metallicRoughnessTexture)))}!0===o.doubleSided&&(s.side=l["DoubleSide"]);var g=o.alphaMode||F.OPAQUE;if(g===F.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,g===F.MASK&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&n!==l["MeshBasicMaterial"]&&(c.push(r.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new l["Vector2"](1,1),void 0!==o.normalTexture.scale&&s.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&n!==l["MeshBasicMaterial"]&&(c.push(r.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&n!==l["MeshBasicMaterial"]&&(s.emissive=(new l["Color"]).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&n!==l["MeshBasicMaterial"]&&c.push(r.assignTexture(s,"emissiveMap",o.emissiveTexture)),u[t.KHR_MATERIALS_CLEARCOAT]){var v=i[t.KHR_MATERIALS_CLEARCOAT];n=v.getMaterialType(),c.push(v.extendParams(s,{extensions:u},r))}return Promise.all(c).then((function(){var e;return e=n===h?i[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new n(s),o.name&&(e.name=o.name),e.map&&(e.map.encoding=l["sRGBEncoding"]),e.emissiveMap&&(e.emissiveMap.encoding=l["sRGBEncoding"]),R(e,o),o.extensions&&w(i,e,o),e}))},U.prototype.loadGeometries=function(e){var n=this,r=this.extensions,a=this.primitiveCache;function i(e){return r[t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then((function(t){return k(t,e,n)}))}for(var o=[],s=0,u=e.length;s<u;s++){var c,d=e[s],f=C(d),p=a[f];if(p)o.push(p.promise);else c=d.extensions&&d.extensions[t.KHR_DRACO_MESH_COMPRESSION]?i(d):k(new l["BufferGeometry"],d,n),a[f]={primitive:d,promise:c},o.push(c)}return Promise.all(o)},U.prototype.loadMesh=function(e){for(var n=this,t=this.json,r=t.meshes[e],a=r.primitives,i=[],o=0,s=a.length;o<s;o++){var u=void 0===a[o].material?P(this.cache):this.getDependency("material",a[o].material);i.push(u)}return i.push(n.loadGeometries(a)),Promise.all(i).then((function(t){for(var i=t.slice(0,t.length-1),o=t[t.length-1],s=[],u=0,c=o.length;u<c;u++){var d,f=o[u],p=a[u],h=i[u];if(p.mode===_.TRIANGLES||p.mode===_.TRIANGLE_STRIP||p.mode===_.TRIANGLE_FAN||void 0===p.mode)d=!0===r.isSkinnedMesh?new l["SkinnedMesh"](f,h):new l["Mesh"](f,h),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),p.mode===_.TRIANGLE_STRIP?d.geometry=B(d.geometry,l["TriangleStripDrawMode"]):p.mode===_.TRIANGLE_FAN&&(d.geometry=B(d.geometry,l["TriangleFanDrawMode"]));else if(p.mode===_.LINES)d=new l["LineSegments"](f,h);else if(p.mode===_.LINE_STRIP)d=new l["Line"](f,h);else if(p.mode===_.LINE_LOOP)d=new l["LineLoop"](f,h);else{if(p.mode!==_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);d=new l["Points"](f,h)}Object.keys(d.geometry.morphAttributes).length>0&&M(d,r),d.name=r.name||"mesh_"+e,o.length>1&&(d.name+="_"+u),R(d,r),n.assignFinalMaterial(d),s.push(d)}if(1===s.length)return s[0];var m=new l["Group"];for(u=0,c=s.length;u<c;u++)m.add(s[u]);return m}))},U.prototype.loadCamera=function(e){var n,t=this.json.cameras[e],r=t[t.type];if(r)return"perspective"===t.type?n=new l["PerspectiveCamera"](l["MathUtils"].radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===t.type&&(n=new l["OrthographicCamera"](r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),t.name&&(n.name=t.name),R(n,t),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")},U.prototype.loadSkin=function(e){var n=this.json.skins[e],t={joints:n.joints};return void 0===n.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",n.inverseBindMatrices).then((function(e){return t.inverseBindMatrices=e,t}))},U.prototype.loadAnimation=function(e){for(var n=this.json,t=n.animations[e],r=[],a=[],i=[],o=[],s=[],u=0,c=t.channels.length;u<c;u++){var d=t.channels[u],f=t.samplers[d.sampler],p=d.target,h=void 0!==p.node?p.node:p.id,m=void 0!==t.parameters?t.parameters[f.input]:f.input,g=void 0!==t.parameters?t.parameters[f.output]:f.output;r.push(this.getDependency("node",h)),a.push(this.getDependency("accessor",m)),i.push(this.getDependency("accessor",g)),o.push(f),s.push(p)}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(i),Promise.all(o),Promise.all(s)]).then((function(n){for(var r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],u=[],c=0,d=r.length;c<d;c++){var f=r[c],p=a[c],h=i[c],m=o[c],g=s[c];if(void 0!==f){var _;switch(f.updateMatrix(),f.matrixAutoUpdate=!0,T[g.path]){case T.weights:_=l["NumberKeyframeTrack"];break;case T.rotation:_=l["QuaternionKeyframeTrack"];break;case T.position:case T.scale:default:_=l["VectorKeyframeTrack"];break}var A=f.name?f.name:f.uuid,x=void 0!==m.interpolation?S[m.interpolation]:l["InterpolateLinear"],b=[];T[g.path]===T.weights?f.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(A);var y=h.array;if(h.normalized){var E;if(y.constructor===Int8Array)E=1/127;else if(y.constructor===Uint8Array)E=1/255;else if(y.constructor==Int16Array)E=1/32767;else{if(y.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");E=1/65535}for(var F=new Float32Array(y.length),L=0,N=y.length;L<N;L++)F[L]=y[L]*E;y=F}for(L=0,N=b.length;L<N;L++){var P=new _(b[L]+"."+T[g.path],p.array,y,x);"CUBICSPLINE"===m.interpolation&&(P.createInterpolant=function(e){return new v(this.times,this.values,this.getValueSize()/3,e)},P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(P)}}}var w=t.name?t.name:"animation_"+e;return new l["AnimationClip"](w,void 0,u)}))},U.prototype.loadNode=function(e){var n=this.json,r=this.extensions,a=this,i=n.meshReferences,o=n.meshUses,s=n.nodes[e];return function(){var e=[];return void 0!==s.mesh&&e.push(a.getDependency("mesh",s.mesh).then((function(e){var n;if(i[s.mesh]>1){var t=o[s.mesh]++;n=e.clone(),n.name+="_instance_"+t}else n=e;return void 0!==s.weights&&n.traverse((function(e){if(e.isMesh)for(var n=0,t=s.weights.length;n<t;n++)e.morphTargetInfluences[n]=s.weights[n]})),n}))),void 0!==s.camera&&e.push(a.getDependency("camera",s.camera)),s.extensions&&s.extensions[t.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[t.KHR_LIGHTS_PUNCTUAL].light&&e.push(a.getDependency("light",s.extensions[t.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e)}().then((function(e){var n;if(n=!0===s.isBone?new l["Bone"]:e.length>1?new l["Group"]:1===e.length?e[0]:new l["Object3D"],n!==e[0])for(var t=0,a=e.length;t<a;t++)n.add(e[t]);if(s.name&&(n.userData.name=s.name,n.name=l["PropertyBinding"].sanitizeNodeName(s.name)),R(n,s),s.extensions&&w(r,n,s),void 0!==s.matrix){var i=new l["Matrix4"];i.fromArray(s.matrix),n.applyMatrix4(i)}else void 0!==s.translation&&n.position.fromArray(s.translation),void 0!==s.rotation&&n.quaternion.fromArray(s.rotation),void 0!==s.scale&&n.scale.fromArray(s.scale);return n}))},U.prototype.loadScene=function(){function e(n,t,r,a){var i=r.nodes[n];return a.getDependency("node",n).then((function(e){return void 0===i.skin?e:a.getDependency("skin",i.skin).then((function(e){n=e;for(var t=[],r=0,i=n.joints.length;r<i;r++)t.push(a.getDependency("node",n.joints[r]));return Promise.all(t)})).then((function(t){return e.traverse((function(e){if(e.isMesh){for(var r=[],a=[],i=0,o=t.length;i<o;i++){var s=t[i];if(s){r.push(s);var u=new l["Matrix4"];void 0!==n.inverseBindMatrices&&u.fromArray(n.inverseBindMatrices.array,16*i),a.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[i])}e.bind(new l["Skeleton"](r,a),e.matrixWorld)}})),e}));var n})).then((function(n){t.add(n);var o=[];if(i.children)for(var s=i.children,l=0,u=s.length;l<u;l++){var c=s[l];o.push(e(c,n,r,a))}return Promise.all(o)}))}return function(n){var t=this.json,r=this.extensions,a=this.json.scenes[n],i=this,o=new l["Group"];a.name&&(o.name=a.name),R(o,a),a.extensions&&w(r,o,a);for(var s=a.nodes||[],u=[],c=0,d=s.length;c<d;c++)u.push(e(s[c],o,t,i));return Promise.all(u).then((function(){return o}))}}(),e}()),rr=function(){function e(){Object(o["a"])(this,e)}return Object(s["a"])(e,[{key:"loadTexture",value:function(e){var n=new l["TextureLoader"];return new Promise((function(t){n.load(e,(function(e){t(e)}))}))}},{key:"loadGLTF",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"scene.gltf",t=new tr;return t.setPath(e),new Promise((function(e){t.load(n,(function(n){e(n)}))}))}},{key:"importGLTF",value:function(e){var n,t;Array.from(e).forEach((function(e){var r=Object(nr["a"])(e,2),a=r[0],i=r[1];i.name.match(/\.(gltf|glb)$/)&&(n=i,t=a.replace(i.name,""))})),n||console.error("No .gltf or .glb asset found.");var r="string"===typeof n?n:URL.createObjectURL(n);return this.loadLocalGLTF(r,t,e)}},{key:"loadLocalGLTF",value:function(e,n,t){var r=l["LoaderUtils"].extractUrlBase(e);return new Promise((function(a,i){var o=new l["LoadingManager"];o.setURLModifier((function(e,a){var i=n+e.replace(r,"").replace(/^(\.?\/)/,"");if(t.has(i)){var o=t.get(i),s=URL.createObjectURL(o);return u.push(s),s}return(a||"")+e}));var s=new tr(o);s.setCrossOrigin("anonymous");var u=[];s.load(e,(function(e){a(e)}),void 0,i)}))}}]),e}(),ar=t("8792"),ir={name:"container",data:function(){return{openImportPage:!0}},mounted:function(){this.initEvent()},methods:{initScene:function(e){var n=document.querySelector("#canvasContainer");this.scene=new er(n,e,(function(){document.querySelector("#wrapper").classList.remove("isLoading")}))},initEvent:function(){var e=this,n=this,t=new rr,r=document.body.querySelector("#file-input"),a=document.body.querySelector(".dropzone"),i=new ar["a"](a,r);i.on("drop",(function(r){var a=r.files;return t.importGLTF(a).then((function(t){e.initScene(t),n.openImportPage=!1}))}))},loadDefaultModel:function(){var e=this,n=new rr;this.openImportPage=!1,n.loadGLTF("./assets/models/damagedHelmet/").then((function(n){e.initScene(n)}))}}},or=ir,sr=(t("8aaa"),t("0c7c")),lr=Object(sr["a"])(or,a,i,!1,null,null,null),ur=lr.exports;new r["a"]({render:function(e){return e(ur)}}).$mount("#container")},"8aaa":function(e,n,t){"use strict";var r=t("c556"),a=t.n(r);a.a},c556:function(e,n,t){}});
//# sourceMappingURL=app.01c148fc.js.map